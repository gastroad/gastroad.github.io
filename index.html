<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>gastroad blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="gastroad blog">
<meta property="og:url" content="https://gastroad.github.io/index.html">
<meta property="og:site_name" content="gastroad blog">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="gastroad">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="gastroad blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gastroad blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gastroad.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-React/nextjs-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/25/React/nextjs-3/" class="article-date">
  <time class="dt-published" datetime="2023-05-25T11:45:53.000Z" itemprop="datePublished">2023-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/25/React/nextjs-3/">Next.js 에 대해서 알아보자-3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>우선 오늘은 디렉토리 구조 변경, alias 설정, 비동기 요청을 해보도록 하겠다.</p>
<h3 id="디렉토리-구조-변경"><a href="#디렉토리-구조-변경" class="headerlink" title="디렉토리 구조 변경"></a>디렉토리 구조 변경</h3><p>컴포넌트를 atomic 패턴을 이용하여 변경하려고 한다.<br>next 특성상 pages는 생략하고 app 디렉토리를 사용하도록 하겠다.</p>
<p><img src="/../../img/nextjs-3/1.png"></p>
<p>RecoilRootProvider 같은 친구들은 어디에 둬야 할지 약간 고민이 된다.<br>ui component 가 아닌 component 가 많이 생성이 된다면 atoms, molecules, organisms 을 UI라는 폴더를 만들어서 하위에서 관리해 주어야겠다.</p>
<h3 id="alias-수정"><a href="#alias-수정" class="headerlink" title="alias 수정"></a>alias 수정</h3><p>이제 alias 설정을 해보도록 하겠다.<br>next를 TypeScript와 사용한다면 tsconfig.json 파일을 수정해 주면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;baseUrl&quot;</span>: <span class="string">&quot;.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;paths&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@app/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/app/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@components/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/components/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@atoms/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/components/atoms/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@molecules/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/components/molecules/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@organisms/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/components/organisms/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@templates/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/templates/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@state/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/state/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@types/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/types/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;@utils/*&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;./src/utils/*&quot;</span></span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>테스트를 위해 jest.config에 도 alias 설정을 해주어야 한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jest.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nextJest = <span class="built_in">require</span>(<span class="string">&quot;next/jest&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createJestConfig = <span class="title function_">nextJest</span>(&#123;</span><br><span class="line">  <span class="attr">dir</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> customJestConfig = &#123;</span><br><span class="line">  <span class="attr">setupFilesAfterEnv</span>: [<span class="string">&quot;&lt;rootDir&gt;/jest.setup.js&quot;</span>],</span><br><span class="line">  <span class="attr">testEnvironment</span>: <span class="string">&quot;jest-environment-jsdom&quot;</span>,</span><br><span class="line">  <span class="comment">// moduleNameMapper 에 alias 를 정규표현식으로 작성해주면 된다.</span></span><br><span class="line">  <span class="attr">moduleNameMapper</span>: &#123;</span><br><span class="line">    <span class="string">&quot;^@components/(.*)$&quot;</span>: <span class="string">&quot;&lt;rootDir&gt;/src/components/$1&quot;</span>,</span><br><span class="line">    <span class="comment">// etc...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">createJestConfig</span>(customJestConfig);</span><br></pre></td></tr></table></figure>

<h3 id="비동기요청"><a href="#비동기요청" class="headerlink" title="비동기요청"></a>비동기요청</h3><p>비동기 요청을 하기 전에 cros 에러가 나지 않게 proxy 설정을 해주도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// next.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;next&#x27;).NextConfig</span>&#125; */</span></span><br><span class="line"><span class="keyword">const</span> nextConfig = &#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">rewrites</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;/api/:path*&quot;</span>,</span><br><span class="line">        <span class="attr">destination</span>: <span class="string">&quot;http://localhost:3000/api/:path*&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = nextConfig;</span><br></pre></td></tr></table></figure>

<p>proxy 설정까지 완료되었으면 api 요청을 보내보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api/portfolio.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPortfolioData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/api/portfolio&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">ok</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Failed to fetch data&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>우선 api 먼저 작성해 주었다.<br>이 api를 server에서 한번 client에서 한번 요청해 보려고 한다.</p>
<p>먼저 익숙한 client에서의 비동기 요청을 해보겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/main/page</span></span><br><span class="line"><span class="string">&quot;use client&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioData &#125; <span class="keyword">from</span> <span class="string">&quot;@api/portfolio&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LoginFrom</span> <span class="keyword">from</span> <span class="string">&quot;@molecules/LoginForm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchPortfolioData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getPortfolioData</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;client&quot;</span>, data);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">fetchPortfolioData</span>();</span><br><span class="line">  &#125;, [fetchPortfolioData]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      main</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LoginFrom</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/nextjs-3/2.png"></p>
<p>요청이 성공적으로 응답한 걸 확인했다.</p>
<p>이제 server에서 비동기 요청을 해보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/page</span></span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioData &#125; <span class="keyword">from</span> <span class="string">&quot;@api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">getPortfolioData</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="property">portfolio</span>.<span class="property">title</span>, <span class="string">&quot;server&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;data.portfolio[0].title&#125;</span></span><br><span class="line"><span class="language-xml">      home</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/nextjs-3/3.png"></p>
<p>서버에서 요청을 해보니 오류가 발생하였다.</p>
<p>터미널에서도 에러를 확인해 보니.</p>
<p><img src="/../../img/nextjs-3/4.png"></p>
<p>이런 에러가 나온다</p>
<p>next.config.js를 수정해서 proxy 설정을 해 주었지만.<br>이 proxy 설정은 client 에서만 적용이 된다.<br>server component의 경우(기본값이 때) node에서 실행되고 있기 때문에 별도의 proxy 설정을 해 주어야 한다.</p>
<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/http-proxy-middleware">http-proxy-middleware</a> 같은 라이브러리를 사용해서 proxy 설정을 할 수 있지만 그렇게까지는 하지 않겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getPortfolioData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;/api/portfolio&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">ok</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Failed to fetch data&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getServerPortfolioData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;http:localhost:3000/api/portfolio&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!res.<span class="property">ok</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Failed to fetch data&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이번 경우에는 간단하게 api를 2개로 나누어서 작업해 주도록 하겠다.</p>
<p><img src="/../../img/nextjs-3/5.png"></p>
<p>데이터가 정상적으로 들어온 것을 확인했다.</p>
<hr>
<p>Next js 생각보다 생각해야 할 부분이 많다고 느꼈다.<br>최대한 많은 부분을 server component로 유지시키고 싶은데 고려해야 할 부분이 많은 것 같다.</p>
<p>최근 채용 공고에 백엔드에 대해서 잘 아는 사람이 우대사항에 적혀있는 걸 많이 보았는데.</p>
<p>단순하게 업무상 커뮤니케이션뿐만 아니라 Next js를 잘 사용하려면 백엔드 개발에 이해도가 많이 필요한 느낌을 받았다.<br>간단한 웹 서버 만들기, json 을 db처럼 사용해서 읽고 쓰기 말고는 잘 모르는데 백엔드에 대해서도 공부를 조금 해야 할 것 같다.</p>
<p>참고 : <a target="_blank" rel="noopener" href="https://nextjs.org/docs">https://nextjs.org/docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/25/React/nextjs-3/" data-id="cli34aptq000uj1jy9g3p52pb" data-title="Next.js 에 대해서 알아보자-3" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/ui-design-pattern" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/22/React/ui-design-pattern/" class="article-date">
  <time class="dt-published" datetime="2023-05-22T12:49:05.000Z" itemprop="datePublished">2023-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/22/React/ui-design-pattern/">react 디렉토리 구조에 대해서 알아보자.</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>디렉토리 구조는 프로젝트의 종류, 규모에 따라서 편한 디렉토리 구조가 바뀐다고 생각한다.</p>
<p>또한 규모가 커지면서 이전에는 편했던 구조들이 불편해질 수도 있다.<br>그래서 오늘 ui 디자인 패턴에 대해서 알아보려고 한다</p>
<ol>
<li>Container-Presentational 패턴</li>
<li>Atomic 패턴</li>
</ol>
<p>두가지 패턴을 알아보기 전에 각각의 비교를 위해서 간단한 화면을 예시로 구성해 보려 한다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;logo.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;Logo&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>아이디<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>비밀번호<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span>회사 정보<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이런 화면을 구성할 때 각각 패턴별 어떤 식으로 구성하는지 확인해 보도록 하자.</p>
<h3 id="Container-Presentational"><a href="#Container-Presentational" class="headerlink" title="Container-Presentational"></a>Container-Presentational</h3><p>Container-Presentational 패턴의 경우 기본적으로 디렉토리 구조는 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-src</span><br><span class="line">--components</span><br><span class="line">---Header</span><br><span class="line">        Header.tsx</span><br><span class="line">        index.ts</span><br><span class="line">---LoginForm</span><br><span class="line">        LoginForm.tsx</span><br><span class="line">        index.ts</span><br><span class="line">---Footer</span><br><span class="line">        Footer.tsx</span><br><span class="line">        index.ts</span><br><span class="line">--containers</span><br><span class="line">---MainPage</span><br><span class="line">        MainPage.tsx</span><br><span class="line">        index.ts</span><br></pre></td></tr></table></figure>

<p>Container-Presentational의 특징을 살펴보자.</p>
<p>이 패턴은 컴포넌트를 두 가지 유형으로 나누는 방법을 제공하여 역할과 책임을 명확하게 분리한다</p>
<h4 id="Container-Components"><a href="#Container-Components" class="headerlink" title="Container Components"></a>Container Components</h4><p>비즈니스 로직을 처리하고 상태를 관리하는 역할을 수행한다.<br>데이터를 가져오고 변경 사항을 업데이트하는 등의 작업을 처리한다.<br>UI 컴포넌트들을 조율하고 필요한 데이터와 콜백을 전달한다.</p>
<h4 id="Presentational-Components"><a href="#Presentational-Components" class="headerlink" title="Presentational Components"></a>Presentational Components</h4><p>UI를 표현하고 사용자에게 정보를 보여주는 역할을 수행한다.<br>주로 상태를 가지지 않고, 입력된 props를 받아 UI를 렌더링 한다.<br>재사용 가능하고 독립적인 컴포넌트로 설계되어야 한다.</p>
<p>따라서 위의 경우<br>components 는 Presentational Components<br>containers 는 Container Components가 된다</p>
<p>React hook 이 업데이트되기 전(심지어 업데이트된 후에도) 이 패턴을 많이 사용해서 프로젝트를 개발하였다.</p>
<p>하지만 React hook 이 업데이트된 다음부터는 굳이 이러한 패턴을 사용할 필요가 없다.</p>
<p>Presentational Components의 경우 Container Components는<br>상태 관리를 위해 주로 클래스 컴포넌트와 Higher-Order Component를 사용하는 경우가 많았다.</p>
<p>React Hooks가 도입된 후 함수형 컴포넌트에서도 상태 관리와 라이프사이클 관리가 편리해졌고 custom hooks를 생성할 수 있기 때문에 굳이 Container Components를 선언할 필요 없이 코드의 재사용 성과 가독성을 높일 수 있어졌다.<br>따라서 Container-Presentational 패턴의 필요성이 줄어들었다.</p>
<h3 id="Atomic"><a href="#Atomic" class="headerlink" title="Atomic"></a>Atomic</h3><p>Atomic 패턴의 경우 기본적으로 디렉토리 구조는 다음과 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-src</span><br><span class="line">--components</span><br><span class="line">---atoms</span><br><span class="line">----Logo</span><br><span class="line">        Logo.tsx</span><br><span class="line">        index.ts</span><br><span class="line">----TextInput/</span><br><span class="line">        TextInput.tsx</span><br><span class="line">        index.ts</span><br><span class="line">---molecules</span><br><span class="line">----LoginForm</span><br><span class="line">        LoginForm.tsx</span><br><span class="line">        index.ts</span><br><span class="line">---organisms</span><br><span class="line">----Header</span><br><span class="line">        Header.tsx</span><br><span class="line">        index.ts</span><br><span class="line">--templates</span><br><span class="line">---mainTemplate</span><br><span class="line">    mainTemplate.tsx</span><br><span class="line">--pages</span><br><span class="line">---MainPage</span><br><span class="line">    mainPage.tsx</span><br><span class="line">    index.ts</span><br></pre></td></tr></table></figure>

<p>아까 봤던 Container-Presentational 패턴 보다 훨씬 복잡해 보인다.<br>Atomic 패턴의 단점으로 이야기되는 복잡성, 학습 곡선, 과도한 분리 가<br>디렉토리 구조만 비교해 보아도 이해가 될 거 같다.</p>
<p>우선 atomic 패턴의 특징을 살펴보자</p>
<p>이 패턴은 컴포넌트를 다섯 가지 유형으로 나누는 방법을 제공한다.</p>
<ol>
<li>Atoms(원자): 원자는 UI의 가장 작은 단위로, 단일 기능을 수행하는 요소이다.<br>예를 들어, 버튼, 입력 필드, 레이블 등이 원자로 분류될 수 있다.</li>
<li>Molecules(분자): 분자는 원자 요소들이 결합하여 하나의 기능을 수행하는 요소이다.<br>예를 들어, 검색 폼은 텍스트 입력 필드와 검색 버튼이 결합한 분자로 볼 수 있다.</li>
<li>Organisms(유기체): 유기체는 더 큰 규모의 기능 또는 영역을 처리하는 요소이다.<br>예를 들어, 헤더, 사이드바, 카드 등이 유기체로 분류될 수 있다.<br>유기체는 원자와 분자를 포함할 수 있으며, 이들을 구성하여 완전한 기능을 제공합니다.</li>
<li>Templates(템플릿): 템플릿은 실제 컨텐츠가 채워질 수 있는 레이아웃 구조이다.<br>예를 들어, 웹 페이지의 레이아웃이나 앱의 스크린 디자인이 템플릿으로 볼 수 있습니다.</li>
<li>Pages(페이지): 페이지는 실제 컨텐츠가 채워진 완전한 UI 화면이다.</li>
</ol>
<p>이렇게 이론만 보았을 때 이해가 잘 안될 수도 있으니 예시를 좀 더 자세하게 분석해 보겠다. 상단에서 예시로 구성한 html 을 바탕으로 예시를 들겠다.</p>
<p>input, label, img 같은 친구들은 atoms에 해당한다.<br>이런 atoms를 조합하여 LoginForm이라는 Molecules 을 구성한다.<br>atoms, Molecules를 합쳐서 Organisms 을 구성할 수 있다.</p>
<p><del>위에 예시의 경우 Header는 logo img 하나만 존재하므로 Organisms보단 Molecules에 가까운 형태를 가지지만 Header에 nav 같은 다양한 기능이 포함될 수 있으므로 Organisms으로 만들어 주었다.</del></p>
<p>이제 atoms, Molecules, Organisms 을 바탕으로 레이아웃을 구성한 것을<br>Templates라고 부른다.</p>
<p>마지막으로 이런 Templates 에 데이터를 넣어주면 Pages 가 된다.</p>
<p>상당히 복잡한 구조를 가지고 있다.<br>그만큼 많은 단점을 가지고 있는 패턴이다.<br>앞서 이야기한 복잡성, 학습 곡선, 과도한 분리뿐만 아니라 유연성 제한<br>일관성 유지의 어려움 등 다양한 단점을 가지고 있다.</p>
<p>하지만 단점이 크면 장점도 크게 다가온다.<br>개인적인 생각으로 아토믹 패턴의 가장 큰 장점은 재사용성에 있다고 생각한다.<br>UI 구성 요소들을 필요에 따라 조합하여 다양한 화면을 만들 수 있으며 코드의 재사용성을 크게 높일 수 있다.</p>
<p>그리고 각각 컴포넌트를 작은 단위로 나누기 때문에 테스트를 진행할 때도 편리하다고 한다</p>
<p>오늘은 ui 디자인 패턴에 대해서 알아보았다. 위 2가지 말고 Component-Container(Container-Presentational 와 유사함)<br>등 많은 ui 디자인 패턴이 있다.</p>
<p>디렉토리를 구성할때는 위에 사항 뿐만아니라 style,api,state,type, constants 등 많은 요소가 추가 될수 있다<br>이런 디자인 패턴은 방법론일 뿐이므로 맹신 하지말고 항상 지금 상황에 맞고 편리하게 변형 시켜도 된다고 생각한다.</p>
<p>개인적으로 가장 중요하게 생각하는것은 일관성이다. 코드의 일관성이 보장되면<br>디자인 패턴을 고려하지않고 짠 코드라도 (간단한 프로젝트의경우) 유지보수가 크게 어렵지 않다고 생각한다.</p>
<hr>
<p>시각 자료 없이 글이 많다보니 가독성이 별로 좋지않아보인다.<br>나중에 여유가되면 실제로 컴포넌트들을 랜더링하여 시각자료를 추가하는게 좋을거같다.</p>
<p>참고 : <a target="_blank" rel="noopener" href="https://javascriptpatterns.vercel.app/patterns/react-patterns/conpres#overview">https://javascriptpatterns.vercel.app/patterns/react-patterns/conpres#overview</a></p>
<p><a target="_blank" rel="noopener" href="https://atomicdesign.bradfrost.com/table-of-contents/">https://atomicdesign.bradfrost.com/table-of-contents/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/22/React/ui-design-pattern/" data-id="cli05jggb000oj1jyekh6hedg" data-title="react 디렉토리 구조에 대해서 알아보자." class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/nextjs-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/18/React/nextjs-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-17T16:45:53.000Z" itemprop="datePublished">2023-05-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/18/React/nextjs-2/">Next.js 에 대해서 알아보자-2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>지난번에 Next.js에 대해서 가볍게 알아보았으니<br>이번에는 실제로 Next.js를 사용해 보려고 한다.</p>
<p>Next.js를 제대로 사용해보기 위해서는 간단한 view 가 아닌 제대로 동작하는 프로젝트가 필요할 것 같다. 겸사겸사 포트폴리오도 만들 겸 제대로 기획해서 사용해 보려고 한다.</p>
<p>항상 이렇게 되면 문제가 백엔드 서버를 구축하는 부분인데.<br>간단한 json 파싱 해서 데이터를 내려받는 데에는 문제가 없으나 로그인 인증 부분이 들어가면 골치 아파질 것 같다. 로그인 인증 부분은 백엔드에서 가짜로 처리하는 방법에 대해서 찾아보고 좋은 방법이 있으면 채택하도록 하겠다.</p>
<p>우선 어떤 서비스를 만들지는 모르겠으니 1차 목표는 다음과 같다.</p>
<p>next를 이용하여 웹페이지 구축<br>로그인된 유저와 로그인되지 않은 유저가 볼 수 있는 페이지를 나누어 보여주기.<br>데이터 패칭해서 리스트 view 보여주기 (swr, fetch, react-query 사용해 보기)</p>
<!-- tailwindcss 사용해 보기 -->

<p>state 관리는 recoil을 이용하기<br>jest로 testCode 작성하기<br><del>지갑의 여유가 있다면</del> githubAction을 사용해서 main에 merge 될 때 자동으로 test 실행하기<br>stroyboard 작성하여 component 관리하기(여유가 있다면 figma에도 연동을 해보려고 한다)</p>
<p>이렇게 작성하고 나니 next 가 메인이 아닌 거 같은 기분이 든다.<br>여하튼 바로 시작해 보도록 하겠다.</p>
<p>우선 document에 있는 Getting Started를 따라가도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx create-next-app@latest</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/nextjs-2/1.png"></p>
<p>생성해 보고 정말 놀랬다.<br>기존에 webpack 을 사용할 때에는 설정을 하는 데에 많은 시간을 소요했는데<br>심지어 alias까지 어떻게 설정할지 물어본다.<br>그리고 어떤 의존성 모듈을 설치했는지도 전부 보여준다.</p>
<p>그런데 모듈들이 전부 dependencies에 설치가 되었다.<br>실제 배포 후 runtime에 필요 없는 것들은 devDependencies로 옮겨주도록 하자</p>
<p>autoprefixer는 처음 보는 모듈이라 확인해 보니 PostCSS Plugin으로 보인다 이 친구도 devDependencies로 옮겨주도록 하자.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nextjs13-ground&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next start&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next lint&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;next&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.4.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20.1.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@types/react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@types/react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.40.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint-config-next&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.4.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.4.23&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tailwindcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.3.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoprefixer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.4.14&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>이제 package-lock.json 과 node_moudles를 삭제 후 다시 의존성 모듈을 설치해 주도록 하자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ npm run dev</span><br><span class="line">$ npm run lint</span><br><span class="line">$ npm run build</span><br><span class="line">$ npm run start</span><br></pre></td></tr></table></figure>

<p>정상 작동을 하니 inital 커밋을 진행해 준다.<br>project의 이름을 아직 정하지 못하여 우선 unNamed라는 레포지토리를 생성해 관리해 주도록 하겠다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gastroad/un-named">https://github.com/gastroad/un-named</a><br>initial commit 을 작성해 주었다.<br>좋은 기획이 나오지 않는다면 그냥 삭제하고 play-ground에 넣어야겠다.</p>
<p>이제 목적에 맞는 의존성 모듈을 설치해 주도록 하겠다.<br>recoil, jest, stroyboard, 기타 등등 을 설치해 주도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ npm install recoil</span><br><span class="line">$ npm install --save-dev jest</span><br><span class="line">$ npm install --save-dev @types/jest</span><br><span class="line">$ npm install --save-dev @testing-library/react</span><br><span class="line">$ npm install --save-dev @testing-library/jest-dom</span><br><span class="line">$ npm install --save-dev @testing-library/user-event</span><br><span class="line">$ npm install --save-dev @types/testing-library__jest-dom</span><br><span class="line">$ npm install --save-dev jest-environment-jsdom</span><br><span class="line">$ npx storybook@latest init</span><br></pre></td></tr></table></figure>

<p>next js에서 test를 하기 위해서 어떤 모듈을 어떻게 설치하는지에 대한 내용은 <a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/optimizing/testing">여기</a>에 자세히 나와있다.</p>
<p>나의 경우 npx create-next-app –example with-jest with-jest-app 을 통해서 생성한 뒤 지금 내 설정과 다른 부분을 추가해 주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;test&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;test 1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBe</span>(a);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>정말 간단한 테스트 코드를 작성해 보고 잘 작성이 되는 것을 확인했다.<br><del>rendering 관련해서는 확인해 보지 않았다.</del></p>
<p>이제 바로 레이아웃을 구성해 보도록 하자.</p>
<p><img src="/../../img/nextjs-2/3.png"></p>
<p>next document를 보면 컴포넌트는 다음과 같이 구성된다고 나와있다.<br>따라서 디렉토리를 다음과 같이 구성하려고 한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-app</span><br><span class="line">layout.tsx</span><br><span class="line">error.tsx</span><br><span class="line">loading.tsx</span><br><span class="line">--&#123;pagename&#125;</span><br><span class="line">  layout.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  page.tsx</span><br></pre></td></tr></table></figure>

<p>추후에 개발을 진행하면서 바뀔 수도 있지만 일단은 이런 식으로 구성하도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src</span></span><br><span class="line">-app</span><br><span class="line">layout.tsx</span><br><span class="line">error.tsx</span><br><span class="line">loading.tsx</span><br><span class="line">--&#123;pagename&#125;</span><br><span class="line">  layout.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  page.tsx</span><br><span class="line"></span><br><span class="line">-component</span><br><span class="line"></span><br><span class="line">-state</span><br><span class="line">--atoms</span><br><span class="line">--selectors</span><br><span class="line"></span><br><span class="line">-utils</span><br></pre></td></tr></table></figure>

<p>이제 stories, test, style, types를 어디에 위치시킬 건지만 고민하면 될 것 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src</span></span><br><span class="line">-app</span><br><span class="line">  layout.tsx</span><br><span class="line">  error.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  app.css</span><br><span class="line">  -&#123;pagename&#125;</span><br><span class="line">    layout.tsx</span><br><span class="line">    loading.tsx</span><br><span class="line">    page.tsx</span><br><span class="line">    &#123;pagename&#125;.css</span><br><span class="line">    &#123;pagename&#125;.test.ts</span><br><span class="line">-component</span><br><span class="line">  &#123;componentname&#125;.css</span><br><span class="line">  &#123;componentname&#125;.stories</span><br><span class="line">  &#123;componentname&#125;.test.ts</span><br><span class="line">-state</span><br><span class="line">  -atoms</span><br><span class="line">    &#123;atomname&#125;.ts</span><br><span class="line">  -selectors</span><br><span class="line">    &#123;selectorname&#125;.ts</span><br><span class="line">-utils</span><br><span class="line">-types</span><br><span class="line">-api</span><br></pre></td></tr></table></figure>

<p>최종적으로 이런 형태를 생각하고 있다.</p>
<p>이제 본격적으로 개발을 해보도록 하자. 이번 프로젝트에서는 recoil을 사용할 예정이니 recoil이 잘 되는지부터 확인을 해보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/layout.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> metadata = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;un-named&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode,</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;ko&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// src/state/atoms/testAtoms.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; atom &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> testState = <span class="title function_">atom</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;testState&quot;</span>,</span><br><span class="line">  <span class="attr">default</span>: <span class="string">&quot;recoil is working&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; testState &#125; <span class="keyword">from</span> <span class="string">&quot;../state/atoms/testAtom&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilState &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [testStateValue, setTestStateValue] = <span class="title function_">useRecoilState</span>(testState)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setTestStateValue</span>(<span class="string">&quot;well&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(testStateValue)</span><br><span class="line">  &#125;, [testStateValue])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      home</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>정상 작동되길 바랐지만…</p>
<p><img src="/../../img/nextjs-2/4.png"></p>
<p>콘솔을 확인해 보니 난리가 났다.</p>
<p>에러 로그를 읽어보면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Uncaught createContext only works in Client Components.</span><br><span class="line">Add the &quot;use client&quot; directive at the top of the file to use it.</span><br><span class="line">Read more: https://nextjs.org/docs/messages/context-in-server-component</span><br></pre></td></tr></table></figure>

<p>createContext는 Client Components 에서만 작동한다.<br>파일 상단에 “use client”를 추가해라<br>Read more: <a target="_blank" rel="noopener" href="https://nextjs.org/docs/messages/context-in-server-component">https://nextjs.org/docs/messages/context-in-server-component</a></p>
<p>라고 적혀있다.<br>우선 read more 을 확인해 보니 use client 추가하라는 말 말고<br>별 이야기가 없다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/getting-started/react-essentials#context">Useful Links</a>를 확인해보니<br><del>read more 에 read more 가 있다..!</del></p>
<blockquote>
<p>In Next.js 13, context is fully supported within Client Components, but it cannot be created or consumed directly within Server Components</p>
</blockquote>
<p>Client Components에서는 context 가 완전하게 지원하지만<br>Server Components에서는 생성하거나 consumed 할 수 없다고 한다.</p>
<p>일단 Server Components 내부적으로 context api를 사용하는 라이브러리는 사용하지 못한다고 이해를 했다.<br>recoil 또한 내부적으로 context api를 이용하니 이러한 문제가 발생한 거 같다.</p>
<p>그래서 next에서 제안한 방법은 다음과 같다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/RecoilRootProvider/RecoilRootProvider.tsx</span></span><br><span class="line"><span class="string">&#x27;use client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">ReactNode</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RecoilRootProvider</span>(<span class="params">&#123; children &#125;: Props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/app/layout.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RecoilRootProvider</span> <span class="keyword">from</span> <span class="string">&quot;../components/RecoilRootProvider&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> metadata = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;un-named&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;ko&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RecoilRootProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">RecoilRootProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="string">&#x27;use client&#x27;</span>; <span class="comment">// 최상단에 추가</span></span><br></pre></td></tr></table></figure>

<p>provide 하는 컴포넌트를 Client Component로 만들어서 감싸주라고 한다.<br>이제 recoil 이 정상작동하는 것을 확인할 수 있다.</p>
<p>next를 사용해 보니 alias 설정이 엄청 필요할 것 같다.<br>routing을 디렉토리 구조를 바탕으로 하다 보니 이곳저곳에서 컴포넌트들을 가져오기 상당히 번거로웠다.<br>다음엔 alias 설정부터 하면서 포스팅을 시작해야겠다.</p>
<p>use client도 조금 더 확인을 해보고 싶은 부분이 있다.<br>2번째 사진을 보면 next 컴포넌트를 어떻게 구성하는지 나오는데<br>use client 동작 방식에 이해가 가지 않는 부분이 조금 있다.<br>이 부분은 확인하고 확실히 정리된 다음 여기에 포스트를 추가하도록 하겠다.</p>
<hr>
<p>2023.05.18</p>
<p>우선 App 라우터 안에 있는 모든 컴포넌트들은 기본적으로 Server Component이다.<br>지시문 use client를 통해서 Client Component로 만들 수 있다.</p>
<blockquote>
<p>“use client” does not need to be defined in every file. The Client module boundary only needs to be defined once, at the “entry point”, for all modules imported into it to be considered a Client Component.</p>
</blockquote>
<p>use client를 사용하면 그 아래에 있는 컴포넌트들은 전부 Client Component가 된다.</p>
<p>여기서 이해가 되지 않는 부분이 생긴다.</p>
<p>recoil 같이 전역으로 context를 사용하기 위해서 provider에 use client를 사용하면 recoil porvider 아래에 있는 모든 컴포넌트는 Client Component가 되어야 하는 게 아닌가?라는 생각이 들었다.</p>
<p>그렇다고 하면 지금 내가 한 것처럼 레이아웃을 구성한다면<br>3번째 이미지에 따라 app 디렉토리의 구성요소 빼고 전부 Client Component가 되어버린다.</p>
<p>그렇지만 실제로 확인해 보니 app&#x2F;page.tsx 가 Client Component가 아니었다.</p>
<p>정확하게는 아래와 같은 에러가 발생했다.</p>
<blockquote>
<p>You’re importing a component that needs useEffect. It only works in a Client Component but none of its parents are marked with “use client”, so they’re Server Components by default.</p>
</blockquote>
<p>useEffect 는 Client Component 에서 만 사용할수있는데 부모 에서 use client 를 사용하는 부분이 없다는것이다. 그렇기 때문에 이 컴포넌트는 Server Components 라고한다.</p>
<p>document를 살펴보아도 잘 이해가 되지 않아서 언제 한번 날 잡고 document 정독을 해야 할 것 같다.</p>
<p><img src="/../../img/nextjs-2/5.png"></p>
<p>Server Component, Client Component를 어떨 때 사용해야 하는지<br>보여주는 표이다 내용을 보면</p>
<p>프론트엔드에서 작업하는 대부분은 Client Component를 사용해야 한다.<br>컴포넌트 기반 아키텍처로 디렉토리를 구성했는데 조금 다른 방법을 사용하는 게 더 나을 거 같다는 생각을 했다.<br>(최대한 많은 component를 Server Component로 만들기 위해)</p>
<p>우선 next 자체를 처음 써보는 만큼 이것저것 많은 시도와 진행하면서 조금 더 편한 구조를 찾아보도록 하겠다.</p>
<p>참고: <a target="_blank" rel="noopener" href="https://nextjs.org/docs">https://nextjs.org/docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/18/React/nextjs-2/" data-id="clhqi9snk000fj1jy1u1jh2xk" data-title="Next.js 에 대해서 알아보자-2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/nextjs-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/15/React/nextjs-1/" class="article-date">
  <time class="dt-published" datetime="2023-05-15T13:35:32.000Z" itemprop="datePublished">2023-05-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/15/React/nextjs-1/">Next.js 에 대해서 알아보자-1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 Next.js (이하 next라고 표현하겠다.)에 대해 알아보려고 한다.</p>
<p>우선 나는 next를 실무에서 사용해 본 적은 없다<br>기존에 12버전 일 때 간단하게 서버사이드에서 데이터를 받아오는 법 동적 라우팅하는 법 정도만 알아보았었는데.<br>이번에 13에 대해 공부할 겸 조금 더 깊이 알아보려고 한다.</p>
<p>우선 next가 어떤 일을 하는 친구인지부터 알아보자.</p>
<blockquote>
<p>The React Framework for the Web<br>웹을 위한 react 의 Framework</p>
</blockquote>
<p><img src="/../../img/nextjs-1/1.png"></p>
<p>공식 document를 보면 다음과 같은 기능을 지원한다고 나와있다.</p>
<p>우선 하나하나 살펴보겠다.</p>
<h3 id="Built-in-Optimizations"><a href="#Built-in-Optimizations" class="headerlink" title="Built-in Optimizations"></a>Built-in Optimizations</h3><p>내장된 최적화<br>UX 및 Core Web Vitals 개선을 위한 자동 이미지, 글꼴 및 스크립트 최적화.</p>
<p>next에서는 이미지, 글꼴 및 스크립트 최적화를 위한 기능들을 몇 가지 제공한다</p>
<h4 id="이미지"><a href="#이미지" class="headerlink" title="이미지"></a>이미지</h4><p>이미지 컴포넌트를 제공하여 이미지를 렌더링 할 때 자동으로 최적화된 이미지를 제공한다.<br>이를 통해 사용자에게 필요한 이미지만 로드하고, 이미지의 크기를 줄여 로딩 속도를 향상시킨다.<br>이미지 최적화를 위해 자동으로 웹 P, JPEG, PNG 등의 형식을 선택하고<br>이미지 리사이징, 레이지 로딩 등의 기능을 제공한다.<br>심지어 layout shift를 줄이기 위한 기능도 제공하는 것으로 알고 있다.</p>
<h4 id="폰트"><a href="#폰트" class="headerlink" title="폰트"></a>폰트</h4><p>로컬 폰트 파일을 사용하여 폰트를 로드할 수 있다.<br>이를 통해 사용자가 폰트 파일을 미리 다운로드하고 캐시 할 수 있으며, 페이지 로딩 시간을 최적화할 수 있다.</p>
<h4 id="스크립트"><a href="#스크립트" class="headerlink" title="스크립트"></a>스크립트</h4><p>코드 스플리팅과 자동 프리 패칭을 지원하여 스크립트 최적화를 지원한다.</p>
<p>코드 스플리팅 이란<br>자바스크립트 파일을 분할하여 필요한 시점에 로드할 수 있도록 한다<br>이를 통해 초기 페이지 로딩 속도를 개선하고, 사용자가 필요하지 않은 코드를 로드하지 않도록 한다</p>
<p>자동 프리 패칭 이란<br>다음에 방문할 가능성이 있는 페이지를 사전에 자동으로 프리 패치(prefetch) 한다.<br>이를 통해 사용자가 실제로 해당 페이지로 이동하기 전에 필요한 자원을 미리 로드하여 페이지 전환 시간을 최소화한다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/optimizing">https://nextjs.org/docs/pages/building-your-application/optimizing</a></p>
<h3 id="Dynamic-HTML-Streaming"><a href="#Dynamic-HTML-Streaming" class="headerlink" title="Dynamic HTML Streaming"></a>Dynamic HTML Streaming</h3><p>동적 HTML 스트리밍<br>next 및 Vercel을 사용한 HTML 스트리밍으로 그 어느 때보다 빠르게 컨텐츠 제공</p>
<p>next를 사용하는 대표적인 이유일 것이라고 생각한다.</p>
<p>Dynamic HTML Streaming을 사용하면, 서버에서 컨텐츠를 빠르게 streaming 하고, 브라우저에서는 컨텐츠를 받으면서 동시에 렌더링 할 수 있다.<br>이렇게 함으로써, 사용자는 빠르게 페이지를 로드하고, 서버에서도 처리가 완료된 부분부터 빠르게 응답을 보낼 수 있으므로, 더 나은 사용자 경험을 제공할 수 있다.</p>
<p>또한 next는 Vercel이라는 서비스를 통해 배포할 수 있다.<br>Vercel에 대해서는 나중에 알아보도록 하겠다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/getting-started/react-essentials">https://nextjs.org/docs/getting-started/react-essentials</a></p>
<h3 id="React-Server-Components"><a href="#React-Server-Components" class="headerlink" title="React Server Components"></a>React Server Components</h3><p>React 서버 Components<br>서버 우선. 직관적인 파일 시스템 라우터를 통한 레이아웃 및 스트리밍.</p>
<p>React Server Components를 사용하면 레이아웃이나 페이지의 일부를 서버에서 처리하고, 동적인 컨텐츠를 서버 렌더링 하여 초기 로딩 성능을 향상시킬 수 있다.<br>이를 통해 사용자는 더 빠르고 부드러운 사용자 경험을 얻을 수 있고, 개발자는 간단하고 직관적인 라우팅 및 SSR 개발을 할 수 있다고 한다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/building-your-application/rendering">https://nextjs.org/docs/app/building-your-application/rendering</a></p>
<h3 id="Data-Fetching"><a href="#Data-Fetching" class="headerlink" title="Data Fetching"></a>Data Fetching</h3><p>데이터 Fetching<br>서버에서 실행되고 다양한 방식으로 콘텐츠를 렌더링 할 수 있는 데이터 Fetching 방법입니다.</p>
<p>next는 서버 측에서 실행되는 데이터 패칭(Data Fetching) 방법을 제공한다.<br>이를 통해 외부 API, 데이터베이스 또는 기타 데이터 소스에서 데이터를 가져와 next 애플리케이션에 적용할 수 있다.</p>
<p>이 외에도 다양한 데이터 패칭을 지원하고 있다. 필요한 상황에 하나씩 확인해 보도록 하자.<br><img src="/../../img/nextjs-1/2.png"></p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/data-fetching">https://nextjs.org/docs/pages/building-your-application/data-fetching</a></p>
<h3 id="CSS-Support"><a href="#CSS-Support" class="headerlink" title="CSS Support"></a>CSS Support</h3><p>CSS 지원<br>CSS Modules, Sass, PostCSS, CSS-in-JS. 지원</p>
<p>next는 애플리케이션 스타일을 지정하는 다양한 방법을 지원한다.</p>
<p>Global CSS, CSS Modules, Tailwind CSS, Sass, CSS-in-JS</p>
<p>이번에 next로 공부하면서 Tailwind CSS 도 한번 다뤄보도록 하겠다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/styling">https://nextjs.org/docs/pages/building-your-application/styling</a></p>
<h3 id="Client-and-Server-Rendering"><a href="#Client-and-Server-Rendering" class="headerlink" title="Client and Server Rendering"></a>Client and Server Rendering</h3><p>클라이언트 및 서버 렌더링<br>페이지당 수준에서 ISR을 포함한 유연한 렌더링 및 캐싱 옵션.</p>
<p>Data Fetching과 같은 document로 넘어간다 이에 대해서도 필요한 상황에 하나씩 확인해 보도록 하자.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/data-fetching">https://nextjs.org/docs/pages/building-your-application/data-fetching</a></p>
<h3 id="Node-js-and-Edge-Runtimes"><a href="#Node-js-and-Edge-Runtimes" class="headerlink" title="Node.js and Edge Runtimes"></a>Node.js and Edge Runtimes</h3><p>Node.js 및 Edge 런타임<br>서버리스 functions으로 확장 가능한 솔루션 구축,<br>Edge를 통해 fast dynamic, personalized content 제공.</p>
<p>next는 Node.js, Edge에서 동작 가능하다.</p>
<p>각각 런타임 별로 어떤 차이점이 있는지에 대해서도 자세하게 설명하고 있다.<br><img src="/../../img/nextjs-1/3.png"></p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes">https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes</a></p>
<h3 id="API-Routes"><a href="#API-Routes" class="headerlink" title="API Routes"></a>API Routes</h3><p>API 라우트<br>third party services 와 안전하게 연결하기 위한 API 엔드 포인트 구축<br>하여 프론트엔드에서 사용</p>
<p>API Routes를 사용하면 서버 측에서 API 엔드 포인트를 정의하고 처리할 수 있다.<br>이는 클라이언트 사이드 코드에서 외부 서비스와 통신하기 위한 중간 단계로 작동합니다.<br>API Routes를 통해 다양한 데이터 소스와 통신하고, 데이터를 가져오거나 업데이트하거나 삭제하는 등의 작업을 수행할 수 있다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/routing/api-routes">https://nextjs.org/docs/pages/building-your-application/routing/api-routes</a></p>
<h3 id="Powerful-Routing-and-Layouts"><a href="#Powerful-Routing-and-Layouts" class="headerlink" title="Powerful Routing and Layouts"></a>Powerful Routing and Layouts</h3><p>강력한 라우팅 및 레이아웃<br>복잡한 인터페이스를 구축하고 더 적은 JavaScript를 제공.</p>
<p>next는 강력한 라우팅 및 레이아웃을 제공한다<br><img src="/../../img/nextjs-1/4.png"></p>
<p>Tree: 계층 구조를 시각화하기 위한 규칙이다<br>예를 들어 부모 및 자식 구성 요소가 있는 구성 요소 트리, 폴더 구조 등이 있다<br>Subtree: 새 루트(첫 번째)에서 시작하여 리프(마지막)에서 끝나는 트리의 일부<br>Root: 루트 레이아웃과 같은 트리 또는 하위 트리의 첫 번째 노드<br>Leaf: 경로의 마지막 세그먼트와 같이 자식이 없는 하위 트리의 노드</p>
<p><img src="/../../img/nextjs-1/5.png"></p>
<p>URL Segment: 슬래시로 구분된 URL 경로의 일부<br>URL path: 도메인 뒤에 오는 URL의 일부(Segment로 구성)</p>
<p>next 13부터는 app이라는 새로운 App Router가 도입되었다.<br>공유 레이아웃, 중첩 라우팅, 로딩 상태, 오류 처리 등을 지원한다</p>
<p>기존에 next를 사용하지 않았던 큰 이유 중에 하나가. header nav 같은 컴포넌트들을 다 추가해 주어야 하는 번거로움이 있어서였는데<br>공유 레이아웃 기능을 이제 지원한다고 하니 안 써볼 이유가 없다고 생각한다.<br>기존에 pages 도 지원한다고 한다 다만 app 이 routing 우선순위가 높다고 하니 리팩토링도 부담 없이 진행할 수 있겠다는 생각이 들었다.</p>
<p>이 부분에 대해서는 추후에 한 번 더 자세하게 다루도록 하겠다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/app/building-your-application/routing">https://nextjs.org/docs/app/building-your-application/routing</a></p>
<h3 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h3><p>미들웨어<br>인증, A&#x2F;B 테스트 및 현지화를 위해 요청이 완료되기 전에 코드를 실행</p>
<p>미들웨어는 클라이언트의 요청이 핸들러에 도달하기 전에 중간 단계에서 실행되는 함수이다.<br>이 함수는 요청 객체와 응답 객체에 접근하여 필요한 작업을 수행한다.</p>
<p>이를 통해서 인증, A&#x2F;B 테스트 및 현지화 등의 작업을 처리할 수 있다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/routing/middleware">https://nextjs.org/docs/pages/building-your-application/routing/middleware</a></p>
<hr>
<p>next에 대해서 알아보니 생각보다 많은 기능을 지원해서 놀랐다.<br>최근 회사 들의 지원 자격에 next 가 적혀있었는데 왜 그런지 알 거 같았다.<br>react-router처럼 필요할 때 그냥 필요한 부분만 공부해서 사용하면 되지 않을까라는 생각을 하고 있었는데 그 정도로는 쉽지 않을 것 같다.</p>
<p>react-router 도 ssr 지원을 하는 기능들이 추가되었다고 해서 조만간 알아봐야겠다 싶었는데 next부터 확실하게 공부를 하고 넘어가야겠다.</p>
<p>이전에 csr 이면 react-router ssr 이면 next라고 생각하고<br>ssr이 필요 없는 업무(주로 백오피스, 앱스토어를 통해 판매되는 sass 서비스)를 하다 보니 next에 대해 관심이 너무 없었다.<br>지금이라도 관심을 가지고 제대로 알아보도록 하겠다.</p>
<p>추가로 포스트를 작성하고 나니 그냥 공식 document를 복붙한 느낌을 강하게 받았다.<br>그렇다고 자세하게 복붙해온것도 아닌 굉장히 러프하게 가져온 것 같은 느낌이 든다.<br>다루어야 하는 양이 많아 자세하게 확인하기 너무 피곤하다는 느낌을 받아<br>이후에 포스팅을 할 때에는 주제를 조금 더 세밀하게 나누어서 자세하게 다루는 식으로 포스팅을 해야겠다.</p>
<p>참고: <a target="_blank" rel="noopener" href="https://nextjs.org/docs">https://nextjs.org/docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/15/React/nextjs-1/" data-id="clhqbh3710005j1jydxsu2xz7" data-title="Next.js 에 대해서 알아보자-1" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/flux-4" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/10/React/flux-4/" class="article-date">
  <time class="dt-published" datetime="2023-05-10T09:46:50.000Z" itemprop="datePublished">2023-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/10/React/flux-4/">redux vs recoil 3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 recoil을 사용해서 간단한 Counter, 비동기통신 테스트 코드를 작성해 보려고 한다.</p>
<p>최근 테스트 코드를 많이 작성하다 보니 TDD에도 관심이 생기는데 다음번에 TDD 방식으로 개발을 진행해 보도록 하겠다.</p>
<p>여하튼 바로 recoil 을 사용해 보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.tsx&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>이전 redux provider를 생성해줄때 recoilRoot도 같이 선언해 두었다.<br>따라서 바로 atom과 selector 를 생성해 보도록 하자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-recoil</span></span><br><span class="line"><span class="comment">// --counter</span></span><br><span class="line"><span class="comment">// atoms.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; atom &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterState = <span class="title function_">atom</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;counterState&quot;</span>,</span><br><span class="line">  <span class="attr">default</span>: <span class="number">0</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//-recoil</span></span><br><span class="line"><span class="comment">// --counter</span></span><br><span class="line"><span class="comment">// selectors.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; selector &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterState &#125; <span class="keyword">from</span> <span class="string">&quot;./atoms&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSelector = <span class="title function_">selector</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;counterSelector&quot;</span>,</span><br><span class="line">  <span class="attr">get</span>: <span class="function">(<span class="params">&#123; get &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(counterState);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>당연히 key 는 unique 하게 작성해 두어야 한다.<br>default 에는 초기값을 선언해둔다 <del>redux 에 initalState라 생각하면 편하다</del></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RecoilCounter.tsx</span></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilState, useRecoilValue &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterState &#125; <span class="keyword">from</span> <span class="string">&quot;./recoil/counter/atoms&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterSelector &#125; <span class="keyword">from</span> <span class="string">&quot;./recoil/counter/selectors&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RecoilCounter</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useRecoilState</span>(counterState);</span><br><span class="line">  <span class="keyword">const</span> counterValue = <span class="title function_">useRecoilValue</span>(counterSelector);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setValue</span>(value + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleDecreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setValue</span>(value - <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;counterValue&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncreaseButtonClick&#125;</span>&gt;</span>inc<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleDecreaseButtonClick&#125;</span>&gt;</span>dec<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RecoilCounter</span>;</span><br></pre></td></tr></table></figure>

<p>recoil 을 사용하여 counter를 만들어 주었다.<br>useRecoilState를 이용하여 counterState의 값을 읽고 쓰기 하고<br>useRecoilValue를 이용하여 counterSelector가 return 하는<br>get(counterState)를 읽는다.</p>
<p>recoil의 atom을 사용하니 정말 useState를 사용하는 것처럼 useRecoilState를 하기 때문에 크게 공부할 부분도 없고 정말 간단하게 사용할 수 있다.</p>
<p>여기서 처음 recoil을 공부했을 때 생긴 의문이<br>useRecoilValue를 통해서 counterState를 읽어오고 있는데<br>useRecoilState를 사용하면 읽고 쓰기 다 할 수 있는데 굳이 selector를 만들 필요가 있나?라는 어리석은 생각을 했었다.</p>
<p>useRecoilState를 사용하면 atom에 대해 값을 읽거나 쓸 수 있다.<br>그러나 atom에 여러 개의 필드가 있고, 이 중 일부 필드만 사용하는 컴포넌트가 있다면 해당 컴포넌트가 불필요하게 리렌더링되는 문제가 발생할 수 있다.<br>하지만 selector를 사용하게 된다면 atom이나 다른 selector의 필요한 값만 읽어와 불필요한 리렌더링을 막을 수 있다.<br><del>redux도 동일한데 redux 공부할떄는 왜 이런생각이 안들었을까</del></p>
<p>이제 비동기 작업을 해보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-recoil</span></span><br><span class="line"><span class="comment">// --protfolio</span></span><br><span class="line"><span class="comment">// selectors.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; selector &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../../api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchPortfolioList = <span class="title function_">selector</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;portfolio/fetchPortfolioList&quot;</span>,</span><br><span class="line">  <span class="attr">get</span>: <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// RecoilAsync</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./recoil/portfolio/selectors&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilValue &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RecoilAsync</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolioList = <span class="title function_">useRecoilValue</span>(fetchPortfolioList);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((portfolio, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;portfolio.title&#125;<span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RecoilAsync</span>;</span><br></pre></td></tr></table></figure>

<p>이렇게 하면 api를 통해서 비동기적으로 데이터를 받아 render 해줄 수 있다.<br>그런데 개발자 도구를 보면 에러가 하나 나타나 있을 것이다.</p>
<p><img src="/img/flux-4/1.png"></p>
<p>렌더링 중에 비동기 작업을 수행하고 비동기 작업이 완료되기 전 컴포넌트가 마운트 되었을 때 이러한 에러가 나타난다.<br>간단하게 React 렌더링 순서에 맞지 않아서 나타나는 에러이다.</p>
<p>이를 해결하기 위해서는 몇 가지 방법이 있는데<br>recoil에서 제공하는 Loadable 기능을 사용하거나 react의 Suspense를 사용하는 방법이 있다.</p>
<p>예전에 recoil 을 공부했을 때는 suspense가 정식 릴리스 되지 않아서 Loadable을 사용했었다.<br>react18 에서부터 정식으로 지원하기 시작해서 이번 기회에 suspense를 사용하는 것도 알아보려 한다.</p>
<p>우선 Loadable 기능을 사용해서 해결하는 방법부터 살펴보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./recoil/portfolio/selectors&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilValueLoadable &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RecoilAsync</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolioListLoadable = <span class="title function_">useRecoilValueLoadable</span>(fetchPortfolioList);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (portfolioListLoadable.<span class="property">state</span> === <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>loading<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (portfolioListLoadable.<span class="property">state</span> === <span class="string">&quot;hasError&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>hasError<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioListLoadable.contents.map((portfolio, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;portfolio.title&#125;<span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RecoilAsync</span>;</span><br></pre></td></tr></table></figure>

<p>useRecoilValueLoadable은 state와 contents 값을 가진다.<br>state의 타입은 “loading”,”hasError”,”hasValue”이다<br>따라서 각각 state에 맞는 화면을 렌더링 해주면 된다.</p>
<p>이제 suspense를 이용해서 비동기 작업을 처리해 보도록 하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RecoilAsyncSuspense.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span>, <span class="variable constant_">FC</span>, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./recoil/portfolio/selectors&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilValue &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">PortfolioList</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolioList = <span class="title function_">useRecoilValue</span>(fetchPortfolioList);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((portfolio, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;portfolio.title&#125;<span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">RecoilAsyncSuspense</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;&gt;</span>Loading<span class="tag">&lt;/&gt;</span></span>&#125;&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">PortfolioList</span> /&gt;</span></span></span><br><span class="line">    &lt;/<span class="title class_">Suspense</span>&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">RecoilAsyncSuspense</span>;</span><br></pre></td></tr></table></figure>

<p>이런 식으로 작성할 경우 useRecoilValueLoadable의 “loading”,”hasError” 상태일 땐 Suspense fallback이 보이고 “hasValue” 일 땐 PortfolioList 가 보인다. hasError에 대한 처리도 하고 싶다면 errorBoundary 같은 컴포넌트를 만들어서 처리할 수도 있지만.<br>지금은 거기까지 다루지는 않겠다.</p>
<p>이제 마지막으로 테스트 코드를 작성해 보도록 하겠다.</p>
<p>우선 recoil 테스트를 위해 @testing-library&#x2F;react를 설치해 주었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev @testing-library/react</span><br></pre></td></tr></table></figure>

<p>그 이후 아래와 같이 테스트 코드를 작성하였다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// counter.test.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; renderHook, act &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="title class_">RecoilRoot</span>,</span><br><span class="line">  useRecoilValue,</span><br><span class="line">  useRecoilState,</span><br><span class="line">  useSetRecoilState,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterState &#125; <span class="keyword">from</span> <span class="string">&quot;../counter/atoms&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; counterSelector &#125; <span class="keyword">from</span> <span class="string">&quot;../counter/selectors&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;counterAtom&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should update the value of counter atom&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; result &#125; = <span class="title function_">renderHook</span>(<span class="function">() =&gt;</span> <span class="title function_">useRecoilState</span>(counterState), &#123;</span><br><span class="line">      <span class="attr">wrapper</span>: <span class="title class_">RecoilRoot</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// recoil은 recoilRoot안에서 실행되어야 하기떄문에 wrapper로 감싸주었다.</span></span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = result.<span class="property">current</span>;</span><br><span class="line">    <span class="title function_">expect</span>(value).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// react의 상태가 변경된후 컴포넌트가 다시 랜더링되는 작업은 비동기적으로 이뤄지기 때문에</span></span><br><span class="line">    <span class="comment">// act 를 이용하여 동기적으로 작업하게 해주었다.</span></span><br><span class="line">    <span class="title function_">act</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setValue</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(result.<span class="property">current</span>[<span class="number">0</span>]).<span class="title function_">toBe</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;counterSelector&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should return the value of counterState&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">result</span>: atomResult &#125; = <span class="title function_">renderHook</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="title function_">useSetRecoilState</span>(counterState),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">wrapper</span>: <span class="title class_">RecoilRoot</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">result</span>: selectorResult &#125; = <span class="title function_">renderHook</span>(</span><br><span class="line">      <span class="function">() =&gt;</span> <span class="title function_">useRecoilValue</span>(counterSelector),</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">wrapper</span>: <span class="title class_">RecoilRoot</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">const</span> setValue = atomResult.<span class="property">current</span>;</span><br><span class="line">    <span class="title function_">expect</span>(selectorResult.<span class="property">current</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_">act</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setValue</span>(<span class="number">10</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 이 부분에 대한 확인이 필요하다 state 의 value 를 10으로 변경한 후</span></span><br><span class="line">    <span class="comment">// selectorResult 를 사용하게 되면 Received: 0 이 된다</span></span><br><span class="line">    <span class="comment">// 시험삼아 다시한번 선언해 보니 Received: 10 이 되긴했는데</span></span><br><span class="line">    <span class="comment">// 왜 이렇게 동작했는지는 추후에 다시 확인해 보고 개선해 두도록 하겠다.</span></span><br><span class="line">    <span class="comment">// 추가로 테스트 자체도 나눠두도록 해야겠다.</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">result</span>: test &#125; = <span class="title function_">renderHook</span>(<span class="function">() =&gt;</span> <span class="title function_">useRecoilValue</span>(counterSelector), &#123;</span><br><span class="line">      <span class="attr">wrapper</span>: <span class="title class_">RecoilRoot</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title function_">expect</span>(test.<span class="property">current</span>).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ++  recoil 공식 document 에서는 아래와 같은 방법을 제시한다.</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;test counterSelector v2&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> initialSnapshot = <span class="title function_">snapshot_UNSTABLE</span>();</span><br><span class="line">  <span class="title function_">expect</span>(initialSnapshot.<span class="title function_">getLoadable</span>(counterSelector).<span class="title function_">valueOrThrow</span>()).<span class="title function_">toBe</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> testSnapshot = <span class="title function_">snapshot_UNSTABLE</span>(<span class="function">(<span class="params">&#123; set &#125;</span>) =&gt;</span> <span class="title function_">set</span>(counterState, <span class="number">1</span>));</span><br><span class="line">  <span class="title function_">expect</span>(testSnapshot.<span class="title function_">getLoadable</span>(counterSelector).<span class="title function_">valueOrThrow</span>()).<span class="title function_">toBe</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 다만 snapshot 이 아직 UNSTABLE 이라 사용하기엔 다소 찜찜했다.</span></span><br></pre></td></tr></table></figure>

<p>이해가 부족한 탓에 counterSelector 테스트 코드가 조금 이상한 부분이 있다. 이 부분은 나중에 다시 한번 확인해서 개선하도록 하겠다.</p>
<p>이제 비동기 작업에 대한 테스트 코드도 작성해 주도록 하겠다.<br>결론부터 말하면 test code 작성에 실패하였다..</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; renderHook, waitFor &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span>, useRecoilValue &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MockAdapter</span> <span class="keyword">from</span> <span class="string">&quot;axios-mock-adapter&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../portfolio/selectors&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../../api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;fetchPortfolioList&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should return the correct portfolio list&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> mock = <span class="keyword">new</span> <span class="title class_">MockAdapter</span>(axios);</span><br><span class="line">    mock.<span class="title function_">onGet</span>(<span class="string">&quot;/portfolio&quot;</span>).<span class="title function_">reply</span>(<span class="number">200</span>, &#123;</span><br><span class="line">      <span class="attr">portfolio</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">img</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">title</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">paragraph</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; result &#125; = <span class="title function_">renderHook</span>(<span class="function">() =&gt;</span> <span class="title function_">useRecoilValue</span>(fetchPortfolioList), &#123;</span><br><span class="line">      <span class="attr">wrapper</span>: <span class="title class_">RecoilRoot</span>,</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">waitFor</span>(<span class="function">() =&gt;</span> result.<span class="property">current</span> !== <span class="literal">undefined</span>);</span><br><span class="line">    <span class="title function_">expect</span>(result.<span class="property">current</span>).<span class="title function_">toEqual</span>(<span class="title function_">getPortfolioList</span>());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 다른 방법</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; snapshot_UNSTABLE &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../portfolio/selectors&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../../api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;fetchPortfolioList&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> initialSnapshot = <span class="title function_">snapshot_UNSTABLE</span>();</span><br><span class="line">  <span class="keyword">const</span> release = initialSnapshot.<span class="title function_">retain</span>();</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(initialSnapshot.<span class="title function_">getLoadable</span>(fetchPortfolioList).<span class="title function_">valueOrThrow</span>()).<span class="title function_">toBe</span>(</span><br><span class="line">      <span class="title function_">getPortfolioList</span>()</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="title function_">release</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>두 방법을 사용해서 시도해 보았는데 결국 통과하지 못하였다.</p>
<p>시간을 너무 많이 소모해서 이번 포스트에서는 여기까지 다뤄보고<br>recoil, jest를 조금 더 공부한 다음에 수정하도록 하겠다.</p>
<p>이번에 recoil을 이용하여 테스트 코드를 처음 짜 보았다.<br>그러다 보니 많은 문제사항들이 발견되었는데 우선 문서 자체가 매우 적었다.<br>공식 <a target="_blank" rel="noopener" href="https://recoiljs.org/docs/guides/testing/">document</a> 자체에 자세한 설명이 조금 부족하다 생각이 든다.<br>구글 검색을 해보았으나 검색 능력이 부족한 것인지 자료가 조금 부족하였다.</p>
<p>검색하면 가장 많이 나오는 방법인 @testing-library&#x2F;react-hook 은<br>react 18버전부터는 사용이 불가능하여 @testing-library&#x2F;react를 설치해 다른 방법으로 구현해야 했다 이 과정에서 이해가 부족해서 counterSelector의 테스트 코드 작성에 애를 좀 먹었다.</p>
<p>확실히 redux로 테스트 코드를 작성하는 것이 더 편하다고 느꼈다.<br>recoil이 atom, selector를 통하여 간편하게 store 를 관리하는 점은 매력적이었다. 하지만, 복잡한 컴포넌트가 아니여서, recoil을 사용할 때의 단점과 redux의 단일 store를 통한 편한 디버깅의 장점을 느껴보지는 못했다.</p>
<p>복잡한 컴포넌트를 테스트 해보는것은 어려운것 같다.<br>개인적으로 공부를 하기위해서 한번쯤 제대로된 프로젝트를 만들어 두어야겠다고 느꼈다.</p>
<p>참고 :<br><a target="_blank" rel="noopener" href="https://recoiljs.org/">https://recoiljs.org/</a>,<br><a target="_blank" rel="noopener" href="https://react.dev/reference/react/Suspense">https://react.dev/reference/react/Suspense</a><br><a target="_blank" rel="noopener" href="https://github.com/testing-library/react-testing-library">https://github.com/testing-library/react-testing-library</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/10/React/flux-4/" data-id="clhhintdh0001j1jy3km95xel" data-title="redux vs recoil 3" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/flux-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/05/React/flux-3/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T15:04:21.000Z" itemprop="datePublished">2023-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/05/React/flux-3/">redux vs recoil 2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 redux를 실제로 어떻게 사용하는지 알아보도록 하겠다</p>
<p><img src="/img/flux-3/1.png"></p>
<p>vite를 사용하여 간단하게 React, TypeScript 프로젝트를 만들어 주었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ npm install recoil react-redux @reduxjs/toolkit</span><br><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="/img/flux-3/2.png"></p>
<p>vite 가 이미 설정된 config를 가져오기 때문에 별도의 설정을 따로 해주지 않아도<br>동작하는 게 엄청 매력적으로 느껴졌다.</p>
<p>추후에 vite에 대해서도 다뤄보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span>;</span><br></pre></td></tr></table></figure>

<p>redux를 사용하기 위해 store 만들고 Type도 선언해 주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="comment">// 나중을 위해 RecoilRoot 도 미리 추가해 주었다.</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.tsx&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>redux Provider 와 RecoilRoot를 React의 Root에 작성해 주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---counter</span></span><br><span class="line"><span class="comment">// counterSlice.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">PayloadAction</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">CounterState</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">CounterState</span> = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  initialState,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">increment</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> -= <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action: PayloadAction&lt;number&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += action.<span class="property">payload</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.<span class="property">actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure>

<p>우선 document에 있는 Counter 예제를 가져왔다.</p>
<p>기존에 redux만 사용하던 사람은 상당하게 이상하게 느껴질 코드라고 생각한다<br>redux는 상태를 불변하게 유지해야 한다<br>이를 위해서 이전에 immutable-js 같은 라이브러리를 사용해서 수정을 하거나 구조 분해 할당 <del>… 같은</del> 하여<br>state를 관리했는데 redux-toolkit 을 사용하면 redux-toolkit 이 Immer를 사용하여 직접 수정을 할 수 있게 해준다.<br><del>실제로 배열을 재사용하는 것은 아니다</del></p>
<p>redux에서 위 파일 형식처럼 action과 reducer를 한 파일에서 관리하는 걸<br>Ducks 구조라고 한다<br>Ducks 구조는 몇 가지 규칙이 있다.<br>최 상단에는 action type<br>reducer는 export default<br>action creator 도 같은 파일에서 export 해준다.</p>
<p>그러면 또 의문이 생긴다.</p>
<p>reducer 야 counterSlice.reducer를 export default 하고 있고<br>reducers 안에 있는 함수들이 action creator 인건 알겠는데<br>action type 은 어디서 선언하고 사용하는가.</p>
<p>incrementByAmount를 예시로 들자면<br>incrementByAmount의 action type 은 counter&#x2F;incrementByAmount이다.<br>redux toolkit의 createSlice 함수가 slice의 name 속성과 action creator 이름을 조합해서 action type 을 자동으로 생성해 준다.</p>
<p>따라서 action type 을 재사용 하기 위해서 export 해주고 싶은 경우엔<br>slice의 actions의 type 을 보면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actionTypes = <span class="title class_">Object</span>.<span class="title function_">keys</span>(counterSlice.<span class="property">actions</span>).<span class="title function_">map</span>(</span><br><span class="line">  <span class="function">(<span class="params">key</span>) =&gt;</span> counterSlice.<span class="property">actions</span>[key].<span class="property">type</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [&quot;counter/increment&quot;, &quot;counter/decrement&quot;, &quot;counter/incrementByAmount&quot;];</span></span><br></pre></td></tr></table></figure>

<p>이제 store에 reducer를 연결해 주도록 하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: counterReducer,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이제 action 을 dispatch 할 view를 만들어 주도록 하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useAppDispatch, <span class="title class_">RootState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ReduxCounter</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">q: RootState</span>) =&gt;</span> q.<span class="property">counter</span>);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useAppDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">increment</span>());</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleDecreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">decrement</span>());</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncrementByAmountButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">incrementByAmount</span>(<span class="number">5</span>));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;counter.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncreaseButtonClick&#125;</span>&gt;</span>inc<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleDecreaseButtonClick&#125;</span>&gt;</span>dec<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncrementByAmountButtonClick&#125;</span>&gt;</span>amou<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReduxCounter</span>;</span><br></pre></td></tr></table></figure>

<p><del>그냥 함수명을 onIncrease 같이 만들걸 그랬다 가독성이 엄청 구려 보인다.</del><br>어찌어찌 잘 작동한다.</p>
<p>이제 api 요청을 해보도록 하자.</p>
<p>이전에 redux-tookit-query 사용은 <a href="https://gastroad.github.io/2023/04/24/React/React-query-2/">여기</a>에서 다뤄봤으니 이번엔 그냥 thunk로 비동기 요청을 해보겠다.</p>
<p>비동기 요청을 하기 위해 axios를 install 해 주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install axios</span><br></pre></td></tr></table></figure>

<p>이후 api 요청을 위해 vite 설정을 변경해 주자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">react</span>()],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이전에 만들어놨던 웹서버를 바라보게 수정하였다.</p>
<p>이후 types 와 api를 선언해 두었다 둘 다 추후 recoil 을 사용할 때 다시 쓸 예정이니<br>디렉토리를 분리해 두었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="variable constant_">API</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// portfolio.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">API</span> <span class="keyword">from</span> <span class="string">&quot;.&quot;</span></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../types/Portfolio&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">Portfolio</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="variable constant_">API</span>.<span class="title function_">get</span>(<span class="string">&quot;/portfolio&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">portfolio</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; getPortfolioList &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -types</span></span><br><span class="line"><span class="comment">//  Portfolio.ts</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Portfolio</span> &#123;</span><br><span class="line">    <span class="attr">img</span>: string</span><br><span class="line">    <span class="attr">title</span>: string</span><br><span class="line">    <span class="attr">paragraph</span>: string</span><br><span class="line">    <span class="attr">link</span>: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>기본적인 준비는 끝났으니 redux-thunk를 사용해 보도록 하자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../../../api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchPortfolioList = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;portfolio/fetchPortfolioList&quot;</span>,</span><br><span class="line">  <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">//  selector.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RootState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;..&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">portfolioSelector</span> = (<span class="params">state: RootState</span>) =&gt; state.<span class="property">portfolio</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioListSelector = <span class="title function_">createSelector</span>(</span><br><span class="line">    portfolioSelector,</span><br><span class="line">    <span class="function">(<span class="params">portfolio</span>) =&gt;</span> portfolio.<span class="property">portfolioList</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> statusSelector = <span class="title function_">createSelector</span>(</span><br><span class="line">    portfolioSelector,</span><br><span class="line">    <span class="function">(<span class="params">portfolio</span>) =&gt;</span> portfolio.<span class="property">status</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">//  portfolioSlice.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./api&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../types/Portfolio&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">PortfolioState</span> &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: <span class="title class_">Portfolio</span>[]</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span> | <span class="string">&quot;FULFILLED&quot;</span> | <span class="string">&quot;REJECTED&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: [&#123; <span class="attr">img</span>: <span class="string">&quot;&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&quot;</span>, <span class="attr">paragraph</span>: <span class="string">&quot;&quot;</span>, <span class="attr">link</span>: <span class="string">&quot;&quot;</span> &#125;],</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;portfolio&#x27;</span>,</span><br><span class="line">    initialState,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">portfolioList</span> = action.<span class="property">payload</span></span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;FULFILLED&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">pending</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">rejected</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;REJECTED&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> portfolioSlice.<span class="property">reducer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./counter/counterSlice&quot;</span></span><br><span class="line"><span class="keyword">import</span> portfolioReducer <span class="keyword">from</span> <span class="string">&quot;./portfolio/portfolioSlice&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">    <span class="attr">reducer</span>: &#123;</span><br><span class="line">        <span class="attr">counter</span>: counterReducer,</span><br><span class="line">        <span class="attr">portfolio</span>: portfolioReducer</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useAppDispatch</span>: <span class="function">() =&gt;</span> <span class="title class_">AppDispatch</span> = useDispatch</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReduxAsync.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, useEffect, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useAppDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/portfolio/api&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  portfolioListSelector,</span><br><span class="line">  statusSelector,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/portfolio/selector&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ReduxAsync</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolioList = <span class="title function_">useSelector</span>(portfolioListSelector);</span><br><span class="line">  <span class="keyword">const</span> status = <span class="title function_">useSelector</span>(statusSelector);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useAppDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">fetchPortfolioList</span>());</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status === <span class="string">&quot;PENDING&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>PENDING<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (status === <span class="string">&quot;REJECTED&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>REJECTED<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((portfolio, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;portfolio.title&#125;<span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReduxAsync</span>;</span><br></pre></td></tr></table></figure>

<p>thunk를 이용하여 &#x2F;api&#x2F;portfolio를 호출하고 portfolioList를 받아<br>map 을 통해 title 을 뿌려주었다.</p>
<p>test-code까지 작성해서 비교해 보아야 제대로 된 비교가 될 거 같아서<br><del>redux는 test 하기 편하다는 장점을 가지고 있다.</del><br>jest를 이용하여 테스트 코드까지 작성해 보려고 한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev jest</span><br><span class="line">$ npm install --save-dev @types/jest</span><br><span class="line">$ npm install --save-dev ts-node</span><br><span class="line">$ npm install --save-dev ts-jest</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;tsc &amp;&amp; vite build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;jest&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// jest.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">transform</span>: &#123;</span><br><span class="line">        <span class="string">&quot;^.+\\.tsx?$&quot;</span>: <span class="string">&quot;ts-jest&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이외에도 testing-library&#x2F;react 등등 좋은 라이브러리도 많으니 추후에 자세히 다뤄보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --test</span></span><br><span class="line"><span class="comment">// counter.test.ts</span></span><br><span class="line"><span class="keyword">import</span> counterReducer, &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">  <span class="title class_">CounterState</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../store/counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// describe 는 테스트 스위트를 정의하기 위해 사용되는 함수이다.</span></span><br><span class="line"><span class="comment">// counter reducer 에 관한 테스트를 한다고 설명하는 부분이다.</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;counter reducer&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// initialState 를 선언하고</span></span><br><span class="line">  <span class="comment">// value:0 이라고 값을 초기화 하였고</span></span><br><span class="line">  <span class="comment">// CounterState 라는 타입을 명시했다</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">CounterState</span> = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// initialState 와 초기값이 같은지 확인하는 부분이다.</span></span><br><span class="line">  <span class="comment">// counterReducer 2번쨰 인자로 action 을 받는다</span></span><br><span class="line">  <span class="comment">// unknown 이라는 액션 타입을 생성하여 reducers 에 추가하면 오류가 발생할수 있다.</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle initial state&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">counterReducer</span>(<span class="literal">undefined</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;unknown&quot;</span> &#125;)).<span class="title function_">toEqual</span>(</span><br><span class="line">      initialState</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// increment,decrement,incrementByAmount 가 각각 잘 동작하는지 확인하는 테스트 케이스이다.</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle increment&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">increment</span>());</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle decrement&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">decrement</span>());</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(-<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle incrementByAmount&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">incrementByAmount</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>간단하게 counter 테스트 코드를 작성하였다. <del>Render가 잘 되었는지까지는 확인하지 않겠다.</del><br>각각 주석을 통해 자세하게 설명해 두었다.</p>
<p>이제 portfolio 도 테스트 코드를 작성해 보도록 하자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> portfolioReducer, &#123;</span><br><span class="line">  <span class="title class_">PortfolioState</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../store/portfolio/portfolioSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../store/portfolio/api&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../types/Portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;portfolio reducer&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: [&#123; <span class="attr">img</span>: <span class="string">&quot;&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&quot;</span>, <span class="attr">paragraph</span>: <span class="string">&quot;&quot;</span>, <span class="attr">link</span>: <span class="string">&quot;&quot;</span> &#125;],</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// api 응답을 가짜데이터를 통해 만들어 주었다.</span></span><br><span class="line">  <span class="comment">// mock</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">mockPortfolioList</span>: <span class="title class_">Portfolio</span>[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;image1.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Title1&quot;</span>,</span><br><span class="line">      <span class="attr">paragraph</span>: <span class="string">&quot;Paragraph1&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;http://link1.com&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;image2.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Title2&quot;</span>,</span><br><span class="line">      <span class="attr">paragraph</span>: <span class="string">&quot;Paragraph2&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;http://link2.com&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle initial state&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(<span class="literal">undefined</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;unknown&quot;</span> &#125;)).<span class="title function_">toEqual</span>(</span><br><span class="line">      initialState</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.pending&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: fetchPortfolioList.<span class="property">pending</span>.<span class="property">type</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;FULFILLED&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.fulfilled&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123;</span><br><span class="line">      <span class="attr">type</span>: fetchPortfolioList.<span class="property">fulfilled</span>.<span class="property">type</span>,</span><br><span class="line">      <span class="attr">payload</span>: mockPortfolioList,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">portfolioList</span>: mockPortfolioList,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;FULFILLED&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.rejected&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: fetchPortfolioList.<span class="property">rejected</span>.<span class="property">type</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;REJECTED&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>mockPortfolioList를 통해 api 응답에 성공했을 시를 대체하고 있다</p>
<p>redux-mock-store라는 라이브러리를 사용해서 mockStore를 만들고<br>middleware를 추가해서 테스트할 수 있다<br>아니면 아래 코드처럼 action payload에 api를 호출하는 방법도 있다.</p>
<p>현재 상황에 맞게 테스트 코드를 작성하면 될 것 같다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 이전에 만든 테스트 코드 입니다</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&quot;action.incrementAsync suc&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">action</span>: <span class="title class_">ReduxAction</span>&lt;number&gt; = &#123;</span><br><span class="line">            <span class="attr">type</span>: actionTypes.<span class="property">INCREMENTASYNC</span>,</span><br><span class="line">            <span class="attr">payload</span>: <span class="keyword">await</span> <span class="title function_">getInt</span>(&#123; <span class="attr">status</span>: <span class="string">&quot;resolve&quot;</span> &#125;),</span><br><span class="line">        &#125;</span><br><span class="line">        reducer.<span class="title function_">incrementAsync</span>(state!, action);</span><br><span class="line">        <span class="title function_">expect</span>(state!.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">30</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>간단하게 테스트 코드까지 작성하였다. 이제 다음엔 recoil 을 사용하여 같은 작업을 하고 비교해 보도록 하겠다.</p>
<p>참고:<br><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/">https://redux-toolkit.js.org/</a><br><a target="_blank" rel="noopener" href="https://github.com/immerjs/immer#readme">https://github.com/immerjs/immer#readme</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/05/React/flux-3/" data-id="clhew2w5x00007ejy98fi5yx3" data-title="redux vs recoil 2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/flux-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/02/React/flux-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-02T10:20:24.000Z" itemprop="datePublished">2023-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/02/React/flux-2/">redux vs recoil 1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 redux 와 recoil 을 사용해 보고 두 라이브러리들을 비교해 보려고 한다.</p>
<p>우선 고대 유물인 flux를 확인해 보자</p>
<blockquote>
<p>The Flux project has been archived and no further changes will be made. We recommend using more sophisticated alternatives like Redux, MobX, Recoil, Zustand, or Jotai.</p>
</blockquote>
<p>flux 에서 이제 redux, mobx, recoil, zustand, jotai 같은 친구들중 하나를 사용하는걸 권장한다.<br>언젠가 저기에있는 5개 상태관리 라이브러리 모두 사용법을 익혀야겠다.</p>
<p>redux는 flux 아키텍쳐를 구현하는데 도움을 주는 상태 관리 라이브러리로<br>flux 라이브러리와 사용방법이 유사하다.<br>바로 redux 부터 알아보도록하자.</p>
<h3 id="redux-란"><a href="#redux-란" class="headerlink" title="redux 란"></a>redux 란</h3><blockquote>
<p>자바스크립트 앱을 위한 예측 가능한 상태 컨테이너</p>
</blockquote>
<ol>
<li>Redux는 일관적으로 동작하고, 서로 다른 환경(클라이언트, 서버, 네이티브)에서도 실행되며, 테스트하기 쉬운 앱을 작성하도록 도와줍니다.</li>
<li>앱의 상태와 로직을 중앙화하여 실행 취소&#x2F;다시 실행, 영속적인 상태 등의 강력한 기능을 사용할 수 있게 합니다.</li>
<li>Redux DevTools는 앱의 상태가 언제, 어디서, 왜, 어떻게 바뀌었는지 쉽게 추적할 수 있도록 해줍니다. Redux의 아키텍처를 통해 변경사항을 기록하고, “시간여행형 디버깅”을 사용하고, 완전한 에러 리포트를 서버로 보낼 수 있습니다.</li>
<li>Redux는 어떤 UI 레이어에서도 동작하며, 여러분의 요구에 부합하는 거대한 애드온 생태계를 가지고 있습니다.</li>
</ol>
<p>요약하면 Redux 일관적으로 동작하고 (<del>순수 함수</del>) 서로 다른 환경에서 작동하고 테스트하기 쉬운 앱을 작성하도록 도와준다. 그뿐만 아니라<br>devtools를 이용하여 시간 여행형 디버깅을 제공한다 react 나 vue 같은 라이브러리 와 함께 사용할 수 있다.</p>
<p>항상 여기까지 읽어보면 사용하지 않으면 바보가 된 거 같은 기분이 든다.<br>하지만 이런 redux 도 단점이 엄청 많이 있는데 대표적으로</p>
<ol>
<li>엄청난 보일러 플레이트 코드</li>
<li>여러 라이브러리를 같이 사용하기 때문에 무시하지 못할 러닝 커브</li>
</ol>
<p>등등 장점만 있는 것은 아니다.<br>redux를 사용하면서 항상 많이 고민했던 부분이 전역으로 state를 관리하는 작업이 정말 필요한가? 이였다.<br>component 가 여러 depth를 가지지 않고 전역으로 state를 관리할 필요가 없는 프로젝트를 진행하다 보면<br>redux를 이용해서 개발하는 것이 엄청 부담스럽게 느껴졌다.<br>모든 작업을 action 을 생성해서 dispatch 해주는 것으로 모자라 store를 연결해 주고 initalState 수정해 주고 상당히 번거롭게 느껴질 수 있다.</p>
<p>그래서 이전에 context API를 store처럼 이용하여 전역으로 관리가 필요한 user profile 같은 데이터를 관리했었던 적이 있었다.<br>하지만 이럴 경우 rendering 관련된 이슈에서 자유롭지 못했다.<br>~~시도 때도 없이 온갖 컴포넌트가 rerendering 되었으며 이를 방지하고자 useCallback 과 useMemo 등을 사용했지만 편하게 사용하고 싶어서 채택한 context 가 오히려 불편함을 야기했다. ~~</p>
<p>그러던 중 recoil이라는 기술을 알게 되었고 바로 product에 적용한 경험이 있다.<br>그러면 recoil의 동기를 한번 알아보자</p>
<h3 id="recoil"><a href="#recoil" class="headerlink" title="recoil"></a>recoil</h3><blockquote>
<p>호환성 및 단순함을 이유로 외부의 글로벌 상태관리 라이브러리보다는 React 자체에 내장된 상태 관리 기능을 사용하는 것이 가장 좋다. 그러나 React는 다음과 같은 한계가 있다.<br>컴포넌트의 상태는 공통된 상위요소까지 끌어올려야만 공유될 수 있으며, 이 과정에서 거대한 트리가 다시 렌더링 되는 효과를 야기하기도 한다.<br>Context는 단일 값만 저장할 수 있으며, 자체 소비자(consumer)를 가지는 여러 값의 집합을 담을 수는 없다.<br>이 두 가지 특성이 트리의 최상단(state가 존재하는 곳)부터 트리의 말단(state가 사용되는 곳)까지의 코드 분할을 어렵게 한다.</p>
</blockquote>
<p>recoil의 동기는 간단하다 redux 같은 외부의 글로벌 상태 관리 라이브러리는 호환성 문제가 있을 수 있으며 복잡하다.<br>그래서 react의 내장 상태 관리 기능(useState,…)을 이용하는 것이 좋은데 React가 가지고 있는 한계 (state는 부모로 올려줘야 하고 context는 단일 값만 저장할 수 있다) 때문에 recoil이라는 라이브러리를 만들었다.</p>
<p>recoil 역시 react처럼 facebook에서 개발했기 때문에 react와의 호환 기능성이 좋다</p>
<p>두 라이브러리의 동기에 대해 알아보았으니 이제 두 라이브러리를 간단하게 비교해 보려고 한다</p>
<p>redux와 recoil의 가장 큰 차이점은 상태를 관리하는 방식이라고 생각한다</p>
<p>redux는 단일 스토어 패턴을 사용하여 하나의 저장소에서 상태를 관리하는 반면 recoil은 작은 단위의 atom으로 나누어서 관리한다.</p>
<p>이 때문에 redux는 애플리케이션의 상태를 중앙에서 관리하고 추적하기 쉽게 만들어주고<br>recoil은 상태의 의존성을 명확히 파악할 수 있게 한다</p>
<p>이제 단점을 비교해 보겠다.</p>
<p>redux의 가장 불편한 점은 비동기 작업이다.<br>recoil의 경우 동시성 모드를 지원하여 비동기 작업을 하기 굉장히 편리하다. Suspense API를 사용하여 (<del>데이터를 미리 로딩하여</del>) 반응성을 높일 수 있다.</p>
<p>redux의 경우 미들웨어를 사용해야 한다 (<del>thunk, saga</del>)<br>우선 미들웨어가 무엇인지 먼저 알아보자</p>
<p>redux에서 미들웨어란</p>
<blockquote>
<p>It provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.</p>
</blockquote>
<p>redux의 액션 디스패칭과 리듀서 사이에서 동작하는 플러그인이다(third-party extension).</p>
<p>액션이 디스패치 될 때마다 실행되며 액션의 처리를 변형하거나, 비동기 작업을 처리할 때 사용한다. 이를 이용하여 redux에서 비동기 작업을 처리할 수 있는데<br>상당히 번거롭게 느껴진다.</p>
<p>자 이제 recoil의 단점에 대해서도 알아보자<br>개인적인 생각으로 recoil 은 정말 쉽지만 어렵다.<br>recoil의 강점인 atom으로 상태를 나누는 작업은 간단한 프로젝트의 경우 크게 신경 쓰이지 않지만 프로젝트의 복잡도가 올라가면 올라갈수록 관리하기 어려워진다.</p>
<p>이제 간단하게 장단점에 대해 알아보았으니 다음부턴 실제로 코드를 작성해 보자 마침 간단한 웹서버도 작성이 완료되었으니 비동기 작업을 하는데에 있어서 문제도 없다.</p>
<p>참고 :<br><a target="_blank" rel="noopener" href="https://ko.redux.js.org/introduction/getting-started">redux</a>, <a target="_blank" rel="noopener" href="https://recoiljs.org/ko/">recoil</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/02/React/flux-2/" data-id="clh66zwt400017hjyb9akct22" data-title="redux vs recoil 1" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NodeJs/node-js-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/01/NodeJs/node-js-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-01T05:20:24.000Z" itemprop="datePublished">2023-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/01/NodeJs/node-js-2/">간단한 웹 서버를 만들어 보자 2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>이전에 react-query 를 위한 간단한 웹 서버를 만들었는데<br>이떄 mockData 를 js 의 상수로 선언해 두었다</p>
<p>다시 생각해보니 그냥 json 으로 만들어서 간이 db 처럼 사용하면 put 이나<br>post 요청도 제대로 해볼수 있지않을까? 생각이 들어 해보려고 한다.</p>
<p>우선 data.js 를 json 으로 변경해 주도록 하자</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;portfolio&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;이력서&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/profile.jpeg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GitHub&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github 링크 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/gastroad&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/github.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Slides&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pt발표 자료 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://slides.com/coldpotato&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/slides.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Github Blog&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gastroad.github.io&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/github.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>그리고 데이터를 실제로 사용하는<br>portfolio.service.js 에서 json 을 파싱해서 수정하게 api 를 수정해 주자</p>
<p>etc 를 수정하는 api 는 당장 필요없어 보여 삭제 하였다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataFilePath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;data.json&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">etc, img, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = &#123;</span><br><span class="line">    etc,</span><br><span class="line">    img,</span><br><span class="line">    link,</span><br><span class="line">    paragraph,</span><br><span class="line">    title,</span><br><span class="line">    <span class="attr">id</span>: portfolio.<span class="property">portfolio</span>.<span class="property">length</span> + <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  portfolio.<span class="property">portfolio</span>.<span class="title function_">push</span>(newPortfolio);</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(dataFilePath, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(portfolio));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">return</span> portfolio.<span class="property">portfolio</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">id, img, etc, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">const</span> changeIndex = portfolio.<span class="property">portfolio</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">    <span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id)</span><br><span class="line">  );</span><br><span class="line">  portfolio.<span class="property">portfolio</span>.<span class="title function_">splice</span>(changeIndex, <span class="number">1</span>, [</span><br><span class="line">    &#123; id, img, etc, link, paragraph, title &#125;,</span><br><span class="line">  ]);</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(dataFilePath, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(portfolio));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>우선 json 파일을 편집할 예정이기때문에 내장모듈인 fs 를 불러왔다.<br>그리고 파일을 접근을 위해 path 모듈도 불러왔다 dataFilePath 상수를 선언해 중복되는 data.json 의 경로를 작성해주었다</p>
<p>이후 상황에 맞게 json 을 수정하는 api 를 작성했다.<br>id 의 경우 portfolio.portfolio.length + 1 으로하면<br>데이터 생성,삭제 과정에서 중복 id 가 들어갈수 있으나<br>당장은 id 로 작업하는것이 없으니(유니크한 값이 필요하다면 react 에서 useId 를 사용해도 괜찮을것 같았다) 일단 두었다.</p>
<p>마지막으로 실제로 요청을 보내니 정상적으로 파일을 수정할수 있었다.</p>
<p>node js 가 익숙하지 않으니 포스트로 작성할때 내용이 엄청 부실하고 적지만<br>상당한 시간이 소요된다. <del>정작 js 에서 데이터를 다루는것보다 크게 벗어난 부분은 없는데도..</del><br>백엔드 공부도 소홀하게 하면 안되겠다고 느꼈다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/01/NodeJs/node-js-2/" data-id="clh4el0tz000u6fjyh37y23kv" data-title="간단한 웹 서버를 만들어 보자 2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/react-query-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/24/React/react-query-2/" class="article-date">
  <time class="dt-published" datetime="2023-04-24T09:04:06.000Z" itemprop="datePublished">2023-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/24/React/react-query-2/">react-query를 사용해 보자(2)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 rtk-query를 사용해서 비교해 보려고 한다.</p>
<p>우선 rtk-query의 동기부터 살펴보자</p>
<blockquote>
<p>Tracking loading state in order to show UI spinners<br>Avoiding duplicate requests for the same data<br>Optimistic updates to make the UI feel faster<br>Managing cache lifetimes as the user interacts with the UI</p>
</blockquote>
<p>loading 상태 추적,<br>중복 요청 방지<br>UI가 더 빠르게 느껴지도록 업데이트<br>사용자가 UI와 상호 작용할 때 캐시 수명 관리</p>
<p>react-query 보다 간결하다 (제공하는 기능도 간결하긴 하다.)</p>
<p>rtk-qeury는 어떤 기능을 제공하는지 확인해 보자.</p>
<blockquote>
<p>createApi(): The core of RTK Query’s functionality. It allows you to define a set of endpoints describe how to retrieve data from a series of endpoints, including configuration of how to fetch and transform that data. In most cases, you should use this once per app, with “one API slice per base URL” as a rule of thumb.<br>fetchBaseQuery(): A small wrapper around fetch that aims to simplify requests. Intended as the recommended baseQuery to be used in createApi for the majority of users.<br><ApiProvider />: Can be used as a Provider if you do not already have a Redux store.<br>setupListeners(): A utility used to enable refetchOnMount and refetchOnReconnect behaviors.</p>
</blockquote>
<p>createApi :RTK의 핵심<br>데이터를 패치하고 변환하는 설정을 포함해서 엔드 포인트들에서 어떻게 데이터를 패치하는지 정의<br>대부분의 경우 “기본 URL 당 하나의 API 슬라이스”를 원칙으로 하여 App당 한 번 사용<br>fetchBaseQuery() : 간단한 요청을 위한 fetch 래퍼<br>createApi의 baseQuery를 권장함<br>ApiProvider<br>redux store 가 없을 경우 provider로 사용 가능<br>setupListeners():<br>refetchOnMount와 refetchOnReconnect를 위한 유틸리티</p>
<p>제공하는 기능에 대해서도 대충 알아봤으니 이제 실제 적용해서 사용해 보도록 하자<br>우선 react-ground는 redux를 통해 작성했으니 ApiProvider를 사용할 필요가 없다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<p>createApi를 통해 portfolioApi를 생성해 주었다.<br>RTK 쿼리를 사용하면 일반적으로 전체 API 정의를 한곳에서 정의해야 한다</p>
<p>친절하게도 유지 보수를 위해 코드 분할하는 방법까지도 적혀있지만<br>지금 필요한 기능은 아니니 나중에 필요할 때 찾아보도록 해야겠다<br><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/rtk-query/usage/code-splitting">코드 분할 방법</a></p>
<p>이후 root store에 reducer, middleware를 추가해 주어야 한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> portfolioSlice <span class="keyword">from</span> <span class="string">&quot;./portfolioSlice&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; portfolioApi &#125; <span class="keyword">from</span> <span class="string">&quot;src/api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">portfolio</span>: portfolioSlice.<span class="property">reducer</span>,</span><br><span class="line">    [portfolioApi.<span class="property">reducerPath</span>]: portfolioApi.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">getDefaultMiddleware</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">getDefaultMiddleware</span>().<span class="title function_">concat</span>(portfolioApi.<span class="property">middleware</span>),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useAppDispatch</span>: <span class="function">() =&gt;</span> <span class="title class_">AppDispatch</span> = useDispatch;</span><br></pre></td></tr></table></figure>

<p>이제 실제로 호출을 해보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList, useGetPortfolioListQuery &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reactQuery = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> rtkQuery = <span class="title function_">useGetPortfolioListQuery</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rtkQuery);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;reactQuery.data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>rtk-query는 react-query 랑 같은 유틸리티 불린 값을 제공해 준다<br><del>isLoading, isFetching 등등등</del></p>
<p>이제 post api를 한번 사용해 보도록 하겠다.<br>post의 경우 mutation 을 이용해서 호출할 수 있다.<br>mutation 은 서버에게 데이터 업데이트를 전달하고 로컬에서 변화된 값을 적용시킬 때 사용한다.<br>또한 뮤테이션은 캐시 무효화와 강제 리패칭을 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">postPortfolio</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">(<span class="params">post</span>) =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/portfolio/`</span>,</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">body</span>: post</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery, usePostPortfolioMutation &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio, usePostPortfolioMutation &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [createPortfolio, &#123; isLoading, isError &#125;] = <span class="title function_">usePostPortfolioMutation</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          createPortfolio(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>포스트 요청에 성공했다.</p>
<p>rtk-query 와 react-query를 사용해 보았는데<br>둘 다 기본적인 요청만 해서 그런지 크게 차이점을 모르겠다.</p>
<p>기존에 redux-toolkit 을 사용 중이었다면 수정하기 어렵지 않을 것 같다는 생각을 했다.<br>하지만 fetchBaseQuery를 만들어줘야 해서 나중에 또 다른 기술로 갈아탈 때 고생을 할 거 같다</p>
<p>그리고 rtk-query를 사용하면 server state를 전역으로 관리할 수 있다.<br>store를 사용하다 보니 전역에서 데이터에 접근이 가능하다.<br>react-query의 경우 데이터는 전역으로 관리 되지 않지만<br>키를 기반으로 요청을 관리하기 때문에 여러 컴포넌트에서 여러번 요청을 보내도 한번만 요청이 간다<br><del>추후 devtool 을 이용해서 자세하게 확인해 봐야겠다.</del></p>
<p>react-query의 경우 기존에 만들어둔 axios를 사용해서<br>편하게 개발 가능하고 많은 사람이 이용 중이라 트러블슈팅할 때도 편할 거 같다는 생각을 했다</p>
<p>확실한 건 양쪽 다 server state 관리가 편해졌다.</p>
<p>처음 계획엔 swr 도 알아보려 했는데 swr까지 공부했다가는 깊이가 너무 얕아질 것 같아서 추후에 시간이 있을 때로 미루고 react-query, rtk-query를 좀 더 자세히 알아봐야겠다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/24/React/react-query-2/" data-id="clh4el0tx000k6fjy1c45g5wg" data-title="react-query를 사용해 보자(2)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/react-query-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/22/React/react-query-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-22T12:48:11.000Z" itemprop="datePublished">2023-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/22/React/react-query-1/">react-query를 사용해 보자(1)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>redux를 이용하다 보면 비동기 요청마다 미들웨어를 추가해 주는 작업은 상당히 번거롭게 느껴진다.<br>간단한 요청들은 react-query를 사용해 보려 한다.</p>
<p>react-query에 대해 알아보고 react-query 가 아닌 swr, rtk-query 랑도 비교해 보고 사용해 보려고 한다.</p>
<p>먼저 react-query의 동기부터 살펴보자</p>
<blockquote>
<p>Caching… (possibly the hardest thing to do in programming)<br>Deduping multiple requests for the same data into a single request<br>Updating “out of date” data in the background<br>Knowing when data is “out of date”<br>Reflecting updates to data as quickly as possible<br>Performance optimizations like pagination and lazy loading data<br>Managing memory and garbage collection of server state<br>Memoizing query results with structural sharing</p>
</blockquote>
<p>캐시<br>동일한 데이터에 대한 여러 요청을 단일 요청으로 중복 제거,<br>백그라운드에서 오래된 데이터 알고 업데이트<br>데이터 업데이트를 최대한 신속하게 반영<br>pagination 및 lazy 로딩 데이터와 같은 성능 최적화<br>메모리 관리 와 서버 state의 garbage collection<br>구조적 공유와 query 결과 Memoizing</p>
<p>목록만 봐도 아찔해진다 이쯤 되면 안 쓰면 안 될 거 같은 기분마저 들기 시작한다.</p>
<p>우선 당연하게도 react-query를 설치해 주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @tanstack/react-query</span><br></pre></td></tr></table></figure>

<p>바로 사용을 시작해 보자<br>우선 react-query를 이용하기 위해서는 quertclient를 provider에 넣어 줘야 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Portfolio</span> <span class="keyword">from</span> <span class="string">&quot;page/Portfolio&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;src/store/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;queryClient&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#123;</span>&quot;<span class="attr">root-modal</span>&quot;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Portfolio</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>이제 api를 호출하는 함수를 만들어 두자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// request.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchPortfolioList = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">    <span class="string">&#x27;fetchPortfolioList&#x27;</span>,</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/portfolio&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolio = <span class="keyword">async</span> (<span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/api/portfolio&quot;</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: string</span><br><span class="line">&#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc`</span>, &#123; ...body &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: number</span><br><span class="line">    <span class="attr">etcId</span>: number</span><br><span class="line">&#125;, <span class="attr">body</span>: &#123; <span class="attr">value</span>: string &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, etcId &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc/<span class="subst">$&#123;etcId&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    fetchPortfolioList,</span><br><span class="line">    getPortfolioList,</span><br><span class="line">    postPortfolio,</span><br><span class="line">    getPortfolio,</span><br><span class="line">    putPortfolio,</span><br><span class="line">    postPortfolioEtc,</span><br><span class="line">    putPortfolioEtc,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>api를 너무 과하게 만든 거 같다… <del>기왕 과하게 만들 거면 좀 이쁘게 만들걸 그랬다</del></p>
<p>우선 바로 한번 호출해 보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;/* <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;portfolioList&#125;</span> /&gt;</span> */&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>우선 useQuery를 통해 api 호출이 가능하다.</p>
<p>useQuery에 우선 필수 값인 queryKey 와 queryFn만 넣어서 호출을 확인해 보았다.</p>
<p>이제 차근차근 useQuery에 어떤 옵션들이 들어가고 각각 어떤 일을 하는 친구인지 알아보자</p>
<p>우선 queryKey부터 살펴보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queryKey는 unKnown[] 타입을 받는다</span><br><span class="line">필수 값이다</span><br><span class="line">쿼리에 사용할 쿼리 키다</span><br><span class="line">쿼리 키는 안정적인 hash로 hash 된다.</span><br><span class="line">enabled 이 false로 설정하지 않았으면 key가 변경될 때 자동으로 업데이트한다</span><br></pre></td></tr></table></figure>

<p>그러면 enabled 도 궁금해진다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enabled 은 boolean 타입을 받는다</span><br><span class="line">쿼리가 자동적으로 실행되지 않으려면 false 값을 설정해야 한다.</span><br><span class="line">종속 쿼리에 사용 가능하다</span><br></pre></td></tr></table></figure>

<p>enabled는 api를 호출한 후 그 데이터를 가지고 추가 호출이 일어나야 하는 상황에서 사용할 수 있을 거 같다.</p>
<p>그러면 queryFn 은 뭐 하는 친구일까</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">queryFn 은 (context: QueryFunctionContext) =&gt; Promise&lt;TData&gt; 타입을 받는다.</span><br><span class="line">기본 쿼리 함수가 정의되지 않은 경우에만 필수이다.</span><br><span class="line">쿼리가 데이터를 요청하는 데 사용할 함수이다.</span><br><span class="line">QueryFunctionContext 을 받는다</span><br><span class="line">데이터를 resolve 하거나 오류를 throw 하는 Promise를 return 해야 한다.</span><br><span class="line">데이터는 undefined 일수 없다.</span><br></pre></td></tr></table></figure>

<p>옵션은 여기까지만 확인해 보고 return 항목에 대해서 알아보겠다<br>우선 지금 당장 필요한 건 요청의 상태와 에러 그리고 결과가 필요하다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; status, data, error &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>잘 작동하는 것을 확인했다.</p>
<p>자세한 건 <a target="_blank" rel="noopener" href="https://tanstack.com/query/v4/docs/react/reference/useQuery">tanstack.com</a>에서 확인해 볼 수 있다 useQuery에 정말 수많은 옵션과 return 이 있다.</p>
<p>이제 get api는 확인을 했으니<br>post 와 이에 따른 update를 해보려고 한다.</p>
<p>useMutation이라는 훅을 사용할 예정이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// PortfolioList.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>useMutation 훅에 mutationFn에 post 할 api를 넣어 주었다.<br>이후 onSuccess 옵션을 통해 api 가 성공했을 때 portfolioList를 다시 받아오는 작업을 진행하였다. onError 같이 실패했을 경우 에러 처리도 가능하니 뭔가 필요한 상황이 오면 document를 다시 봐야겠다.</p>
<hr>
<p><del>여기까지 해보고 나니 굳이 다른 api를 만들어 볼 필요가 없었던 거 같다</del>.<br>2023 4&#x2F;26</p>
<p>react-query 사용시 최신 데이터 상태 유지를 도와주지만 반대로<br>최신 데이터 상태가 유지되면 안되는 경우 문제가 생긴다.</p>
<p>예를들어 portfolio의 내용을 편집해야하는 상황일경우<br>getPortfolio 를 useQuery 를 통해 요청하고 이 데이터를 바탕으로<br>사용자의 input 을 통해 수정이 발생한다면 최신상태를 유지하기위한 로직이 방해가 된다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">  <span class="attr">queryKey</span>: [<span class="string">&quot;portfolio&quot;</span>, id],</span><br><span class="line">  <span class="attr">queryFn</span>: getPortfolio,</span><br><span class="line">  <span class="attr">onSuccess</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setPortfolio</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleInputChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setPortfolio</span>(...portfolio,[e.<span class="property">target</span>.<span class="property">name</span>]: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&#123;portfolio.title&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleInputChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">value</span>=<span class="string">&#123;portfolio.description&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onChange</span>=<span class="string">&#123;handleInputChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>이런 상황의 경우 강제로 업데이트를 막아야 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">  <span class="attr">queryKey</span>: [<span class="string">&quot;portfolio&quot;</span>, id],</span><br><span class="line">  <span class="attr">queryFn</span>: getPortfolio,</span><br><span class="line">  <span class="attr">cacheTime</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">refetchOnMount</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">refetchInterval</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">refetchIntervalInBackground</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">onSuccess</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setPortfolio</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>하지만 이럴 경우에는 그냥 react-query 를 사용하지않는게 더 편하게 사용 가능할것으로 보인다 이런경우를 위해 useAxios hooks 도 하나 만들어두자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">UseAxiosResponse</span>&lt;T&gt; = [</span><br><span class="line">  <span class="title class_">AxiosResponse</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt; | <span class="literal">null</span>,</span><br><span class="line">  boolean,</span><br><span class="line">  <span class="title class_">Error</span> | <span class="literal">null</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> useAxios&lt;T = unknown&gt;(</span><br><span class="line">  <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span><br><span class="line">): <span class="title class_">UseAxiosResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState&lt;<span class="title class_">AxiosResponse</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt; | <span class="literal">null</span>&gt;(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> [isLoading, setIsLoading] = useState&lt;boolean&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="title class_">Error</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setIsLoading</span>(<span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">axios</span>(config);</span><br><span class="line">        <span class="title function_">setData</span>(response);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="title function_">setError</span>(error);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">setIsLoading</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, [config]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [data, isLoading, error];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useAxios;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 이렇게 사용할수있다</span></span><br><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125;= useAxios&lt;<span class="title class_">PortfolioCard</span>&gt;(&#123;</span><br><span class="line">  <span class="comment">//axios 설정들</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<p>기존에 rtk를 사용해서 createAsyncThunk를 사용해서 extraReducers를 추가해 주는 방식보다 훨씬 간편하게 사용할 수 있는 것 같다.</p>
<p>내일은 rtk-query를 사용해 보고 react-query 랑 비교해 보려고 한다.<br>참고: <a target="_blank" rel="noopener" href="https://tanstack.com/query/latest/docs/react/overview">https://tanstack.com/query/latest/docs/react/overview</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/22/React/react-query-1/" data-id="clh4el0ty000o6fjy13zban0d" data-title="react-query를 사용해 보자(1)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">다음 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Front-dev-blog/" rel="tag">Front-dev-blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terminal/" rel="tag">Terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build-deploy/" rel="tag">build&amp;deploy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3js/" rel="tag">d3js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/Front-dev-blog/" style="font-size: 17.5px;">Front-dev-blog</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/NodeJs/" style="font-size: 12.5px;">NodeJs</a> <a href="/tags/React/" style="font-size: 20px;">React</a> <a href="/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/tags/Terminal/" style="font-size: 12.5px;">Terminal</a> <a href="/tags/build-deploy/" style="font-size: 15px;">build&deploy</a> <a href="/tags/d3js/" style="font-size: 10px;">d3js</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">5월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">4월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">11월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">6월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">5월 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/25/React/nextjs-3/">Next.js 에 대해서 알아보자-3</a>
          </li>
        
          <li>
            <a href="/2023/05/22/React/ui-design-pattern/">react 디렉토리 구조에 대해서 알아보자.</a>
          </li>
        
          <li>
            <a href="/2023/05/18/React/nextjs-2/">Next.js 에 대해서 알아보자-2</a>
          </li>
        
          <li>
            <a href="/2023/05/15/React/nextjs-1/">Next.js 에 대해서 알아보자-1</a>
          </li>
        
          <li>
            <a href="/2023/05/10/React/flux-4/">redux vs recoil 3</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 gastroad<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>