<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>gastroad blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="gastroad blog">
<meta property="og:url" content="https://gastroad.github.io/index.html">
<meta property="og:site_name" content="gastroad blog">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="gastroad">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="gastroad blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gastroad blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gastroad.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-React/flux-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/05/React/flux-3/" class="article-date">
  <time class="dt-published" datetime="2023-05-04T15:04:21.000Z" itemprop="datePublished">2023-05-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/05/React/flux-3/">redux vs recoil 2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 redux 를 실제로 어떻게 사용하는지 알아보도록 하겠다</p>
<p><img src="/img/flux-3/1.png"></p>
<p>vite 를 사용하여 간단하게 React,TypeScript 프로젝트를 만들어 주었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ npm install recoil react-redux @reduxjs/toolkit</span><br><span class="line">$ npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="/img/flux-3/2.png"></p>
<p>vite 가 이미 설정된 config 를 가져오기떄문에 별도의 설정을 따로 해주지않아도<br>동작하는게 엄청 매력적으로 느껴졌다.</p>
<p>추후에 vite 에 대해서도 다뤄보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span>;</span><br></pre></td></tr></table></figure>

<p>redux 를 사용하기 위해 store 만들고 Type도 선언해 주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span></span><br><span class="line"><span class="comment">// 나중을 위해 RecoilRoot 도 미리 추가해 주었다.</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.tsx&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">React.StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">React.StrictMode</span>&gt;</span></span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>redux Provider 와 RecoilRoot 를 React 의 Root 에 작성해주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---counter</span></span><br><span class="line"><span class="comment">// counterSlice.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">PayloadAction</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">CounterState</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">CounterState</span> = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;counter&quot;</span>,</span><br><span class="line">  initialState,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">increment</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">decrement</span>: <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> -= <span class="number">1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">incrementByAmount</span>: <span class="function">(<span class="params">state, action: PayloadAction&lt;number&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span> += action.<span class="property">payload</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; increment, decrement, incrementByAmount &#125; = counterSlice.<span class="property">actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> counterSlice.<span class="property">reducer</span>;</span><br></pre></td></tr></table></figure>

<p>우선 document 에 있는 Counter 예제를 가져왔다.</p>
<p>기존에 redux 만 사용하던 사람은 상당하게 이상하게 느껴질 코드라고 생각한다<br>redux는 상태를 불변하게 유지해야한다<br>이를 위해서 이전에 immutable-js 같은 라이브러리를 사용해서 수정을 하거나 구조 분해 할당 <del>…같은</del> 하여<br>state 를 관리했는데 redux-toolkit 을 사용하면 redux-toolkit 이 Immer 를 사용하여 직접 수정을 할수 있게 해준다.<br><del>실제로 배열을 재사용하는것은 아니다</del></p>
<p>redux 에서 위 파일형식처럼 action과 reducer 를 한 파일에서 관리하는걸<br>Ducks 구조 라고 한다<br>Ducks 구조 는 몇가지 규칙이 있다.<br>최 상단에는 action type<br>reducer 는 export default<br>action creator 도 같은 파일에서 export 해준다.</p>
<p>그러면 또 의문이 생긴다.</p>
<p>reducer 야 counterSlice.reducer 를 export default 하고있고<br>reducers 안에 있는 함수들이 action creator 인건 알겠는데<br>action type 은 어디서 선언하고 사용하는가.</p>
<p>incrementByAmount 를 예시로 들자면<br>incrementByAmount 의 action type 은 counter&#x2F;incrementByAmount 이다.<br>redux toolkit 의 createSlice 함수가 slice 의 name 속성과 action creator 이름을 조합해서 action type 을 자동으로 생성해준다.</p>
<p>따라서 action type 을 재사용 하기 위해서 export 해주고 싶은 경우엔<br>slice의 actions 의 type 을 보면된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actionTypes = <span class="title class_">Object</span>.<span class="title function_">keys</span>(counterSlice.<span class="property">actions</span>).<span class="title function_">map</span>(</span><br><span class="line">  <span class="function">(<span class="params">key</span>) =&gt;</span> counterSlice.<span class="property">actions</span>[key].<span class="property">type</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [&quot;counter/increment&quot;, &quot;counter/decrement&quot;, &quot;counter/incrementByAmount&quot;];</span></span><br></pre></td></tr></table></figure>

<p>이제 store에 reducer 를 연결해 주도록 하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: counterReducer,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이제 action 을 dispatch 할 view 를 만들어 주도록 하자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useAppDispatch, <span class="title class_">RootState</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ReduxCounter</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counter = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">q: RootState</span>) =&gt;</span> q.<span class="property">counter</span>);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useAppDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">increment</span>());</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleDecreaseButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">decrement</span>());</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleIncrementByAmountButtonClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">incrementByAmount</span>(<span class="number">5</span>));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;counter.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncreaseButtonClick&#125;</span>&gt;</span>inc<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleDecreaseButtonClick&#125;</span>&gt;</span>dec<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleIncrementByAmountButtonClick&#125;</span>&gt;</span>amou<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReduxCounter</span>;</span><br></pre></td></tr></table></figure>

<p><del>그냥 함수명을 onIncrease 같이 만들껄 그랬다 가독성이 엄청 구려보인다.</del><br>어찌 저찌 잘 작동한다.</p>
<p>이제 api 요청을 해보도록 하자.</p>
<p>이전에 redux-tookit-query 사용은 <a href="https://gastroad.github.io/2023/04/24/React/react-query-2/">여기</a> 에서 다뤄봤으니 이번엔 그냥 thunk 로 비동기 요청을 해보겠다.</p>
<p>비동기 요청을 하기위해 axios 를 install 해 주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install axios</span><br></pre></td></tr></table></figure>

<p>이후 api 요청을 위해 vite 설정을 변경해주자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> react <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">react</span>()],</span><br><span class="line">  <span class="attr">server</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://localhost:3000&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이전에 만들어놨던 웹서버를 바라보게 수정하였다.</p>
<p>이후 types 와 api 를 선언해 두었다 둘다 추후 recoil 을 사용할때 다시 쓸 예정이니<br>디렉토리를 분리해 두었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API</span> = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;/api&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="variable constant_">API</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// portfolio.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="variable constant_">API</span> <span class="keyword">from</span> <span class="string">&quot;.&quot;</span></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../types/Portfolio&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">Portfolio</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> <span class="variable constant_">API</span>.<span class="title function_">get</span>(<span class="string">&quot;/portfolio&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data.<span class="property">portfolio</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; getPortfolioList &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -types</span></span><br><span class="line"><span class="comment">//  Portfolio.ts</span></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Portfolio</span> &#123;</span><br><span class="line">    <span class="attr">img</span>: string</span><br><span class="line">    <span class="attr">title</span>: string</span><br><span class="line">    <span class="attr">paragraph</span>: string</span><br><span class="line">    <span class="attr">link</span>: string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>기본적인 준비는 끝났으니 redux-thunk 를 사용해 보도록 하자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../../../api/portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchPortfolioList = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">  <span class="string">&quot;portfolio/fetchPortfolioList&quot;</span>,</span><br><span class="line">  <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">//  selector.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSelector &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RootState</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;..&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">portfolioSelector</span> = (<span class="params">state: RootState</span>) =&gt; state.<span class="property">portfolio</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioListSelector = <span class="title function_">createSelector</span>(</span><br><span class="line">    portfolioSelector,</span><br><span class="line">    <span class="function">(<span class="params">portfolio</span>) =&gt;</span> portfolio.<span class="property">portfolioList</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> statusSelector = <span class="title function_">createSelector</span>(</span><br><span class="line">    portfolioSelector,</span><br><span class="line">    <span class="function">(<span class="params">portfolio</span>) =&gt;</span> portfolio.<span class="property">status</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// ---portfolio</span></span><br><span class="line"><span class="comment">//  portfolioSlice.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./api&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../../types/Portfolio&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">PortfolioState</span> &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: <span class="title class_">Portfolio</span>[]</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span> | <span class="string">&quot;FULFILLED&quot;</span> | <span class="string">&quot;REJECTED&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: [&#123; <span class="attr">img</span>: <span class="string">&quot;&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&quot;</span>, <span class="attr">paragraph</span>: <span class="string">&quot;&quot;</span>, <span class="attr">link</span>: <span class="string">&quot;&quot;</span> &#125;],</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;portfolio&#x27;</span>,</span><br><span class="line">    initialState,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">extraReducers</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> &#123;</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">portfolioList</span> = action.<span class="property">payload</span></span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;FULFILLED&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">pending</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;PENDING&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        builder.<span class="title function_">addCase</span>(fetchPortfolioList.<span class="property">rejected</span>, <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">status</span> = <span class="string">&quot;REJECTED&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> portfolioSlice.<span class="property">reducer</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --store</span></span><br><span class="line"><span class="comment">// index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> counterReducer <span class="keyword">from</span> <span class="string">&quot;./counter/counterSlice&quot;</span></span><br><span class="line"><span class="keyword">import</span> portfolioReducer <span class="keyword">from</span> <span class="string">&quot;./portfolio/portfolioSlice&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">    <span class="attr">reducer</span>: &#123;</span><br><span class="line">        <span class="attr">counter</span>: counterReducer,</span><br><span class="line">        <span class="attr">portfolio</span>: portfolioReducer</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;</span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useAppDispatch</span>: <span class="function">() =&gt;</span> <span class="title class_">AppDispatch</span> = useDispatch</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReduxAsync.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span>, useEffect, <span class="title class_">Fragment</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useAppDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/portfolio/api&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  portfolioListSelector,</span><br><span class="line">  statusSelector,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./redux/store/portfolio/selector&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ReduxAsync</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolioList = <span class="title function_">useSelector</span>(portfolioListSelector);</span><br><span class="line">  <span class="keyword">const</span> status = <span class="title function_">useSelector</span>(statusSelector);</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useAppDispatch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="title function_">fetchPortfolioList</span>());</span><br><span class="line">  &#125;, [dispatch]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status === <span class="string">&quot;PENDING&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>PENDING<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (status === <span class="string">&quot;REJECTED&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>REJECTED<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((portfolio, index: number) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;portfolio.title&#125;<span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReduxAsync</span>;</span><br></pre></td></tr></table></figure>

<p>thunk를 이용하여 &#x2F;api&#x2F;portfolio 를 호출하고 portfolioList를 받아<br>map 을통해 title 을 뿌려주었다.</p>
<p>test-code까지 작성해서 비교해보아야 제대로된 비교가 될거같아서<br><del>redux는 test 하기 편하다는 장점을 가지고있다.</del><br>jest 를 이용하여 테스트 코드까지 작성해보려고한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev jest</span><br><span class="line">$ npm install --save-dev @types/jest</span><br><span class="line">$ npm install --save-dev ts-node</span><br><span class="line">$ npm install --save-dev ts-jest</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;vite&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;tsc &amp;&amp; vite build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lint&quot;</span>: <span class="string">&quot;eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;preview&quot;</span>: <span class="string">&quot;vite preview&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;jest&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// jest.config.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">transform</span>: &#123;</span><br><span class="line">        <span class="string">&quot;^.+\\.tsx?$&quot;</span>: <span class="string">&quot;ts-jest&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이외에도 testing-library&#x2F;react 등등 좋은 라이브러리도 많으니 추후에 자세히 다뤄보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -redux</span></span><br><span class="line"><span class="comment">// --test</span></span><br><span class="line"><span class="comment">// counter.test.ts</span></span><br><span class="line"><span class="keyword">import</span> counterReducer, &#123;</span><br><span class="line">  increment,</span><br><span class="line">  decrement,</span><br><span class="line">  incrementByAmount,</span><br><span class="line">  <span class="title class_">CounterState</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../store/counter/counterSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// describe 는 테스트 스위트를 정의하기 위해 사용되는 함수이다.</span></span><br><span class="line"><span class="comment">// counter reducer 에 관한 테스트를 한다고 설명하는 부분이다.</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;counter reducer&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// initialState 를 선언하고</span></span><br><span class="line">  <span class="comment">// value:0 이라고 값을 초기화 하였고</span></span><br><span class="line">  <span class="comment">// CounterState 라는 타입을 명시했다</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">CounterState</span> = &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// initialState 와 초기값이 같은지 확인하는 부분이다.</span></span><br><span class="line">  <span class="comment">// counterReducer 2번쨰 인자로 action 을 받는다</span></span><br><span class="line">  <span class="comment">// unknown 이라는 액션 타입을 생성하여 reducers 에 추가하면 오류가 발생할수 있다.</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle initial state&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">counterReducer</span>(<span class="literal">undefined</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;unknown&quot;</span> &#125;)).<span class="title function_">toEqual</span>(</span><br><span class="line">      initialState</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// increment,decrement,incrementByAmount 가 각각 잘 동작하는지 확인하는 테스트 케이스이다.</span></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle increment&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">increment</span>());</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle decrement&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">decrement</span>());</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(-<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle incrementByAmount&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> actual = <span class="title function_">counterReducer</span>(initialState, <span class="title function_">incrementByAmount</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="title function_">expect</span>(actual.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>간단하게 counter 테스트 코드를 작성하였다. <del>Render가 잘되었는지까지는 확인하지않겠다.</del><br>각각 주석을 통해 자세하게 설명해 두었다.</p>
<p>이제 portfolio 도 테스트 코드를 작성해 보도록 하자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> portfolioReducer, &#123;</span><br><span class="line">  <span class="title class_">PortfolioState</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;../store/portfolio/portfolioSlice&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; fetchPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;../store/portfolio/api&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">Portfolio</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../../types/Portfolio&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;portfolio reducer&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">initialState</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">    <span class="attr">portfolioList</span>: [&#123; <span class="attr">img</span>: <span class="string">&quot;&quot;</span>, <span class="attr">title</span>: <span class="string">&quot;&quot;</span>, <span class="attr">paragraph</span>: <span class="string">&quot;&quot;</span>, <span class="attr">link</span>: <span class="string">&quot;&quot;</span> &#125;],</span><br><span class="line">    <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// api 응답을 가짜데이터를 통해 만들어 주었다.</span></span><br><span class="line">  <span class="comment">// mock</span></span><br><span class="line">  <span class="keyword">const</span> <span class="attr">mockPortfolioList</span>: <span class="title class_">Portfolio</span>[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;image1.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Title1&quot;</span>,</span><br><span class="line">      <span class="attr">paragraph</span>: <span class="string">&quot;Paragraph1&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;http://link1.com&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">img</span>: <span class="string">&quot;image2.png&quot;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Title2&quot;</span>,</span><br><span class="line">      <span class="attr">paragraph</span>: <span class="string">&quot;Paragraph2&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;http://link2.com&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle initial state&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(<span class="literal">undefined</span>, &#123; <span class="attr">type</span>: <span class="string">&quot;unknown&quot;</span> &#125;)).<span class="title function_">toEqual</span>(</span><br><span class="line">      initialState</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.pending&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: fetchPortfolioList.<span class="property">pending</span>.<span class="property">type</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;FULFILLED&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.fulfilled&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123;</span><br><span class="line">      <span class="attr">type</span>: fetchPortfolioList.<span class="property">fulfilled</span>.<span class="property">type</span>,</span><br><span class="line">      <span class="attr">payload</span>: mockPortfolioList,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">portfolioList</span>: mockPortfolioList,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;FULFILLED&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;should handle fetchPortfolioList.rejected&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: fetchPortfolioList.<span class="property">rejected</span>.<span class="property">type</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">state</span>: <span class="title class_">PortfolioState</span> = &#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;PENDING&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">expect</span>(<span class="title function_">portfolioReducer</span>(state, action)).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">      ...initialState,</span><br><span class="line">      <span class="attr">status</span>: <span class="string">&quot;REJECTED&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>redux-mock-store라는 라이브러리를 사용해서 mockStore 를 만들고<br>middleware 를 추가해서 테스트 할수있다</p>
<p>아니면 아래 코드처럼 action payload 에 api를 호출하는 방법도 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 이전에 만든 테스트 코드 입니다</span></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&quot;action.incrementAsync suc&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="attr">action</span>: <span class="title class_">ReduxAction</span>&lt;number&gt; = &#123;</span><br><span class="line">            <span class="attr">type</span>: actionTypes.<span class="property">INCREMENTASYNC</span>,</span><br><span class="line">            <span class="attr">payload</span>: <span class="keyword">await</span> <span class="title function_">getInt</span>(&#123; <span class="attr">status</span>: <span class="string">&quot;resolve&quot;</span> &#125;),</span><br><span class="line">        &#125;</span><br><span class="line">        reducer.<span class="title function_">incrementAsync</span>(state!, action);</span><br><span class="line">        <span class="title function_">expect</span>(state!.<span class="property">value</span>).<span class="title function_">toEqual</span>(<span class="number">30</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>간단하게 테스트코드까지 작성하였다. 이제 다음엔 recoil 을 사용하여 같은 작업을 하고 비교해 보도록 하겠다.<br>참고:<br><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/">https://redux-toolkit.js.org/</a><br><a target="_blank" rel="noopener" href="https://recoiljs.org/">https://recoiljs.org/</a><br><a target="_blank" rel="noopener" href="https://github.com/immerjs/immer#readme">https://github.com/immerjs/immer#readme</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/05/React/flux-3/" data-id="clhew2w5x00007ejy98fi5yx3" data-title="redux vs recoil 2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/flux-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/02/React/flux-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-02T10:20:24.000Z" itemprop="datePublished">2023-05-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/02/React/flux-2/">redux vs recoil 1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 redux 와 recoil 을 사용해 보고 두 라이브러리들을 비교해 보려고 한다.</p>
<p>우선 고대 유물인 flux를 확인해 보자</p>
<blockquote>
<p>The Flux project has been archived and no further changes will be made. We recommend using more sophisticated alternatives like Redux, MobX, Recoil, Zustand, or Jotai.</p>
</blockquote>
<p>redux 와 recoil 둘 다 flux 아키텍처를 계승해서 만들었기 때문에 둘 다 생김새가 상당히 유사하다.<br>바로 본론으로 들어가 redux부터 알아보자</p>
<h3 id="redux-란"><a href="#redux-란" class="headerlink" title="redux 란"></a>redux 란</h3><blockquote>
<p>자바스크립트 앱을 위한 예측 가능한 상태 컨테이너</p>
</blockquote>
<ol>
<li>Redux는 일관적으로 동작하고, 서로 다른 환경(클라이언트, 서버, 네이티브)에서도 실행되며, 테스트하기 쉬운 앱을 작성하도록 도와줍니다.</li>
<li>앱의 상태와 로직을 중앙화하여 실행 취소&#x2F;다시 실행, 영속적인 상태 등의 강력한 기능을 사용할 수 있게 합니다.</li>
<li>Redux DevTools는 앱의 상태가 언제, 어디서, 왜, 어떻게 바뀌었는지 쉽게 추적할 수 있도록 해줍니다. Redux의 아키텍처를 통해 변경사항을 기록하고, “시간여행형 디버깅”을 사용하고, 완전한 에러 리포트를 서버로 보낼 수 있습니다.</li>
<li>Redux는 어떤 UI 레이어에서도 동작하며, 여러분의 요구에 부합하는 거대한 애드온 생태계를 가지고 있습니다.</li>
</ol>
<p>요약하면 Redux 일관적으로 동작하고 (<del>순수 함수</del>) 서로 다른 환경에서 작동하고 테스트하기 쉬운 앱을 작성하도록 도와준다. 그뿐만 아니라<br>devtools를 이용하여 시간 여행형 디버깅을 제공한다 react 나 vue 같은 라이브러리 와 함께 사용할 수 있다.</p>
<p>항상 여기까지 읽어보면 사용하지 않으면 바보가 된 거 같은 기분이 든다.<br>하지만 이런 redux 도 단점이 엄청 많이 있는데 대표적으로</p>
<ol>
<li>엄청난 보일러 플레이트 코드</li>
<li>여러 라이브러리를 같이 사용하기 때문에 무시하지 못할 러닝 커브</li>
</ol>
<p>등등 장점만 있는 것은 아니다.<br>redux를 사용하면서 항상 많이 고민했던 부분이 전역으로 state를 관리하는 작업이 정말 필요한가? 이였다.<br>component 가 여러 depth를 가지지 않고 전역으로 state를 관리할 필요가 없는 프로젝트를 진행하다 보면<br>redux를 이용해서 개발하는 것이 엄청 부담스럽게 느껴졌다.<br>모든 작업을 action 을 생성해서 dispatch 해주는 것으로 모자라 store를 연결해 주고 initalState 수정해 주고 상당히 번거롭게 느껴질 수 있다.</p>
<p>그래서 이전에 context API를 store처럼 이용하여 전역으로 관리가 필요한 user profile 같은 데이터를 관리했었던 적이 있었다.<br>하지만 이럴 경우 rendering 관련된 이슈에서 자유롭지 못했다.<br>~~시도 때도 없이 온갖 컴포넌트가 rerendering 되었으며 이를 방지하고자 useCallback 과 useMemo 등을 사용했지만 편하게 사용하고 싶어서 채택한 context 가 오히려 불편함을 야기했다. ~~</p>
<p>그러던 중 recoil이라는 기술을 알게 되었고 바로 product에 적용한 경험이 있다.<br>그러면 recoil의 동기를 한번 알아보자</p>
<h3 id="recoil"><a href="#recoil" class="headerlink" title="recoil"></a>recoil</h3><blockquote>
<p>호환성 및 단순함을 이유로 외부의 글로벌 상태관리 라이브러리보다는 React 자체에 내장된 상태 관리 기능을 사용하는 것이 가장 좋다. 그러나 React는 다음과 같은 한계가 있다.<br>컴포넌트의 상태는 공통된 상위요소까지 끌어올려야만 공유될 수 있으며, 이 과정에서 거대한 트리가 다시 렌더링 되는 효과를 야기하기도 한다.<br>Context는 단일 값만 저장할 수 있으며, 자체 소비자(consumer)를 가지는 여러 값의 집합을 담을 수는 없다.<br>이 두 가지 특성이 트리의 최상단(state가 존재하는 곳)부터 트리의 말단(state가 사용되는 곳)까지의 코드 분할을 어렵게 한다.</p>
</blockquote>
<p>recoil의 동기는 간단하다 redux 같은 외부의 글로벌 상태 관리 라이브러리는 호환성 문제가 있을 수 있으며 복잡하다.<br>그래서 react의 내장 상태 관리 기능(useState,…)을 이용하는 것이 좋은데 React가 가지고 있는 한계 (state는 부모로 올려줘야 하고 context는 단일 값만 저장할 수 있다) 때문에 recoil이라는 라이브러리를 만들었다.</p>
<p>recoil 역시 react처럼 facebook에서 개발했기 때문에 react와의 호환 기능성이 좋다</p>
<p>두 라이브러리의 동기에 대해 알아보았으니 이제 두 라이브러리를 간단하게 비교해 보려고 한다</p>
<p>redux와 recoil의 가장 큰 차이점은 상태를 관리하는 방식이라고 생각한다</p>
<p>redux는 단일 스토어 패턴을 사용하여 하나의 저장소에서 상태를 관리하는 반면 recoil은 작은 단위의 atom으로 나누어서 관리한다.</p>
<p>이 때문에 redux는 애플리케이션의 상태를 중앙에서 관리하고 추적하기 쉽게 만들어주고<br>recoil은 상태의 의존성을 명확히 파악할 수 있게 한다</p>
<p>이제 단점을 비교해 보겠다.</p>
<p>redux의 가장 불편한 점은 비동기 작업이다.<br>recoil의 경우 동시성 모드를 지원하여 비동기 작업을 하기 굉장히 편리하다. Suspense API를 사용하여 (<del>데이터를 미리 로딩하여</del>) 반응성을 높일 수 있다.</p>
<p>redux의 경우 미들웨어를 사용해야 한다 (<del>thunk, saga</del>)<br>우선 미들웨어가 무엇인지 먼저 알아보자</p>
<p>redux에서 미들웨어란</p>
<blockquote>
<p>It provides a third-party extension point between dispatching an action, and the moment it reaches the reducer.</p>
</blockquote>
<p>redux의 액션 디스패칭과 리듀서 사이에서 동작하는 플러그인이다(third-party extension).</p>
<p>액션이 디스패치 될 때마다 실행되며 액션의 처리를 변형하거나, 비동기 작업을 처리할 때 사용한다. 이를 이용하여 redux에서 비동기 작업을 처리할 수 있는데<br>상당히 번거롭게 느껴진다.</p>
<p>자 이제 recoil의 단점에 대해서도 알아보자<br>개인적인 생각으로 recoil 은 정말 쉽지만 어렵다.<br>recoil의 강점인 atom으로 상태를 나누는 작업은 간단한 프로젝트의 경우 크게 신경 쓰이지 않지만 프로젝트의 복잡도가 올라가면 올라갈수록 관리하기 어려워진다.</p>
<p>이제 간단하게 장단점에 대해 알아보았으니 다음부턴 실제로 코드를 작성해 보자 마침 간단한 웹서버도 작성이 완료되었으니 비동기 작업을 하는데에 있어서 문제도 없다.</p>
<p>참고 :<br><a target="_blank" rel="noopener" href="https://ko.redux.js.org/introduction/getting-started">redux</a>, <a target="_blank" rel="noopener" href="https://recoiljs.org/ko/">recoil</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/02/React/flux-2/" data-id="clh66zwt400017hjyb9akct22" data-title="redux vs recoil 1" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NodeJs/node-js-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/01/NodeJs/node-js-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-01T05:20:24.000Z" itemprop="datePublished">2023-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/01/NodeJs/node-js-2/">간단한 웹 서버를 만들어 보자 2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>이전에 react-query 를 위한 간단한 웹 서버를 만들었는데<br>이떄 mockData 를 js 의 상수로 선언해 두었다</p>
<p>다시 생각해보니 그냥 json 으로 만들어서 간이 db 처럼 사용하면 put 이나<br>post 요청도 제대로 해볼수 있지않을까? 생각이 들어 해보려고 한다.</p>
<p>우선 data.js 를 json 으로 변경해 주도록 하자</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;portfolio&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;이력서&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/profile.jpeg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;GitHub&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github 링크 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/gastroad&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/github.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;6&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Slides&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pt발표 자료 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://slides.com/coldpotato&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/slides.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Github Blog&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;paragraph&quot;</span><span class="punctuation">:</span> <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gastroad.github.io&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;img&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/assets/image/github.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;etc&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>그리고 데이터를 실제로 사용하는<br>portfolio.service.js 에서 json 을 파싱해서 수정하게 api 를 수정해 주자</p>
<p>etc 를 수정하는 api 는 당장 필요없어 보여 삭제 하였다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dataFilePath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;data.json&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">etc, img, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = &#123;</span><br><span class="line">    etc,</span><br><span class="line">    img,</span><br><span class="line">    link,</span><br><span class="line">    paragraph,</span><br><span class="line">    title,</span><br><span class="line">    <span class="attr">id</span>: portfolio.<span class="property">portfolio</span>.<span class="property">length</span> + <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  portfolio.<span class="property">portfolio</span>.<span class="title function_">push</span>(newPortfolio);</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(dataFilePath, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(portfolio));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">return</span> portfolio.<span class="property">portfolio</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">id, img, etc, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolio = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(fs.<span class="title function_">readFileSync</span>(dataFilePath));</span><br><span class="line">  <span class="keyword">const</span> changeIndex = portfolio.<span class="property">portfolio</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">    <span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id)</span><br><span class="line">  );</span><br><span class="line">  portfolio.<span class="property">portfolio</span>.<span class="title function_">splice</span>(changeIndex, <span class="number">1</span>, [</span><br><span class="line">    &#123; id, img, etc, link, paragraph, title &#125;,</span><br><span class="line">  ]);</span><br><span class="line">  fs.<span class="title function_">writeFileSync</span>(dataFilePath, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(portfolio));</span><br><span class="line">  <span class="keyword">return</span> portfolio;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>우선 json 파일을 편집할 예정이기때문에 내장모듈인 fs 를 불러왔다.<br>그리고 파일을 접근을 위해 path 모듈도 불러왔다 dataFilePath 상수를 선언해 중복되는 data.json 의 경로를 작성해주었다</p>
<p>이후 상황에 맞게 json 을 수정하는 api 를 작성했다.<br>id 의 경우 portfolio.portfolio.length + 1 으로하면<br>데이터 생성,삭제 과정에서 중복 id 가 들어갈수 있으나<br>당장은 id 로 작업하는것이 없으니(유니크한 값이 필요하다면 react 에서 useId 를 사용해도 괜찮을것 같았다) 일단 두었다.</p>
<p>마지막으로 실제로 요청을 보내니 정상적으로 파일을 수정할수 있었다.</p>
<p>node js 가 익숙하지 않으니 포스트로 작성할때 내용이 엄청 부실하고 적지만<br>상당한 시간이 소요된다. <del>정작 js 에서 데이터를 다루는것보다 크게 벗어난 부분은 없는데도..</del><br>백엔드 공부도 소홀하게 하면 안되겠다고 느꼈다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/01/NodeJs/node-js-2/" data-id="clh4el0tz000u6fjyh37y23kv" data-title="간단한 웹 서버를 만들어 보자 2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/react-query-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/24/React/react-query-2/" class="article-date">
  <time class="dt-published" datetime="2023-04-24T09:04:06.000Z" itemprop="datePublished">2023-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/24/React/react-query-2/">react-query를 사용해 보자(2)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 rtk-query를 사용해서 비교해 보려고 한다.</p>
<p>우선 rtk-query의 동기부터 살펴보자</p>
<blockquote>
<p>Tracking loading state in order to show UI spinners<br>Avoiding duplicate requests for the same data<br>Optimistic updates to make the UI feel faster<br>Managing cache lifetimes as the user interacts with the UI</p>
</blockquote>
<p>loading 상태 추적,<br>중복 요청 방지<br>UI가 더 빠르게 느껴지도록 업데이트<br>사용자가 UI와 상호 작용할 때 캐시 수명 관리</p>
<p>react-query 보다 간결하다 (제공하는 기능도 간결하긴 하다.)</p>
<p>rtk-qeury는 어떤 기능을 제공하는지 확인해 보자.</p>
<blockquote>
<p>createApi(): The core of RTK Query’s functionality. It allows you to define a set of endpoints describe how to retrieve data from a series of endpoints, including configuration of how to fetch and transform that data. In most cases, you should use this once per app, with “one API slice per base URL” as a rule of thumb.<br>fetchBaseQuery(): A small wrapper around fetch that aims to simplify requests. Intended as the recommended baseQuery to be used in createApi for the majority of users.<br><ApiProvider />: Can be used as a Provider if you do not already have a Redux store.<br>setupListeners(): A utility used to enable refetchOnMount and refetchOnReconnect behaviors.</p>
</blockquote>
<p>createApi :RTK의 핵심<br>데이터를 패치하고 변환하는 설정을 포함해서 엔드 포인트들에서 어떻게 데이터를 패치하는지 정의<br>대부분의 경우 “기본 URL 당 하나의 API 슬라이스”를 원칙으로 하여 App당 한 번 사용<br>fetchBaseQuery() : 간단한 요청을 위한 fetch 래퍼<br>createApi의 baseQuery를 권장함<br>ApiProvider<br>redux store 가 없을 경우 provider로 사용 가능<br>setupListeners():<br>refetchOnMount와 refetchOnReconnect를 위한 유틸리티</p>
<p>제공하는 기능에 대해서도 대충 알아봤으니 이제 실제 적용해서 사용해 보도록 하자<br>우선 react-ground는 redux를 통해 작성했으니 ApiProvider를 사용할 필요가 없다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<p>createApi를 통해 portfolioApi를 생성해 주었다.<br>RTK 쿼리를 사용하면 일반적으로 전체 API 정의를 한곳에서 정의해야 한다</p>
<p>친절하게도 유지 보수를 위해 코드 분할하는 방법까지도 적혀있지만<br>지금 필요한 기능은 아니니 나중에 필요할 때 찾아보도록 해야겠다<br><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/rtk-query/usage/code-splitting">코드 분할 방법</a></p>
<p>이후 root store에 reducer, middleware를 추가해 주어야 한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> portfolioSlice <span class="keyword">from</span> <span class="string">&quot;./portfolioSlice&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; portfolioApi &#125; <span class="keyword">from</span> <span class="string">&quot;src/api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">portfolio</span>: portfolioSlice.<span class="property">reducer</span>,</span><br><span class="line">    [portfolioApi.<span class="property">reducerPath</span>]: portfolioApi.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">getDefaultMiddleware</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">getDefaultMiddleware</span>().<span class="title function_">concat</span>(portfolioApi.<span class="property">middleware</span>),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useAppDispatch</span>: <span class="function">() =&gt;</span> <span class="title class_">AppDispatch</span> = useDispatch;</span><br></pre></td></tr></table></figure>

<p>이제 실제로 호출을 해보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList, useGetPortfolioListQuery &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reactQuery = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> rtkQuery = <span class="title function_">useGetPortfolioListQuery</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rtkQuery);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;reactQuery.data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>rtk-query는 react-query 랑 같은 유틸리티 불린 값을 제공해 준다<br><del>isLoading, isFetching 등등등</del></p>
<p>이제 post api를 한번 사용해 보도록 하겠다.<br>post의 경우 mutation 을 이용해서 호출할 수 있다.<br>mutation 은 서버에게 데이터 업데이트를 전달하고 로컬에서 변화된 값을 적용시킬 때 사용한다.<br>또한 뮤테이션은 캐시 무효화와 강제 리패칭을 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">postPortfolio</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">(<span class="params">post</span>) =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/portfolio/`</span>,</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">body</span>: post</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery, usePostPortfolioMutation &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio, usePostPortfolioMutation &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [createPortfolio, &#123; isLoading, isError &#125;] = <span class="title function_">usePostPortfolioMutation</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          createPortfolio(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>포스트 요청에 성공했다.</p>
<p>rtk-query 와 react-query를 사용해 보았는데<br>둘 다 기본적인 요청만 해서 그런지 크게 차이점을 모르겠다.</p>
<p>기존에 redux-toolkit 을 사용 중이었다면 수정하기 어렵지 않을 것 같다는 생각을 했다.<br>하지만 fetchBaseQuery를 만들어줘야 해서 나중에 또 다른 기술로 갈아탈 때 고생을 할 거 같다</p>
<p>그리고 rtk-query를 사용하면 server state를 전역으로 관리할 수 있다.<br>store를 사용하다 보니 전역에서 데이터에 접근이 가능하다.<br>react-query의 경우 데이터는 전역으로 관리 되지 않지만<br>키를 기반으로 요청을 관리하기 때문에 여러 컴포넌트에서 여러번 요청을 보내도 한번만 요청이 간다<br><del>추후 devtool 을 이용해서 자세하게 확인해 봐야겠다.</del></p>
<p>react-query의 경우 기존에 만들어둔 axios를 사용해서<br>편하게 개발 가능하고 많은 사람이 이용 중이라 트러블슈팅할 때도 편할 거 같다는 생각을 했다</p>
<p>확실한 건 양쪽 다 server state 관리가 편해졌다.</p>
<p>처음 계획엔 swr 도 알아보려 했는데 swr까지 공부했다가는 깊이가 너무 얕아질 것 같아서 추후에 시간이 있을 때로 미루고 react-query, rtk-query를 좀 더 자세히 알아봐야겠다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/24/React/react-query-2/" data-id="clh4el0tx000k6fjy1c45g5wg" data-title="react-query를 사용해 보자(2)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/react-query-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/22/React/react-query-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-22T12:48:11.000Z" itemprop="datePublished">2023-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/22/React/react-query-1/">react-query를 사용해 보자(1)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>redux를 이용하다 보면 비동기 요청마다 미들웨어를 추가해 주는 작업은 상당히 번거롭게 느껴진다.<br>간단한 요청들은 react-query를 사용해 보려 한다.</p>
<p>react-query에 대해 알아보고 react-query 가 아닌 swr, rtk-query 랑도 비교해 보고 사용해 보려고 한다.</p>
<p>먼저 react-query의 동기부터 살펴보자</p>
<blockquote>
<p>Caching… (possibly the hardest thing to do in programming)<br>Deduping multiple requests for the same data into a single request<br>Updating “out of date” data in the background<br>Knowing when data is “out of date”<br>Reflecting updates to data as quickly as possible<br>Performance optimizations like pagination and lazy loading data<br>Managing memory and garbage collection of server state<br>Memoizing query results with structural sharing</p>
</blockquote>
<p>캐시<br>동일한 데이터에 대한 여러 요청을 단일 요청으로 중복 제거,<br>백그라운드에서 오래된 데이터 알고 업데이트<br>데이터 업데이트를 최대한 신속하게 반영<br>pagination 및 lazy 로딩 데이터와 같은 성능 최적화<br>메모리 관리 와 서버 state의 garbage collection<br>구조적 공유와 query 결과 Memoizing</p>
<p>목록만 봐도 아찔해진다 이쯤 되면 안 쓰면 안 될 거 같은 기분마저 들기 시작한다.</p>
<p>우선 당연하게도 react-query를 설치해 주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @tanstack/react-query</span><br></pre></td></tr></table></figure>

<p>바로 사용을 시작해 보자<br>우선 react-query를 이용하기 위해서는 quertclient를 provider에 넣어 줘야 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Portfolio</span> <span class="keyword">from</span> <span class="string">&quot;page/Portfolio&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;src/store/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;queryClient&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#123;</span>&quot;<span class="attr">root-modal</span>&quot;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Portfolio</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>이제 api를 호출하는 함수를 만들어 두자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// request.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchPortfolioList = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">    <span class="string">&#x27;fetchPortfolioList&#x27;</span>,</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/portfolio&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolio = <span class="keyword">async</span> (<span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/api/portfolio&quot;</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: string</span><br><span class="line">&#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc`</span>, &#123; ...body &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: number</span><br><span class="line">    <span class="attr">etcId</span>: number</span><br><span class="line">&#125;, <span class="attr">body</span>: &#123; <span class="attr">value</span>: string &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, etcId &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc/<span class="subst">$&#123;etcId&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    fetchPortfolioList,</span><br><span class="line">    getPortfolioList,</span><br><span class="line">    postPortfolio,</span><br><span class="line">    getPortfolio,</span><br><span class="line">    putPortfolio,</span><br><span class="line">    postPortfolioEtc,</span><br><span class="line">    putPortfolioEtc,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>api를 너무 과하게 만든 거 같다… <del>기왕 과하게 만들 거면 좀 이쁘게 만들걸 그랬다</del></p>
<p>우선 바로 한번 호출해 보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;/* <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;portfolioList&#125;</span> /&gt;</span> */&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>우선 useQuery를 통해 api 호출이 가능하다.</p>
<p>useQuery에 우선 필수 값인 queryKey 와 queryFn만 넣어서 호출을 확인해 보았다.</p>
<p>이제 차근차근 useQuery에 어떤 옵션들이 들어가고 각각 어떤 일을 하는 친구인지 알아보자</p>
<p>우선 queryKey부터 살펴보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queryKey는 unKnown[] 타입을 받는다</span><br><span class="line">필수 값이다</span><br><span class="line">쿼리에 사용할 쿼리 키다</span><br><span class="line">쿼리 키는 안정적인 hash로 hash 된다.</span><br><span class="line">enabled 이 false로 설정하지 않았으면 key가 변경될 때 자동으로 업데이트한다</span><br></pre></td></tr></table></figure>

<p>그러면 enabled 도 궁금해진다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enabled 은 boolean 타입을 받는다</span><br><span class="line">쿼리가 자동적으로 실행되지 않으려면 false 값을 설정해야 한다.</span><br><span class="line">종속 쿼리에 사용 가능하다</span><br></pre></td></tr></table></figure>

<p>enabled는 api를 호출한 후 그 데이터를 가지고 추가 호출이 일어나야 하는 상황에서 사용할 수 있을 거 같다.</p>
<p>그러면 queryFn 은 뭐 하는 친구일까</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">queryFn 은 (context: QueryFunctionContext) =&gt; Promise&lt;TData&gt; 타입을 받는다.</span><br><span class="line">기본 쿼리 함수가 정의되지 않은 경우에만 필수이다.</span><br><span class="line">쿼리가 데이터를 요청하는 데 사용할 함수이다.</span><br><span class="line">QueryFunctionContext 을 받는다</span><br><span class="line">데이터를 resolve 하거나 오류를 throw 하는 Promise를 return 해야 한다.</span><br><span class="line">데이터는 undefined 일수 없다.</span><br></pre></td></tr></table></figure>

<p>옵션은 여기까지만 확인해 보고 return 항목에 대해서 알아보겠다<br>우선 지금 당장 필요한 건 요청의 상태와 에러 그리고 결과가 필요하다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; status, data, error &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>잘 작동하는 것을 확인했다.</p>
<p>자세한 건 <a target="_blank" rel="noopener" href="https://tanstack.com/query/v4/docs/react/reference/useQuery">tanstack.com</a>에서 확인해 볼 수 있다 useQuery에 정말 수많은 옵션과 return 이 있다.</p>
<p>이제 get api는 확인을 했으니<br>post 와 이에 따른 update를 해보려고 한다.</p>
<p>useMutation이라는 훅을 사용할 예정이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// PortfolioList.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>useMutation 훅에 mutationFn에 post 할 api를 넣어 주었다.<br>이후 onSuccess 옵션을 통해 api 가 성공했을 때 portfolioList를 다시 받아오는 작업을 진행하였다. onError 같이 실패했을 경우 에러 처리도 가능하니 뭔가 필요한 상황이 오면 document를 다시 봐야겠다.</p>
<hr>
<p><del>여기까지 해보고 나니 굳이 다른 api를 만들어 볼 필요가 없었던 거 같다</del>.<br>2023 4&#x2F;26</p>
<p>react-query 사용시 최신 데이터 상태 유지를 도와주지만 반대로<br>최신 데이터 상태가 유지되면 안되는 경우 문제가 생긴다.</p>
<p>예를들어 portfolio의 내용을 편집해야하는 상황일경우<br>getPortfolio 를 useQuery 를 통해 요청하고 이 데이터를 바탕으로<br>사용자의 input 을 통해 수정이 발생한다면 최신상태를 유지하기위한 로직이 방해가 된다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">  <span class="attr">queryKey</span>: [<span class="string">&quot;portfolio&quot;</span>, id],</span><br><span class="line">  <span class="attr">queryFn</span>: getPortfolio,</span><br><span class="line">  <span class="attr">onSuccess</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setPortfolio</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleInputChange</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setPortfolio</span>(...portfolio,[e.<span class="property">target</span>.<span class="property">name</span>]: e.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&#123;portfolio.title&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleInputChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">name</span>=<span class="string">&quot;description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">value</span>=<span class="string">&#123;portfolio.description&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">onChange</span>=<span class="string">&#123;handleInputChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>이런 상황의 경우 강제로 업데이트를 막아야 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">  <span class="attr">queryKey</span>: [<span class="string">&quot;portfolio&quot;</span>, id],</span><br><span class="line">  <span class="attr">queryFn</span>: getPortfolio,</span><br><span class="line">  <span class="attr">cacheTime</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">refetchOnMount</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">refetchInterval</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">refetchIntervalInBackground</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">onSuccess</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setPortfolio</span>(data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>하지만 이럴 경우에는 그냥 react-query 를 사용하지않는게 더 편하게 사용 가능할것으로 보인다 이런경우를 위해 useAxios hooks 도 하나 만들어두자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios, &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">UseAxiosResponse</span>&lt;T&gt; = [</span><br><span class="line">  <span class="title class_">AxiosResponse</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt; | <span class="literal">null</span>,</span><br><span class="line">  boolean,</span><br><span class="line">  <span class="title class_">Error</span> | <span class="literal">null</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> useAxios&lt;T = unknown&gt;(</span><br><span class="line">  <span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>,</span><br><span class="line">): <span class="title class_">UseAxiosResponse</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState&lt;<span class="title class_">AxiosResponse</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt; | <span class="literal">null</span>&gt;(</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> [isLoading, setIsLoading] = useState&lt;boolean&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="title class_">Error</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">fetchData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="title function_">setIsLoading</span>(<span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">axios</span>(config);</span><br><span class="line">        <span class="title function_">setData</span>(response);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="title function_">setError</span>(error);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">setIsLoading</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, [config]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [data, isLoading, error];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useAxios;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 이렇게 사용할수있다</span></span><br><span class="line"><span class="keyword">const</span> &#123; data, isLoading &#125;= useAxios&lt;<span class="title class_">PortfolioCard</span>&gt;(&#123;</span><br><span class="line">  <span class="comment">//axios 설정들</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<hr>
<p>기존에 rtk를 사용해서 createAsyncThunk를 사용해서 extraReducers를 추가해 주는 방식보다 훨씬 간편하게 사용할 수 있는 것 같다.</p>
<p>내일은 rtk-query를 사용해 보고 react-query 랑 비교해 보려고 한다.<br>참고: <a target="_blank" rel="noopener" href="https://tanstack.com/query/latest/docs/react/overview">https://tanstack.com/query/latest/docs/react/overview</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/22/React/react-query-1/" data-id="clh4el0ty000o6fjy13zban0d" data-title="react-query를 사용해 보자(1)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-NodeJs/node-js-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/21/NodeJs/node-js-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-21T11:20:24.000Z" itemprop="datePublished">2023-04-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/21/NodeJs/node-js-1/">간단한 웹 서버를 만들어 보자</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>react-query를 사용해보고 테스트 해보기위해서 간단한 웹 서버를 만들어 보려고한다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gastroad/portfolio">다른 프로젝트</a>를 만들 땐 아래와 같이 mock api를 만들어서 사용했었다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(portfolioCardData);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>setTimeout 으로 비동기(1초) 적으로 데이터를 내려받는 상황을 만들어 주었다.<br>하지만 이럴 경우 여러 상황을 테스트해보기 번거로워 그냥 node로 간단한 웹 서버를 만들어 보려 한다.</p>
<p>우선 터미널에 들어가 간단한 환경 설정을 해주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> node-server</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> node-server</span><br><span class="line"></span><br><span class="line">$ npm init</span><br><span class="line"></span><br><span class="line">$ npm install express nodemon</span><br></pre></td></tr></table></figure>

<p>node-server라는 디렉토리 만들고 express 랑 nodemon 을 설치해 주었다</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#pakage.json</span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon app.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>pakage.json에 nodemon 을 통해서 app.js를 실행하는 scripts를 추가해 주었다.</p>
<p>이제 텍스트 에디터를 통해서 간단한 웹서버를 만들어보려 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// root</span></span><br><span class="line"></span><br><span class="line">app.<span class="property">js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/portfolio&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/portfolio&quot;</span>, portfolioRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on port <span class="subst">$&#123;port&#125;</span>.`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">// -routes</span></span><br><span class="line"><span class="comment">// -- portfolio</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> portfolioController = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">getAll</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">getById</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.controller.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioService = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.service&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolios = portfolioService.<span class="title function_">getAll</span>();</span><br><span class="line">  res.<span class="title function_">json</span>(portfolios);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">getById</span>(id);</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; portfolioCardData &#125; = <span class="built_in">require</span>(<span class="string">&quot;./data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// data.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioCardData = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;이력서&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/profile.jpeg&quot;,</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;GitHub&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;github 링크 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://github.com/gastroad&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/github.png&quot;,</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Slides&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;pt발표 자료 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://slides.com/coldpotato&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/slides.png&quot;,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Github Blog&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/github.png&quot;,</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">portfolioCardData</span>: portfolioCardData &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<p>이제 <a target="_blank" rel="noopener" href="http://localhost:3000/api/portfolio%EB%A1%9C">http://localhost:3000/api/portfolio로</a> 접속해 보면 json 이 잘 내려오는 것을 확인할 수 있다.</p>
<p>이제</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">server</span>: <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;localhost:3000&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>이렇게 하면 &#x2F;api로 들어오는 모든 요청이<br>localhost:3000&#x2F;api로 이동된다.<br>자세한 내용은 <a href="https://gastroad.github.io/2023/04/17/deploy-3/">여기</a>에 작성해 두었다.</p>
<p>이제 프로젝트를 구동해서 동작을 확인해 보겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getPortfolioList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/portfolio&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getPortfolioList</span>();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<p>간단하게 api를 호출을 해보았다.</p>
<p><img src="/img/react-query-1/1.png"></p>
<p>잘 작동하는 것을 확인하였다.<br>동작을 확인했으니 이제 다시 node로 돌아가서 api를 몇 개 더 만들어 주겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// data.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioCardData = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;이력서&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/profile.jpeg&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;GitHub&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;github 링크 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://github.com/gastroad&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/github.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Slides&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;pt발표 자료 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://slides.com/coldpotato&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/slides.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;7&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Github Blog&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/github.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;8&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">portfolioCardData</span>: portfolioCardData &#125;;</span><br></pre></td></tr></table></figure>

<p>api 요청에 대한 응답으로 이중 배열을 받은 상황을 만들고 싶어<br>data를 수정했다.</p>
<p>이에 맞게 api 도 생성해 주었다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> portfolioController = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">getAll</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">post</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">getById</span>);</span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">putById</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/:id/etc&quot;</span>, portfolioController.<span class="property">postEtc</span>);</span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/:id/etc/:etcId&quot;</span>, portfolioController.<span class="property">putEtcById</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.controller.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioService = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.service&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolios = portfolioService.<span class="title function_">getAll</span>();</span><br><span class="line">  res.<span class="title function_">json</span>(portfolios);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; img, etc, link, paragraph, title, &#125; = req.<span class="property">body</span></span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">post</span>(etc, img, link, paragraph, title)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">getById</span>(id);</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; img, etc, link, paragraph, title, &#125; = req.<span class="property">body</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">putById</span>(id, img, etc, link, paragraph, title)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">postEtc</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">postEtc</span>(id, value)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putEtcById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, etcId &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">putEtcById</span>(id, etcId, value)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; portfolioCardData &#125; = <span class="built_in">require</span>(<span class="string">&quot;./data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">etc, img, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = &#123;</span><br><span class="line">    etc, img, link, paragraph, title, <span class="attr">id</span>: i++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">id, img, etc, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; id, img, etc, link, paragraph, title &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">postEtc</span> = <span class="function">(<span class="params">id, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id))</span><br><span class="line">  newPortfolio.<span class="property">etc</span>.<span class="title function_">push</span>(&#123; value, <span class="attr">id</span>: i++ &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putEtcById</span> = <span class="function">(<span class="params">id, etcId, value</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> newPortfolio = portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id))</span><br><span class="line">  <span class="keyword">let</span> newEtc = newPortfolio.<span class="property">etc</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(etcId))</span><br><span class="line">  newEtc.<span class="property">value</span> = value</span><br><span class="line">  newPortfolio.<span class="property">etc</span> = newEtc</span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>body 파싱을 위한 미들웨어를 추가하는 것도 잊지 말자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/portfolio&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/portfolio&quot;</span>, portfolioRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on port <span class="subst">$&#123;port&#125;</span>.`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/21/NodeJs/node-js-1/" data-id="clh4el0ty000r6fjy6sv82h87" data-title="간단한 웹 서버를 만들어 보자" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Terminal/hosts" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/18/Terminal/hosts/" class="article-date">
  <time class="dt-published" datetime="2023-04-18T10:58:57.000Z" itemprop="datePublished">2023-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/18/Terminal/hosts/">hosts 파일에 대해서 알아보자</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 hosts 파일 수정하는 법에 대해서 알아보도록 하겠다</p>
<h3 id="host-파일-이란"><a href="#host-파일-이란" class="headerlink" title="host 파일 이란"></a>host 파일 이란</h3><blockquote>
<p>hosts 파일은 운영 체제가 호스트 이름을 IP 주소에 매핑할 때 사용하는 컴퓨터 파일이다.</p>
</blockquote>
<p>쉽게 브라우저에 도메인을 입력했을 때 해당하는 IP 주소에 매핑을 해줘 찾아갈 수 있게 하는 파일이다.</p>
<p>가장 대표적으로 localhost 가 있다<br>127.0.0.1 IP를 localhost라는 도메인에 매핑을 해 브라우저에 localhost 라 입력을 해도 알아서 127.0.0.1로 찾아가게 된다.</p>
<p>자 이제 그러면 언제 어떻게 사용하는가</p>
<p>프론트엔드 개발을 하는 경우 주로 로컬 개발 서버를 띄워서 작업을 진행할 것이다.<br>그러면 보통 localhost 즉 127.0.0.1에 웹서버를 띄워서 작업을 진행할 텐데<br>카카오톡이나 페이스북 등 소셜 로그인(oauth) 기능을 구현해야 하는 상황에서 hosts 파일을 수정하면 편리하게 개발할 수 있다.</p>
<p>카카오톡을 예시로 들겠다<br>소셜 로그인을 구현하는 방법까지는 다루지 않도록 하겠다.</p>
<p>카카오 로그인 기능을 구현할 때 크게 3가지 단계로 구분해서 개발을 진행했다</p>
<ol>
<li>code 발급받기</li>
<li>발급받은 code를 가지고 access token 발급받기</li>
<li>발급받은 access token 을 가지고 auth token(login) 발급받기</li>
</ol>
<p>이중 첫 번째 code 발급받는 과정에서 hosts 파일을 수정하여 유용하게 사용할 수 있다<br>code를 발급받으려면 url 을 redirect 시켜야 한다.<br>이 과정에서 카카오톡 애플리케이션에 Redirect URI를 미리 등록해 두어야 한다.</p>
<p>이때 Redirect URI에 localhost를 넣을 순 있지만.<br>서비스를 계속 운영하면서 localhost를 넣어둔 채로 작업하기에는 다소 찜찜하기에<br><del>나의 경우</del> production, stage에서 redirect를 받을 URI만 넣어주었다.</p>
<p>이 경우 oauth를 개발하면서 계속 확인해 보고 테스트해 봐야 하는데 그때마다 배포해서 확인해 볼 수는 없으니<br>이때 hosts 파일을 수정해서 작업이 가능하다.</p>
<p>자 그러면 이제 실제로 hosts 파일을 수정하는 방법에 대해 알아보도록 하자</p>
<p>hosts 수정은 정말 간단하다 우선 하단에 링크해둔 위키백과에서 본인에 맞는 os의 hosts 파일 위치를 찾아보자.<br>맥 OS X 10.2 이상을 사용하고 있으니 &#x2F;etc&#x2F;hosts에 있을 것이다 그럼 바로 터미널로 들어가서 파일을 수정해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/hosts</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># Host Database</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># localhost is used to configure the loopback interface</span></span><br><span class="line"><span class="comment"># when the system is booting.  Do not change this entry.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">255.255.255.255 broadcasthost</span><br><span class="line">::1             localhost</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>여기서 왼쪽에 IP 오른쪽에 도메인을 입력하면 해당하는 도메인에 해당하는 IP로 매핑을 해준다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost</span><br><span class="line">255.255.255.255 broadcasthost</span><br><span class="line">::1             localhost</span><br><span class="line"></span><br><span class="line"><span class="comment">#은 주석이다 호스트 파일읋 수정해두고 까먹을 때도 많으니 주석으로 왜 이런 내용을 추가했는지 적어주도록하자.</span></span><br><span class="line">127.0.0.1       naver.com</span><br></pre></td></tr></table></figure>

<p>위와 같이 설정해두고 naver.com에 접속하면 127.0.0.1 즉 localhost 가 보이게 된다.<br>만약 위와 같이 설정을 했는데도 적용이 잘 안 된 거 같다 싶으면 사용하고 있는 브라우저를 완전히 껐다가 다시 켜보자.</p>
<p>이렇게 Hosts를 수정해서 ouath를 보다 편하게 개발할 수 있다.</p>
<p>물론 ouath 개발을 편하게 하는 방법 중에는<br>환경 변수 같은 걸 이용해서 local stage production 다 다른 카카오톡 어플리케이션을 바라보게 해서<br>localhost를 redirect 하여 작업을 해도 무방하다</p>
<p>본인이 개발할 수 있는 상황에 맞는 편한 방법을 사용해서 개발하면 된다고 생각한다.</p>
<p>참고:<a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/Hosts">https://ko.wikipedia.org/wiki/Hosts</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/18/Terminal/hosts/" data-id="clh4el0tz000x6fjy0necdjy3" data-title="hosts 파일에 대해서 알아보자" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Terminal/" rel="tag">Terminal</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-build&amp;deploy/deploy-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/17/build&deploy/deploy-3/" class="article-date">
  <time class="dt-published" datetime="2023-04-17T11:43:50.000Z" itemprop="datePublished">2023-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/17/build&deploy/deploy-3/">CORS에 대해서 알아보자</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 CORS에 대해서 알아보도록 하겠다. 중요하고 자주 에러가 발생하기도 하니 조금 자세하게 다뤄보도록 하겠다.</p>
<p>바로 본론으로 들어가</p>
<h3 id="CORS-란"><a href="#CORS-란" class="headerlink" title="CORS 란"></a>CORS 란</h3><blockquote>
<p>Cross-Origin Resource Sharing<br>교차 출처 리소스 공유</p>
</blockquote>
<p>웹 애플리케이션은 리소스가 자신의 출처(도메인, 프로토콜, 포트)와 다를 때 교차 출처 HTTP 요청을 실행한다.</p>
<p>api를 사용하다 보면 CORS 에러는 한 번쯤은 봤을 거라고 생각한다.</p>
<p>보안 상의 이유로, 브라우저는 스크립트에서 시작한 교차 출처 HTTP 요청을 제한한다.<br>예를 들어 XMLHttpRequest, Fetch API는 동일 출처 정책을 따른다.<br>즉, 이 API를 사용하는 웹 애플리케이션은 자신의 출처와 동일한 리소스만 불러올 수 있으며, 다른 출처의 리소스를 불러오려면 그 출처에서 올바른 CORS 헤더를 포함한 응답을 반환해야 한다.</p>
<p>자 그러면 출처에 대해서 자세하게 알아보자<br>우선 앞서 출처 도메인, 프로토콜, 포트라고 했다<br>그러면 도메인과 프로토콜 포트가 각각 어떤 것인지 알아보자</p>
<p>url 은 보통 다음과 같은 구조를 가진다.</p>
<p><code>&#123;protocol&#125;://&#123;Domain&#125;/&#123;path&#125;?&#123;paramater&#125;#&#123;fragment&#125;</code></p>
<p><code>https://www.google.com/search?q=%EA%B5%AC%EA%B8%80&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2#imgrc=_6YUFvCeFGUOSM</code></p>
<p>예시를 위해 구글에서 구글을 검색해 이미지 탭에 들어간 링크를 가져왔다</p>
<ol>
<li>protocol<br>https(hypertext transfer protocol secure) 이다 html 같은 파일을 통신하기 위한 protocol 이다.</li>
<li>Domain<br><a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a> 이다</li>
<li>path<br>&#x2F;search 이다</li>
<li>paramater<br><code>?q=%EA%B5%AC%EA%B8%80&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2</code><br>이 부분이며 url encoding 되어있기 때문에 decode 해보면 아래와 같이 나온다.<br><code>?q=구글&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2</code><br><del>한글의 경우 url encoding 을 진행하면 url 이 굉장히 해석하기 힘들어진다.</del></li>
<li>fragment<br>#imgrc&#x3D;_6YUFvCeFGUOSM 이다</li>
</ol>
<p>자 그러면 위에서 나온 <code>출처</code> 중 protocol, 과 도메인이 뭔지는 알았을거다 그러면 포트 뭐길래 안 보이는 건가.</p>
<ol start="6">
<li>포트<br>위 링크의 경우 포트는 443 번이다<br>프로토콜에 따라 할당된 기본 포트가 있고 https의 경우 443 번이 기본 포트이기 때문에 443 은 생략이 가능하다<br>예시로 http 프로토콜의 경우 80이 기본 포트이고<br>80 포트의 경우 생략이 가능하다.</li>
</ol>
<p>그러면 출처에 대해서 이해했으니 다시 CORS로 넘어가도록 하자</p>
<p>출처가 다르면 CORS 헤더를 포함한 응답을 반환해야 한다는데<br>만약 출처가 다른 곳에서 api를 호출하고 싶으면 어떻게 해야 할까</p>
<p>CrossOrigin 어노테이션 사용하기, Preflight Request, 등등 많은 방법이 있지만<br>이번 포스트에서는 proxy를 이용하는 방법을 사용하도록 하겠다.</p>
<h3 id="Proxying-이란"><a href="#Proxying-이란" class="headerlink" title="Proxying 이란"></a>Proxying 이란</h3><blockquote>
<p>Proxying is typically used to distribute the load among several servers, seamlessly show content from different websites, or pass requests for processing to application servers over protocols other than HTTP.</p>
</blockquote>
<p>일반적으로 여러 서버 간에 로드를 분산하거나,<br>서로 다른 웹 사이트의 콘텐츠를 원활하게 표시하거나,<br>HTTP 이외의 프로토콜을 통해 애플리케이션 서버에 처리 요청을 전달하는 데 사용된다 한다.</p>
<p>개발 환경에서의 proxy 부터 알아보겠다.</p>
<p>webpack devserver를 사용해서 proxy 설정에 대해 알아보자</p>
<p>devserver 옵션 중에 proxy라는 옵션이 있다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     &#x27;/api&#x27;<span class="punctuation">:</span> &#x27;http<span class="punctuation">:</span><span class="comment">//localhost:3000&#x27;,</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>&#x2F;api&#x2F;users에 대한 요청은 이제 <a target="_blank" rel="noopener" href="http://localhost:3000/api/users%EC%97%90">http://localhost:3000/api/users에</a> 대한 요청으로 프록시 처리한다.</p>
<p>만약 유효하지 않은 https 인증서로 개발을 진행하고 있다면</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      &#x27;/api&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        target<span class="punctuation">:</span> &#x27;https<span class="punctuation">:</span><span class="comment">//other-server.example.com&#x27;,</span></span><br><span class="line">        secure<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>secure를 false로 처리하면 된다.<br>&#x2F;api&#x2F;users에 대한 요청은 이제 <a target="_blank" rel="noopener" href="https://other-server.example.com/api/users%EC%97%90">https://other-server.example.com/api/users에</a> 대한 요청으로 프록시 처리한다.</p>
<p>자 그러면 이제 개발 단계에서의 프록시 처리에 대해서 알아봤다.<br>추가로 더 필요한 문법은 하단 참고 링크에 webpack docs를 링크해 뒀으니 찾아보기를 바란다.<br><del>웹 팩 설정은 필요할 때마다 처한 상황에 때라 하나씩 찾아보면서 설정하게 되는 거 같다.</del></p>
<p>이제 production 단계에서는 어떻게 처리하나 확인해 볼 차례이다.<br>production 을 webpack devserver로 돌릴 게 아니라면 결국<br>번들링 된 결과물 일뿐인데 외부 웹서버를 사용하는 환경에서는 cors 에러를 어떻게 처리하나 알아보자.</p>
<p>여기서부터는 devops 엔지니어 분이 봐주시던 부분이라 부끄럽게도 잘 모르는 영역이다.</p>
<p>nginx의 기능 중 하나인 reverse Proxy server를 사용해서 proxy 설정을 하려 한다.</p>
<p>우선 nginx에 대해서 알아보도록 하겠다.</p>
<h3 id="nginx란"><a href="#nginx란" class="headerlink" title="nginx란"></a>nginx란</h3><blockquote>
<p>NGINX is a high‑performance, highly scalable, highly available web server, reverse proxy server, and web accelerator (combining the features of an HTTP load balancer, content cache, and more)</p>
</blockquote>
<p>NGINX는 고성능, 고 확장성, 고가용성 웹 서버, 역방향 프록시 서버 및 웹 가속기 (HTTP 로드 밸런서, 콘텐츠 캐시 등의 기능 결합)라고 한다</p>
<p>그러면 웹 서버는 뭘 하는 걸까</p>
<blockquote>
<p>Serving static and index files, autoindexing; open file descriptor cache;</p>
</blockquote>
<p>정적 파일과 인덱스 파일 제공, 오토인덱싱, 파일 디스크립터 캐시 등의 기능을 제공하는 걸 말한다<br>즉 react에서 번들링 한 결과물을 제공하고 디렉토리에 대한 요청이 있을 때 디렉토리 내의 파일을 자동으로 생성해서 보내주고 파일 구조체를 캐시 해서<br>파일의 접근시간을 줄여준다고 이해했다.</p>
<p>자 그러면 역방향 프록시 서버(reverse Proxy server)는 뭘까</p>
<h3 id="reverse-Proxy-server"><a href="#reverse-Proxy-server" class="headerlink" title="reverse Proxy server"></a>reverse Proxy server</h3><blockquote>
<p>Reverse proxy server는 클라이언트로부터 요청을 받아서 백엔드 서버로 전달하는 서버입니다. 일반적인 프록시 서버와 달리, 클라이언트는 백엔드 서버의 존재를 알지 못하고, 리버스 프록시 서버의 주소만 알고 있습니다.</p>
</blockquote>
<p>그럼 왜 이런 번거로운 일을 하는 걸까</p>
<p>백엔드 서버에 직접적인 접근을 허용하지 않고, 리버스 프록시 서버를 통해서만 접근하도록 설정하면, 보안상의 이점이 있다고 한다.<br>또한<br>리버스 프록시 서버는 캐시 기능을 제공하여, 동일한 요청에 대해서는 백엔드 서버로의 요청을 최소화할 수 있다고 한다.</p>
<p>자 이제 개념에 대해서 알아봤으니 이전에 dockerize 한 프로젝트에 nginx 설정에서 프록시 설정을 해보도록 하겠다.</p>
<p>이전에 작성한 Dockerfile 에서 nginx 부분을 조금더 자세하게 알아보자<br>이전에 작성한 Dockerfile 은 <a href="https://gastroad.github.io/2023/04/09/deploy-2/">여기</a> 에 서 볼수있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:latest</span><br><span class="line">RUN <span class="built_in">rm</span> -rf /etc/nginx/conf.d</span><br><span class="line">COPY conf /etc/nginx</span><br><span class="line">COPY --from=build /usr/src/app/build /usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<p>그때 자세하게 설명하지 않았지만<br>위 내용은 &#x2F;etc&#x2F;nginx&#x2F;conf.d에 있는 nignx 기본 설정을 삭제하고<br>conf 디렉토리를 복사해 &#x2F;etc&#x2F;nginx 붙여 넣는 부분이다.</p>
<p>conf 디렉토리는 다음과 같이 구성했었다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-conf</span><br><span class="line">--conf.d</span><br><span class="line">    default.conf</span><br></pre></td></tr></table></figure>

<p>default.conf 파일은 다음과 같이 구성했다</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    location / <span class="punctuation">&#123;</span></span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>리버스 프록시 서버를 설정하는 방법은 생각보다 정말 간단하다<br>document에 따르면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /some/path/ &#123;</span><br><span class="line">    proxy_pass http://www.example.com/link/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이라고 한다 그렇다고 하면<br>아까 웹 팩 데브 서버에서 설정한 것과 똑같이 설정하려면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    location /api &#123;</span><br><span class="line">        proxy_pass https://other-server.example.com/api</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이런 식으로 설정해 주면 된다.</p>
<hr>
<p>2023.05&#x2F;01<br>proxy_pass 의 경우 docker를 통해 도커화 했을경우에<br>도메인을 입력하면 내부에서 찾아가지 못한다고 한다 이 경우<br>다른 도커 컨테이너의 이름이나 ip 주소를 입력해 주어야 한다고한다.</p>
<hr>
<p>실제 production에 배포해서 확인해 보지 못한 게 아쉬웠다.<br>만약 production에 배포했다 치더라도 api 서버를 개발할 능력도 부족하고 서브도메인을 파서 api 서버를 따로 띄워주는데도 한참 걸릴 거라 생각하지만<br>그래도 대충이라도 api 서버를 파서 동작을 확인해 봤으면 더 좋았을 거 같다.<br>빌드 배포에 관한 내용은 여기까지 작성하고 다음부터는 flux에 대해 작성하도록 하겠다.</p>
<p><del>분명 시작할 때는 주제가 CORS였는데</del></p>
<p>참고<br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy</a><br><a target="_blank" rel="noopener" href="https://webpack.kr/configuration/dev-server/#usage-via-api">https://webpack.kr/configuration/dev-server/#usage-via-api</a><br><a href="docs.nginx.com/nginx/admin-guide/web-server">docs.nginx.com&#x2F;nginx&#x2F;admin-guide&#x2F;web-server</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/17/build&deploy/deploy-3/" data-id="clh4el0u000196fjy2z321i0y" data-title="CORS에 대해서 알아보자" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build-deploy/" rel="tag">build&amp;deploy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-React/flux-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/15/React/flux-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-15T06:49:05.000Z" itemprop="datePublished">2023-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/15/React/flux-1/">flux 패턴이란</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 flux 패턴에 대해서 알아보려고 한다<br>react를 사용해서 개발을 진행하게 되면 한 번쯤은 들어봤을 거라고 생각한다.</p>
<p>본론으로 들어가기 전 이 포스트는 개인의 경험과 이해를 바탕으로 쓰였으므로<br>틀린 내용이 있을 수 있습니다.<br>혹시 틀린 내용을 발견하게 된다면 <a href="mailto:&#103;&#111;&#115;&#x74;&#x72;&#111;&#97;&#x64;&#x33;&#x37;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#x63;&#111;&#109;">&#103;&#111;&#115;&#x74;&#x72;&#111;&#97;&#x64;&#x33;&#x37;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#x63;&#111;&#109;</a> 으로 메일 주시면 감사하겠습니다.<br>정확한 내용은 하단 참고 링크에 쓰인 공식 document를 참고하기를 바랍니다.</p>
<h3 id="FLUX-란"><a href="#FLUX-란" class="headerlink" title="FLUX 란"></a>FLUX 란</h3><blockquote>
<p>Application architecture for building user interfaces</p>
</blockquote>
<p>즉 사용자가 보는 화면을 만들기 위한 애플리케이션 구조라고 이해했다.</p>
<p>단방향 데이터 흐름을 활용해 뷰 컴포넌트를 구성하는 React를 보완하기 위해서 개발된 것으로 알고 있다.</p>
<p>바로 flux의 구조와 데이터 흐름에 대해서 알아보도록 하자</p>
<p><img src="/img/flux/1.png" alt="https://facebookarchive.github.io/flux/docs/in-depth-overview"></p>
<p>공식 도큐먼트를 보면 아래와 같이 설명한다</p>
<blockquote>
<p>All data flows through the dispatcher as a central hub. Actions are provided to the dispatcher in an action creator method, and most often originate from user interactions with the views. The dispatcher then invokes the callbacks that the stores have registered with it, dispatching actions to all stores. Within their registered callbacks, stores respond to whichever actions are relevant to the state they maintain. The stores then emit a change event to alert the controller-views that a change to the data layer has occurred. Controller-views listen for these events and retrieve data from the stores in an event handler. The controller-views call their own setState() method, causing a re-rendering of themselves and all of their descendants in the component tree.</p>
</blockquote>
<p>정리하자면<br>모든 action 은 dispatcher에게 action creator 메서드를 제공한다<br>dispatcher는 action을 store로 전달한다<br>store를 바탕으로 view를 렌더링 한다<br>라고 이해를 했다.</p>
<p>위와 같은 데이터 흐름으로 flux는 단방향(action &#x3D;&gt; dispatcher &#x3D;&gt; store &#x3D;&gt; view) 데이터 흐름을 만들었다.</p>
<p>그러면 이쯤에서 궁금하게 된 것이 react 도 결국 단방향 데이터 흐름을 가지고 있는데 왜 flux라는 것이 필요하고 왜 굳이 store에 dispatcher를 통해 action 을 보내는 번거로운 짓을 해야 하는 거지?<br><del>심지어 flux 패턴을 구현한 redux는 어마 무시한 Boilerplate 코드 때문에 한동안 사용하지 않으려고 별 이상한 시도를 많이 했었다. 현재는 RTK 덕분에 애용하고 있다</del></p>
<p>flux 아키텍처를 개발한 이유가 mvc 패턴이 양방향 데이터 흐름을 가지고 있고<br>이 양방향 데이터 흐름이 시스템의 복잡도를 기하급수적으로 증가시키고, 예측 불가능한 코드를 만들게 된다고 했다 이 예측 불가능한 코드가<br>예측 불가능한 버그를 쏟아져 내기 때문에 만든 아키텍처가 flux인데<br>react 도 결국 부모 component에서 자식 component로 props를 전달하고 자식은 부모로부터 받은 props를 수정할 수 없으니 단방향 데이터 흐름을 가지고 있는 거 아닌가?라는 생각이 들었다</p>
<p>하지만 위와 같이 flux 패턴으로 개발하게 되면 component의 종속성 없이<br>단방향으로 데이터를 흐르게 할 수 있다<br>이렇게 되면 프로젝트의 확장에 따라 부모 component 가 점점 복잡해지는 문제를 해결할 수 있다.</p>
<p>이번 포스트에서 flux 패턴을 구현하는 방법이나 flux 패턴을 구현한 redux, recoil 같은 라이브러리도 다룰까 생각했으나 포스트가 너무 길어질 거 같아 다음에 작성해 보려 한다.</p>
<p>참고 : <a target="_blank" rel="noopener" href="https://facebookarchive.github.io/flux/">https://facebookarchive.github.io/flux/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/15/React/flux-1/" data-id="clh66zwt200007hjyg72mey6h" data-title="flux 패턴이란" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-SEO/Refactoring-SEO" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/13/SEO/Refactoring-SEO/" class="article-date">
  <time class="dt-published" datetime="2023-04-13T10:42:39.000Z" itemprop="datePublished">2023-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/13/SEO/Refactoring-SEO/">Refactoring-SEO</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>회사 코드를 공개해도 된다는 허락을 받았다 그래서 오늘 작업 내용 중 리팩토링 한 부분을 하나 올려서 설명해 보려고 한다</p>
<p>우선 현재 상황은 다음과 같다</p>
<ol>
<li>public index.html에 title description 등등의 여러 meta 태그들이 선언되어 있다</li>
<li>react-helmet-async를 사용하여 title, description 등등 여러 meta 태그들을 추가하고 있다</li>
<li>server.js라는 파일을 통해 서버사이드에서 html을 수정하고 프로젝트를 가동한다.</li>
</ol>
<p>위와 같은 상황이다 보니 프로젝트 내에서 meta 태그들을 을 선언하거나 수정하는 곳을 찾기가 매우 어려웠다<br>또 메타 태그들이 중복되어 선언되는 문제가 발생하고 있었다.</p>
<p>우선 production 배포를 어떻게 하는지부터 알아보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t XXXX:&#123;tag_no&#125; .</span><br></pre></td></tr></table></figure>

<p>위 명령어를 통해서 도커 이미지를 생성한 다음 aws에 push 하는 방식이다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM node:14.17.1-alpine3.13</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">mkdir</span> /app</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY . /app</span><br><span class="line"></span><br><span class="line">RUN yarn install</span><br><span class="line">RUN yarn build</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD node server.js</span><br></pre></td></tr></table></figure>

<p>node 14 버전에 … node server.js로 서빙을 하는 것으로 확인된다</p>
<p>build를 어떻게 하는지도 package.json 을 통해 확인해 보았다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;node ./scripts/build.js&quot;</span>,</span><br></pre></td></tr></table></figure>

<p>scripts 디렉토리에 build.js라는 파일을 작성해서 이 파일을 실행하면 빌드가 되고 server.js를 통해 서빙한다</p>
<p>자 우선 문제는 대충 파악했으니 수정을 시작해 보려고 한다 SEO를 개선해야 하는 작업 중이기 때문에 server side에서 메타 태그를 넣어주는 게<br>client side에서 수정하는 것보다 좋을 거 같다는 판단을 했다.</p>
<p>또한 react-helmet-async를 통해 추가하고 있는 meta 태그들을 전부 삭제해 주고 server.js에서 전부 관리하면 서버에서<br>매타 태그도 수정하고 관련 수정을 할 때도 server.js 파일 하나만 보고 수정하면 되니까 좀 더 편하지 않을까라고 생각했다</p>
<p>따라서 react-helmet-async를 통해 추가하고 있던 meta 태그들을 어떤 데이터를 사용하는지 체크해두고 전부 삭제해 주었다.</p>
<p>이제 로컬 서버를 띄운 후 개발자 도구에 element를 통해 meta 태그를 확인해 보니 중복으로 추가되고 있었던 meta 태그들이 사라졌다</p>
<p>이후 server.js에서 meta 태그 수정이 잘 되나 확인차 description 하나를 수정해 보니 로컬 서버에서 적용이 되지 않는다.<br>따라서 pakage.json 을 다시 확인해 보니</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./scripts/start.js&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>npm start 명령어를 통해 로컬 서버를 구동했는데 scripts&#x2F;start.js라는 다른 노드 파일을 통해 서빙이 되고 있었다.<br>그래서 이대로라면 결과물을 확인할 수 없어 node server.js 명령어를 통해 로컬 서버를 띄웠다.</p>
<p>수정한 결과가 잘 반영된다.</p>
<p>이제 수정한 결과물도 확인할 수 있게 되었으니 server.js를 내 입맛대로 수정하려고 한다 node에 이해도가 뛰어난 편이 아니니 확실히 알고 있고 개선할 수 있는 부분만 수정하려고 한다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>([<span class="string">&quot;/?/:Id&quot;</span>, <span class="string">&quot;/?/:Id/*&quot;</span>], <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Id</span> &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: body &#125; = <span class="keyword">await</span> axios</span><br><span class="line">    .<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;API&#125;</span>/v2/?/<span class="subst">$&#123;Id&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> err.<span class="property">response</span>);</span><br><span class="line">  <span class="keyword">const</span> tour = body.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">document</span> = parse5.<span class="title function_">parse</span>(html);</span><br><span class="line">  <span class="keyword">const</span> title = tour.<span class="property">name</span> || <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line">  <span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, title, <span class="string">&quot;title&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> description = _.<span class="title function_">get</span>(tour, <span class="string">&quot;description&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;description&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: title,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:title&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: title,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: description,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;canonical-link&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;href&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: req.<span class="property">originalUrl</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> bestReview = _.<span class="title function_">get</span>(tour, <span class="string">&quot;represent_review&quot;</span>);</span><br><span class="line">  <span class="title function_">changeTagValue</span>(</span><br><span class="line">    <span class="variable language_">document</span>,</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;@context&quot;: &quot;https://schema.org/&quot;,</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Product&quot;,</span></span><br><span class="line"><span class="string">  &quot;image&quot;: [</span></span><br><span class="line"><span class="string">  &quot;&#123;정적파일&#125;&quot;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;description&quot;: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">  &quot;mpn&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">  &quot;sku&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">  &quot;brand&quot;: &#123;</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Thing&quot;,</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;XXXX&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;aggregateRating&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;AggregateRating&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    ratingValue: _.get(tour, <span class="string">&quot;overall_rating&quot;</span>) || <span class="number">4.5</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    reviewCount: _.get(tour, <span class="string">&quot;review_count&quot;</span>) || <span class="number">1</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;)&#125;</span>,</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    !!bestReview</span></span></span><br><span class="line"><span class="subst"><span class="string">      ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &quot;review&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    reviewBody: bestReview.content,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    reviewRating: &#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      ratingValue: bestReview.rate,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    datePublished: format(<span class="keyword">new</span> <span class="built_in">Date</span>(bestReview.created_at), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    author: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, name: bestReview.author_username &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    publisher: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, name: <span class="string">&quot;XXXXX&quot;</span> &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">  &#125;)&#125;</span>,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  `</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;</span></span></span><br><span class="line"><span class="string">  &quot;offers&quot;: [</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Offer&quot;,</span></span><br><span class="line"><span class="string">  &quot;priceCurrency&quot;: &quot;KRW&quot;,</span></span><br><span class="line"><span class="string">  &quot;priceValidUntil&quot;: &quot;2099-12-25&quot;,</span></span><br><span class="line"><span class="string">  &quot;itemCondition&quot;: &quot;https://schema.org/NewCondition&quot;,</span></span><br><span class="line"><span class="string">  &quot;availability&quot;: &quot;http://schema.org/InStock&quot;,</span></span><br><span class="line"><span class="string">  &quot;url&quot;: &quot;<span class="subst">$&#123;req.protocol&#125;</span>://<span class="subst">$&#123;req.hostname&#125;</span><span class="subst">$&#123;req.originalUrl&#125;</span>&quot;,</span></span><br><span class="line"><span class="string">  &quot;seller&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;@type&quot;: &quot;Organization&quot;,</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;XXXXX&quot;</span></span><br><span class="line"><span class="string">  &#125;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    !!_.get(tour, <span class="string">&quot;price&quot;</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">      ? <span class="string">`,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &quot;price&quot;: &quot;<span class="subst">$&#123;_.get(tour, <span class="string">&quot;price&quot;</span>)&#125;</span>&quot;`</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;</span></span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;name&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(_.get(tour, <span class="string">&quot;name&quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">&#125;`</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;script&quot;</span>,</span><br><span class="line">    [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(parse5.<span class="title function_">serialize</span>(<span class="variable language_">document</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>대략 정신이 아찔해진다<br>changeTagAttr, changeTagValue 두 함수를 통해 document에 존재하는 html 태그를 찾고 수정해 주는 코드로 보인다<br>우선 함수를 통해 태그를 수정하는 부분과 수정할 value를 분리해서 봐야 눈에 좀 보일 거 같아 그 작업을 먼저 진행해 주었다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tour = body.<span class="property">data</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable language_">document</span> = parse5.<span class="title function_">parse</span>(html);</span><br><span class="line"><span class="keyword">const</span> title = <span class="string">`<span class="subst">$&#123;tour.name&#125;</span> || &#x27;XXXX,`</span>;</span><br><span class="line"><span class="keyword">const</span> description = _.<span class="title function_">get</span>(tour, <span class="string">&quot;description&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> bestReview = _.<span class="title function_">get</span>(tour, <span class="string">&quot;represent_review&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> richSnippetValue = <span class="string">`</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;@context&quot;: &quot;https://schema.org/&quot;,</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Product&quot;,</span></span><br><span class="line"><span class="string">      &quot;image&quot;: [&quot;&#123;정적파일&#125;&quot;],</span></span><br><span class="line"><span class="string">      &quot;description&quot;: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">      &quot;mpn&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">      &quot;sku&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">      &quot;brand&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Thing&quot;,</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;XXXX&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;aggregateRating&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;AggregateRating&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">        ratingValue: _.get(tour, <span class="string">&quot;overall_rating&quot;</span>),</span></span></span><br><span class="line"><span class="subst"><span class="string">        reviewCount: _.get(tour, <span class="string">&quot;review_count&quot;</span>),</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;)&#125;</span>,</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        !!bestReview</span></span></span><br><span class="line"><span class="subst"><span class="string">          ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      &quot;review&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        reviewBody: bestReview.content,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        reviewRating: &#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">          <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">          ratingValue: bestReview.rate,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        datePublished: format(<span class="keyword">new</span> <span class="built_in">Date</span>(bestReview.created_at), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        author: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, name: bestReview.author_username &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        publisher: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, name: <span class="string">&quot;XXXXX&quot;</span> &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      &#125;)&#125;</span>,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      `</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span></span></span><br><span class="line"><span class="string">      &quot;offers&quot;: [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Offer&quot;,</span></span><br><span class="line"><span class="string">      &quot;priceCurrency&quot;: &quot;KRW&quot;,</span></span><br><span class="line"><span class="string">      &quot;priceValidUntil&quot;: &quot;2099-12-25&quot;,</span></span><br><span class="line"><span class="string">      &quot;itemCondition&quot;: &quot;https://schema.org/NewCondition&quot;,</span></span><br><span class="line"><span class="string">      &quot;availability&quot;: &quot;http://schema.org/InStock&quot;,</span></span><br><span class="line"><span class="string">      &quot;url&quot;: &quot;<span class="subst">$&#123;req.protocol&#125;</span>://<span class="subst">$&#123;req.hostname&#125;</span><span class="subst">$&#123;req.originalUrl&#125;</span>&quot;,</span></span><br><span class="line"><span class="string">      &quot;seller&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;@type&quot;: &quot;Organization&quot;,</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;XXXXX&quot;</span></span><br><span class="line"><span class="string">      &#125;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        !!_.get(tour, <span class="string">&quot;price&quot;</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">          ? <span class="string">`,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      &quot;price&quot;: &quot;<span class="subst">$&#123;_.get(tour, <span class="string">&quot;price&quot;</span>)&#125;</span>&quot;`</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span></span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      ],</span></span><br><span class="line"><span class="string">      &quot;name&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(_.get(tour, <span class="string">&quot;name&quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">    &#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, richSnippetValue, <span class="string">&quot;script&quot;</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, title, <span class="string">&quot;title&quot;</span>);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: title,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:title&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: title,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: description,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;canonical-link&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;href&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: req.<span class="property">originalUrl</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>한결 보기 좋아졌다 <del>그냥 내 착각일 수도</del></p>
<p>그다음에 rich-snippet 부분을 수정해 주었다 rich-snippet은 script 태그 안에 json 이 입력되는 것으로 확인된다.<br>object로 만든 다음에 JSON.stringty 함수를 통해서 작성할 수 있겠다고 생각을 했다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> richSnippetAttribute = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reviewValue = bestReview &amp;&amp; &#123;</span><br><span class="line">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span><br><span class="line">      <span class="attr">reviewBody</span>: bestReview.<span class="property">content</span>,</span><br><span class="line">      <span class="attr">reviewRating</span>: &#123;</span><br><span class="line">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span><br><span class="line">        <span class="attr">ratingValue</span>: bestReview.<span class="property">rate</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">datePublished</span>: <span class="title function_">format</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(bestReview.<span class="property">created_at</span>), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span><br><span class="line">      <span class="attr">author</span>: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, <span class="attr">name</span>: bestReview.<span class="property">author_username</span> &#125;,</span><br><span class="line">      <span class="attr">publisher</span>: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> titleValue =</span><br><span class="line">  _.<span class="title function_">get</span>(tour, <span class="string">&quot;name&quot;</span>) ||</span><br><span class="line">  <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> richSnippetValue = &#123;</span><br><span class="line">  <span class="string">&quot;@context&quot;</span>: <span class="string">&quot;https://schema.org/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Product&quot;</span>,</span><br><span class="line">  <span class="attr">image</span>: [<span class="string">&quot;&#123;정적파일이미지&#125;&quot;</span>],</span><br><span class="line">  <span class="attr">description</span>: titleValue,</span><br><span class="line">  <span class="attr">mpn</span>: <span class="string">&quot;140&quot;</span>,</span><br><span class="line">  <span class="attr">sku</span>: <span class="string">&quot;140&quot;</span>,</span><br><span class="line">  <span class="attr">brand</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Brand&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">aggregateRating</span>: aggregateRatingValue,</span><br><span class="line">  <span class="attr">review</span>: reviewValue,</span><br><span class="line">  <span class="attr">offers</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Offer&quot;</span>,</span><br><span class="line">      <span class="attr">priceCurrency</span>: <span class="string">&quot;KRW&quot;</span>,</span><br><span class="line">      <span class="attr">priceValidUntil</span>: <span class="string">&quot;2099-12-25&quot;</span>,</span><br><span class="line">      <span class="attr">itemCondition</span>: <span class="string">&quot;https://schema.org/NewCondition&quot;</span>,</span><br><span class="line">      <span class="attr">availability</span>: <span class="string">&quot;http://schema.org/InStock&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>,</span><br><span class="line">      <span class="attr">seller</span>: &#123;</span><br><span class="line">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">price</span>: priceValue,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">name</span>: _.<span class="title function_">get</span>(tour, <span class="string">&quot;name&quot;</span>)),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, <span class="title class_">JSON</span>.<span class="title function_">stringty</span>(richSnippetValue) , <span class="string">&quot;script&quot;</span>,richSnippetAttribute);</span><br></pre></td></tr></table></figure>

<p>나머지 changeTagAttr 함수를 선언하는 부분도 비슷한 형태로 만들어 주었다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: descriptionValue,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// etc...</span></span><br></pre></td></tr></table></figure>

<p>이렇게 만들고 보니 changeTagAttr를 몇 번이나 호출하는 게 보기 싫어서<br>다음과 같이 수정했다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> metaTags = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: descriptionValue,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;og:description&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: ogDescriptionValue,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//   etc...</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">metaTags.<span class="title function_">forEach</span>(<span class="function">(<span class="params">metaTag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, metaTag.<span class="property">name</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: metaTag.<span class="property">type</span>,</span><br><span class="line">    <span class="attr">value</span>: metaTag.<span class="property">value</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>여기까지 작업을 하고 나니 이제 진짜 가독성이 조금 더 나아 보인다.<br><del>내 착각이 아니기를</del></p>
<p>생성된 html 파일에 meta tag를 수정하는 것보다<br>그때그때 페이지에 맞는 meta tag를 생성해서 붙여주는 작업이 더 적합해 보였으나<br>changeTagAttr 함수를 사용하는 곳이 많아 수정하기 조심스러웠다</p>
<p>언젠가 시간이 허락하게 된다면 next js를 사용해서 리팩토링을 진행하고 싶다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/13/SEO/Refactoring-SEO/" data-id="clh4el0tz00136fjyhehnfglk" data-title="Refactoring-SEO" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">다음 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Front-dev-blog/" rel="tag">Front-dev-blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terminal/" rel="tag">Terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build-deploy/" rel="tag">build&amp;deploy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3js/" rel="tag">d3js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/Front-dev-blog/" style="font-size: 20px;">Front-dev-blog</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/NodeJs/" style="font-size: 12.5px;">NodeJs</a> <a href="/tags/React/" style="font-size: 17.5px;">React</a> <a href="/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/tags/Terminal/" style="font-size: 12.5px;">Terminal</a> <a href="/tags/build-deploy/" style="font-size: 15px;">build&deploy</a> <a href="/tags/d3js/" style="font-size: 10px;">d3js</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">5월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">4월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">11월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">6월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">5월 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/05/React/flux-3/">redux vs recoil 2</a>
          </li>
        
          <li>
            <a href="/2023/05/02/React/flux-2/">redux vs recoil 1</a>
          </li>
        
          <li>
            <a href="/2023/05/01/NodeJs/node-js-2/">간단한 웹 서버를 만들어 보자 2</a>
          </li>
        
          <li>
            <a href="/2023/04/24/React/react-query-2/">react-query를 사용해 보자(2)</a>
          </li>
        
          <li>
            <a href="/2023/04/22/React/react-query-1/">react-query를 사용해 보자(1)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 gastroad<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>