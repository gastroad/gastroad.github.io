<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>gastroad blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="gastroad blog">
<meta property="og:url" content="https://gastroad.github.io/index.html">
<meta property="og:site_name" content="gastroad blog">
<meta property="og:locale" content="ko_KR">
<meta property="article:author" content="gastroad">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="gastroad blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gastroad blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gastroad.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-react-query-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/24/react-query-3/" class="article-date">
  <time class="dt-published" datetime="2023-04-24T09:04:06.000Z" itemprop="datePublished">2023-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/24/react-query-3/">react-query를 사용해 보자(3)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 rtk-query를 사용해서 비교해 보려고 한다.</p>
<p>우선 rtk-query의 동기부터 살펴보자</p>
<blockquote>
<p>Tracking loading state in order to show UI spinners<br>Avoiding duplicate requests for the same data<br>Optimistic updates to make the UI feel faster<br>Managing cache lifetimes as the user interacts with the UI</p>
</blockquote>
<p>loading 상태 추적,<br>중복 요청 방지<br>UI가 더 빠르게 느껴지도록 업데이트<br>사용자가 UI와 상호 작용할 때 캐시 수명 관리</p>
<p>react-query 보다 간결하다 (제공하는 기능도 간결하긴 하다.)</p>
<p>rtk-qeury는 어떤 기능을 제공하는지 확인해 보자.</p>
<blockquote>
<p>createApi(): The core of RTK Query’s functionality. It allows you to define a set of endpoints describe how to retrieve data from a series of endpoints, including configuration of how to fetch and transform that data. In most cases, you should use this once per app, with “one API slice per base URL” as a rule of thumb.<br>fetchBaseQuery(): A small wrapper around fetch that aims to simplify requests. Intended as the recommended baseQuery to be used in createApi for the majority of users.<br><ApiProvider />: Can be used as a Provider if you do not already have a Redux store.<br>setupListeners(): A utility used to enable refetchOnMount and refetchOnReconnect behaviors.</p>
</blockquote>
<p>createApi :RTK의 핵심<br>데이터를 패치하고 변환하는 설정을 포함해서 엔드 포인트들에서 어떻게 데이터를 패치하는지 정의<br>대부분의 경우 “기본 URL 당 하나의 API 슬라이스”를 원칙으로 하여 App당 한 번 사용<br>fetchBaseQuery() : 간단한 요청을 위한 fetch 래퍼<br>createApi의 baseQuery를 권장함<br>ApiProvider<br>redux store 가 없을 경우 provider로 사용 가능<br>setupListeners():<br>refetchOnMount와 refetchOnReconnect를 위한 유틸리티</p>
<p>제공하는 기능에 대해서도 대충 알아봤으니 이제 실제 적용해서 사용해 보도록 하자<br>우선 react-ground는 redux를 통해 작성했으니 ApiProvider를 사용할 필요가 없다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<p>createApi를 통해 portfolioApi를 생성해 주었다.<br>RTK 쿼리를 사용하면 일반적으로 전체 API 정의를 한곳에서 정의해야 한다</p>
<p>친절하게도 유지 보수를 위해 코드 분할하는 방법까지도 적혀있지만<br>지금 필요한 기능은 아니니 나중에 필요할 때 찾아보도록 해야겠다<br><a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/rtk-query/usage/code-splitting">코드 분할 방법</a></p>
<p>이후 root store에 reducer, middleware를 추가해 주어야 한다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> portfolioSlice <span class="keyword">from</span> <span class="string">&quot;./portfolioSlice&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; portfolioApi &#125; <span class="keyword">from</span> <span class="string">&quot;src/api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">portfolio</span>: portfolioSlice.<span class="property">reducer</span>,</span><br><span class="line">    [portfolioApi.<span class="property">reducerPath</span>]: portfolioApi.<span class="property">reducer</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">middleware</span>: <span class="function">(<span class="params">getDefaultMiddleware</span>) =&gt;</span></span><br><span class="line">    <span class="title function_">getDefaultMiddleware</span>().<span class="title function_">concat</span>(portfolioApi.<span class="property">middleware</span>),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type <span class="title class_">RootState</span> = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> store.<span class="property">getState</span>&gt;;</span><br><span class="line"></span><br><span class="line">type <span class="title class_">AppDispatch</span> = <span class="keyword">typeof</span> store.<span class="property">dispatch</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">useAppDispatch</span>: <span class="function">() =&gt;</span> <span class="title class_">AppDispatch</span> = useDispatch;</span><br></pre></td></tr></table></figure>

<p>이제 실제로 호출을 해보도록 하겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList, useGetPortfolioListQuery &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> reactQuery = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> rtkQuery = <span class="title function_">useGetPortfolioListQuery</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(rtkQuery);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (reactQuery.<span class="property">status</span> == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;reactQuery.data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>rtk-query는 react-query 랑 같은 유틸리티 불린 값을 제공해 준다<br><del>isLoading, isFetching 등등등</del></p>
<p>이제 post api를 한번 사용해 보도록 하겠다.<br>post의 경우 mutation 을 이용해서 호출할 수 있다.<br>mutation 은 서버에게 데이터 업데이트를 전달하고 로컬에서 변화된 값을 적용시킬 때 사용한다.<br>또한 뮤테이션은 캐시 무효화와 강제 리패칭을 할 수 있다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> portfolioApi = <span class="title function_">createApi</span>(&#123;</span><br><span class="line">    <span class="attr">reducerPath</span>: <span class="string">&#x27;portfolioApi&#x27;</span>,</span><br><span class="line">    <span class="attr">baseQuery</span>: <span class="title function_">fetchBaseQuery</span>(&#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/api&#x27;</span> &#125;),</span><br><span class="line">    <span class="attr">endpoints</span>: <span class="function">(<span class="params">builder</span>) =&gt;</span> (&#123;</span><br><span class="line">        <span class="attr">getPortfolioList</span>: builder.<span class="property">query</span>&lt;<span class="title class_">PortfolioCard</span>[], <span class="keyword">void</span>&gt;(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;/portfolio&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">postPortfolio</span>: builder.<span class="title function_">mutation</span>(&#123;</span><br><span class="line">            <span class="attr">query</span>: <span class="function">(<span class="params">post</span>) =&gt;</span> (&#123;</span><br><span class="line">                <span class="attr">url</span>: <span class="string">`/portfolio/`</span>,</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">body</span>: post</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; useGetPortfolioListQuery, usePostPortfolioMutation &#125; = portfolioApi;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio, usePostPortfolioMutation &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [createPortfolio, &#123; isLoading, isError &#125;] = <span class="title function_">usePostPortfolioMutation</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          createPortfolio(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>포스트 요청에 성공했다.</p>
<p>rtk-query 와 react-query를 사용해 보았는데<br>둘 다 기본적인 요청만 해서 그런지 크게 차이점을 모르겠다.</p>
<p>기존에 redux-toolkit 을 사용 중이었다면 수정하기 어렵지 않을 것 같다는 생각을 했다.<br>하지만 fetchBaseQuery를 만들어줘야 해서 나중에 또 다른 기술로 갈아탈 때 고생을 할 거 같다</p>
<p>그리고 rtk-query를 사용하면 server state를 전역으로 관리할 수 있다.<br>store를 사용하다 보니 전역에서 데이터에 접근이 가능하다.<br>시험 삼아 다른 컴포넌트에서 같은 api를 요청해 보니 네트워크 탭에서는 1개의 요청만 확인되었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rtkQuery = <span class="title function_">useGetPortfolioListQuery</span>();</span><br></pre></td></tr></table></figure>

<p>반면 react-query의 경우 다른 컴포넌트에서 요청하면 당연하게도<br>다시 요청을 보낸다.</p>
<p>react-query의 경우 기존에 만들어둔 axios를 사용해서<br>편하게 개발 가능하고 많은 사람이 이용 중이라 트러블슈팅할 때도 편할 거 같다는 생각을 했다</p>
<p>확실한 건 양쪽 다 server state 관리가 편해졌다.</p>
<p>처음 계획엔 swr 도 알아보려 했는데 swr까지 공부했다가는 깊이가 너무 얕아질 것 같아서 추후에 시간이 있을 때로 미루고 react-query, rtk-query를 좀 더 자세히 알아봐야겠다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/24/react-query-3/" data-id="clgum35080003wajy1sgm4gmz" data-title="react-query를 사용해 보자(3)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-query/" rel="tag">react-query</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-react-query-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/22/react-query-2/" class="article-date">
  <time class="dt-published" datetime="2023-04-22T12:48:11.000Z" itemprop="datePublished">2023-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/22/react-query-2/">react-query를 사용해 보자(2)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>어제 간단한 웹서버를 만들고 api 동작까지 확인했으니 본격적으로 react-query를 사용해 보려 한다.</p>
<p>우선 당연하게도 react-query를 설치해 주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install @tanstack/react-query</span><br></pre></td></tr></table></figure>

<p>바로 사용을 시작해 보자<br>우선 react-query를 이용하기 위해서는 quertclient를 provider에 넣어 줘야 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Portfolio</span> <span class="keyword">from</span> <span class="string">&quot;page/Portfolio&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;src/store/store&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryClient</span>, <span class="title class_">QueryClientProvider</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queryClient = <span class="keyword">new</span> <span class="title class_">QueryClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">App</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;queryClient&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#123;</span>&quot;<span class="attr">root-modal</span>&quot;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Portfolio</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>이제 api를 호출하는 함수를 만들어 두자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -api</span></span><br><span class="line"><span class="comment">// request.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createAsyncThunk &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchPortfolioList = <span class="title function_">createAsyncThunk</span>(</span><br><span class="line">    <span class="string">&#x27;fetchPortfolioList&#x27;</span>,</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="title function_">getPortfolioList</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/portfolio&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolio = <span class="keyword">async</span> (<span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&quot;/api/portfolio&quot;</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolio = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: <span class="title class_">PortfolioCard</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> postPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">body</span>: &#123;</span><br><span class="line">    <span class="attr">value</span>: string</span><br><span class="line">&#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc`</span>, &#123; ...body &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> putPortfolioEtc = <span class="keyword">async</span> (<span class="attr">path</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: number</span><br><span class="line">    <span class="attr">etcId</span>: number</span><br><span class="line">&#125;, <span class="attr">body</span>: &#123; <span class="attr">value</span>: string &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id, etcId &#125; = path</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.<span class="title function_">put</span>(<span class="string">`/api/portfolio/<span class="subst">$&#123;id&#125;</span>/etc/<span class="subst">$&#123;etcId&#125;</span>`</span>, &#123;</span><br><span class="line">        ...body</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    fetchPortfolioList,</span><br><span class="line">    getPortfolioList,</span><br><span class="line">    postPortfolio,</span><br><span class="line">    getPortfolio,</span><br><span class="line">    putPortfolio,</span><br><span class="line">    postPortfolioEtc,</span><br><span class="line">    putPortfolioEtc,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>api를 너무 과하게 만든 거 같다… <del>기왕 과하게 만들 거면 좀 이쁘게 만들걸 그랬다</del></p>
<p>우선 바로 한번 호출해 보자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> query = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(query);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;/* <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;portfolioList&#125;</span> /&gt;</span> */&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>우선 useQuery를 통해 api 호출이 가능하다.</p>
<p>useQuery에 우선 필수 값인 queryKey 와 queryFn만 넣어서 호출을 확인해 보았다.</p>
<p>이제 차근차근 useQuery에 어떤 옵션들이 들어가고 각각 어떤 일을 하는 친구인지 알아보자</p>
<p>우선 queryKey부터 살펴보자</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queryKey는 unKnown[] 타입을 받는다</span><br><span class="line">필수 값이다</span><br><span class="line">쿼리에 사용할 쿼리 키다</span><br><span class="line">쿼리 키는 안정적인 hash로 hash 된다.</span><br><span class="line">enabled 이 false로 설정하지 않았으면 key가 변경될 때 자동으로 업데이트한다</span><br></pre></td></tr></table></figure>

<p>그러면 enabled 도 궁금해진다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enabled 은 boolean 타입을 받는다</span><br><span class="line">쿼리가 자동적으로 실행되지 않으려면 false 값을 설정해야 한다.</span><br><span class="line">종속 쿼리에 사용 가능하다</span><br></pre></td></tr></table></figure>

<p>enabled는 api를 호출한 후 그 데이터를 가지고 추가 호출이 일어나야 하는 상황에서 사용할 수 있을 거 같다.</p>
<p>그러면 queryFn 은 뭐 하는 친구일까</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">queryFn 은 (context: QueryFunctionContext) =&gt; Promise&lt;TData&gt; 타입을 받는다.</span><br><span class="line">기본 쿼리 함수가 정의되지 않은 경우에만 필수이다.</span><br><span class="line">쿼리가 데이터를 요청하는 데 사용할 함수이다.</span><br><span class="line">QueryFunctionContext 을 받는다</span><br><span class="line">데이터를 resolve 하거나 오류를 throw 하는 Promise를 return 해야 한다.</span><br><span class="line">데이터는 undefined 일수 없다.</span><br></pre></td></tr></table></figure>

<p>옵션은 여기까지만 확인해 보고 return 항목에 대해서 알아보겠다<br>우선 지금 당장 필요한 건 요청의 상태와 에러 그리고 결과가 필요하다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// Portfolio.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getPortfolioList &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioList</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioList&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Portfolio</span>: <span class="variable constant_">FC</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; status, data, error &#125; = <span class="title function_">useQuery</span>(&#123;</span><br><span class="line">    <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>],</span><br><span class="line">    <span class="attr">queryFn</span>: getPortfolioList,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;error&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>에러 발생<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (status == <span class="string">&quot;loading&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span> 로딩중 <span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PortfolioList</span> <span class="attr">portfolioList</span>=<span class="string">&#123;data&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Portfolio</span>;</span><br></pre></td></tr></table></figure>

<p>잘 작동하는 것을 확인했다.</p>
<p>자세한 건 <a target="_blank" rel="noopener" href="https://tanstack.com/query/v4/docs/react/reference/useQuery">tanstack.com</a>에서 확인해 볼 수 있다 useQuery에 정말 수많은 옵션과 return 이 있다.</p>
<p>이제 get api는 확인을 했으니<br>post 와 이에 따른 update를 해보려고 한다.</p>
<p>useMutation이라는 훅을 사용할 예정이다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -page</span></span><br><span class="line"><span class="comment">// --Portfolio</span></span><br><span class="line"><span class="comment">// PortfolioList.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">FC</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">PortfolioCard</span> <span class="keyword">from</span> <span class="string">&quot;./PortfolioCard&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useMutation, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;@tanstack/react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; postPortfolio &#125; <span class="keyword">from</span> <span class="string">&quot;api/request&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockData = &#123;</span><br><span class="line">  <span class="attr">etc</span>: [</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="string">&quot;2&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="string">&quot;3&quot;</span> &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">img</span>: <span class="string">&quot;github의 저장공간도 아끼는게 좋으니 이미지 호스팅 을 어디서 할지 고민해봐야겠다.&quot;</span>,</span><br><span class="line">  <span class="attr">link</span>: <span class="string">&quot;더미 링크&quot;</span>,</span><br><span class="line">  <span class="attr">paragraph</span>: <span class="string">&quot;더미내용&quot;</span>,</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;더미 타이틀&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">portfolioList</span>: <span class="title class_">PortfolioCard</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PortfolioList</span>: <span class="variable constant_">FC</span>&lt;<span class="title class_">Props</span>&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; portfolioList &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; mutate &#125; = <span class="title function_">useMutation</span>(&#123;</span><br><span class="line">    <span class="attr">mutationFn</span>: postPortfolio,</span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">invalidateQueries</span>(&#123; <span class="attr">queryKey</span>: [<span class="string">&quot;portfolioList&quot;</span>] &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">article</span> <span class="attr">className</span>=<span class="string">&quot;portfolio-wrapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;portfolioList.map((datum, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return <span class="tag">&lt;<span class="name">PortfolioCard</span> <span class="attr">portfolioCard</span>=<span class="string">&#123;datum&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> /&gt;</span>;</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          mutate(mockData);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        추가</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">PortfolioList</span>;</span><br></pre></td></tr></table></figure>

<p>useMutation 훅에 mutationFn에 post 할 api를 넣어 주었다.<br>이후 onSuccess 옵션을 통해 api 가 성공했을 때 portfolioList를 다시 받아오는 작업을 진행하였다. onError 같이 실패했을 경우 에러 처리도 가능하니 뭔가 필요한 상황이 오면 document를 다시 봐야겠다.</p>
<p>여기까지 해보고 나니 굳이 다른 api를 만들어 볼 필요가 없었던 거 같다.</p>
<p>기존에 rtk를 사용해서 createAsyncThunk를 사용해서 extraReducers를 추가해 주는 방식보다 훨씬 간편하게 사용할 수 있는 것 같다.</p>
<p>내일은 rtk-query를 사용해 보고 react-query 랑 비교해 보려고 한다.<br>참고: <a target="_blank" rel="noopener" href="https://tanstack.com/query/latest/docs/react/overview">https://tanstack.com/query/latest/docs/react/overview</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/22/react-query-2/" data-id="clgrz7lyc0000wajy1zmx8vsc" data-title="react-query를 사용해 보자(2)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-query/" rel="tag">react-query</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-react-query-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/21/react-query-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-21T11:20:24.000Z" itemprop="datePublished">2023-04-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/21/react-query-1/">react-query를 사용해 보자(1)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>react-query의 사용은 <a href="https://gastroad.github.io/2023/04/22/react-query-2/">react-query를 사용해 보자(2)</a>에서부터 사용을 시작합니다. react-query 사용이 궁금하신 분들은 바로 해당 포스트를 보러 가주시면 감사하겠습니다.</p>
</blockquote>
<p>react-query를 사용해 보려고 한다.</p>
<p>redux를 이용하다 보면 비동기 요청마다 미들웨어를 추가해 주는 작업은 상당히 번거롭게 느껴진다.<br>간단한 요청들은 react-query를 사용해 보려 한다.</p>
<p>react-query에 대해 알아보고 react-query 가 아닌 swr, rtk-query 랑도 비교해 보고 사용해 보려고 한다.</p>
<p>먼저 react-query의 동기부터 살펴보자</p>
<blockquote>
<p>Caching… (possibly the hardest thing to do in programming)<br>Deduping multiple requests for the same data into a single request<br>Updating “out of date” data in the background<br>Knowing when data is “out of date”<br>Reflecting updates to data as quickly as possible<br>Performance optimizations like pagination and lazy loading data<br>Managing memory and garbage collection of server state<br>Memoizing query results with structural sharing</p>
</blockquote>
<p>캐시<br>동일한 데이터에 대한 여러 요청을 단일 요청으로 중복 제거,<br>백그라운드에서 오래된 데이터 알고 업데이트<br>데이터 업데이트를 최대한 신속하게 반영<br>pagination 및 lazy 로딩 데이터와 같은 성능 최적화<br>메모리 관리 와 서버 state의 garbage collection<br>구조적 공유와 query 결과 Memoizing</p>
<p>목록만 봐도 아찔해진다 이쯤 되면 안 쓰면 안 될 거 같은 기분마저 들기 시작한다.</p>
<p>일단 한번 사용해 보려고 한다.<br>이를 위해서 api를 호출할 필요가 있다</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gastroad/portfolio">다른 프로젝트</a>를 만들 땐 아래와 같이 mock api를 만들어서 사용했었다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getPortfolioList = <span class="keyword">async</span> (): <span class="title class_">Promise</span>&lt;<span class="title class_">PortfolioCard</span>[]&gt; =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(portfolioCardData);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>하지만 이럴 경우 여러 상황을 테스트해보기 번거로워 그냥 node로 간단한 웹 서버를 만들어 보려 한다.</p>
<p>우선 터미널에 들어가 간단한 환경 설정을 해주자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> node-server</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> node-server</span><br><span class="line"></span><br><span class="line">$ npm init</span><br><span class="line"></span><br><span class="line">$ npm install express nodemon</span><br></pre></td></tr></table></figure>

<p>node-server라는 디렉토리 만들고 express 랑 nodemon 을 설치해 주었다</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#pakage.json</span><br><span class="line"></span><br><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon app.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>pakage.json에 nodemon 을 통해서 app.js를 실행하는 scripts를 추가해 주었다.</p>
<p>이제 텍스트 에디터를 통해서 간단한 웹서버를 만들어보려 한다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// root</span></span><br><span class="line"></span><br><span class="line">app.<span class="property">js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/portfolio&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/portfolio&quot;</span>, portfolioRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on port <span class="subst">$&#123;port&#125;</span>.`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">// -routes</span></span><br><span class="line"><span class="comment">// -- portfolio</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> portfolioController = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">getAll</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">getById</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.controller.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioService = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.service&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolios = portfolioService.<span class="title function_">getAll</span>();</span><br><span class="line">  res.<span class="title function_">json</span>(portfolios);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">getById</span>(id);</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; portfolioCardData &#125; = <span class="built_in">require</span>(<span class="string">&quot;./data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// data.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioCardData = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;이력서&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/profile.jpeg&quot;,</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;GitHub&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;github 링크 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://github.com/gastroad&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/github.png&quot;,</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Slides&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;pt발표 자료 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://slides.com/coldpotato&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/slides.png&quot;,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Github Blog&quot;</span>,</span><br><span class="line">        <span class="attr">paragraph</span>: <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span>,</span><br><span class="line">        <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io&quot;</span>,</span><br><span class="line">        <span class="comment">// img: &quot;./src/assets/image/github.png&quot;,</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">portfolioCardData</span>: portfolioCardData &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure>

<p>이제 <a target="_blank" rel="noopener" href="http://localhost:3000/api/portfolio%EB%A1%9C">http://localhost:3000/api/portfolio로</a> 접속해 보면 json 이 잘 내려오는 것을 확인할 수 있다.</p>
<p>이제 api를 생성했으니 react에서 호출을 해보려 한다.</p>
<p>포트폴리오 목록 업데이트하기 귀찮아서 만든 레포지토리가 있는데<br>이 레포지토리를 이용해서 만들어 보겠다.</p>
<p>현재 <a target="_blank" rel="noopener" href="https://github.com/gastroad/portfolio">포트폴리오 목록</a>은 GitHub Pages를 통해 배포 되어있는 상태이다<br>서버를 통한 api 호출을 하도록 수정하게 되면<br>웹서버를 배포해 주어야 정상작동한다.<br>이렇게 되면 비용이 발생해버리니… 그냥 해당 레포지토리를 복사해서 설정을 해보려고 한다.</p>
<p><del>혹시나 따라 해보고 싶으신 분이 계시다면 <a target="_blank" rel="noopener" href="https://github.com/gastroad/play-ground/tree/main/react-ground">깃허브링크</a>에서 head를 610b4f0에 위치시키고 따라 해주시면 감사하겠습니다.</del></p>
<p>우선 a</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">host</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">        <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">        <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">server</span>: <span class="string">&#x27;http&#x27;</span>,</span><br><span class="line">        <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">proxy</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>: <span class="string">&#x27;localhost:3000&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>이렇게 하면 &#x2F;api로 들어오는 모든 요청이<br>localhost:3000&#x2F;api로 이동된다.<br>자세한 내용은 <a href="https://gastroad.github.io/2023/04/17/deploy-3/">여기</a>에 작성해 두었다.</p>
<p>이제 프로젝트를 구동해서 동작을 확인해 보겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getPortfolioList</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;/api/portfolio&quot;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">getPortfolioList</span>();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<p>간단하게 api를 호출을 해보았다.</p>
<p><img src="/img/react-query-1/1.png"></p>
<p>잘 작동하는 것을 확인하였다.<br>동작을 확인했으니 이제 다시 node로 돌아가서 api를 몇 개 더 만들어 주겠다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// data.js</span></span><br><span class="line"><span class="keyword">const</span> portfolioCardData = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;이력서&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;프론트엔드 개발자 진현성 이력서 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io/resume/&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/profile.jpeg&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;GitHub&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;github 링크 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://github.com/gastroad&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/github.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;6&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Slides&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;pt발표 자료 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://slides.com/coldpotato&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/slides.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;7&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;Github Blog&quot;</span>,</span><br><span class="line">    <span class="attr">paragraph</span>: <span class="string">&quot;개인 블로그 링크 입니다.&quot;</span>,</span><br><span class="line">    <span class="attr">link</span>: <span class="string">&quot;https://gastroad.github.io&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./src/assets/image/github.png&quot;</span>,</span><br><span class="line">    <span class="attr">etc</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="attr">value</span>: <span class="string">&quot;8&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">portfolioCardData</span>: portfolioCardData &#125;;</span><br></pre></td></tr></table></figure>

<p>api 요청에 대한 응답으로 이중 배열을 받은 상황을 만들고 싶어<br>data를 수정했다.</p>
<p>이에 맞게 api 도 생성해 주었다</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> portfolioController = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.controller&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">getAll</span>);</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>, portfolioController.<span class="property">post</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">getById</span>);</span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/:id&quot;</span>, portfolioController.<span class="property">putById</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/:id/etc&quot;</span>, portfolioController.<span class="property">postEtc</span>);</span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&quot;/:id/etc/:etcId&quot;</span>, portfolioController.<span class="property">putEtcById</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router</span><br><span class="line">---------------------------------------------------------<span class="comment">// portfolio.controller.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioService = <span class="built_in">require</span>(<span class="string">&quot;./portfolio.service&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> portfolios = portfolioService.<span class="title function_">getAll</span>();</span><br><span class="line">  res.<span class="title function_">json</span>(portfolios);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; img, etc, link, paragraph, title, &#125; = req.<span class="property">body</span></span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">post</span>(etc, img, link, paragraph, title)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">getById</span>(id);</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; img, etc, link, paragraph, title, &#125; = req.<span class="property">body</span></span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">putById</span>(id, img, etc, link, paragraph, title)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">postEtc</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">postEtc</span>(id, value)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putEtcById</span> = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, etcId &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; value &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">const</span> portfolio = portfolioService.<span class="title function_">putEtcById</span>(id, etcId, value)</span><br><span class="line">  res.<span class="title function_">json</span>(portfolio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">---------------------------------------------------------</span><br><span class="line"><span class="comment">// portfolio.service.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; portfolioCardData &#125; = <span class="built_in">require</span>(<span class="string">&quot;./data&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getAll</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">post</span> = <span class="function">(<span class="params">etc, img, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = &#123;</span><br><span class="line">    etc, img, link, paragraph, title, <span class="attr">id</span>: i++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">getById</span> = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putById</span> = <span class="function">(<span class="params">id, img, etc, link, paragraph, title</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; id, img, etc, link, paragraph, title &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">postEtc</span> = <span class="function">(<span class="params">id, value</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> newPortfolio = portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id))</span><br><span class="line">  newPortfolio.<span class="property">etc</span>.<span class="title function_">push</span>(&#123; value, <span class="attr">id</span>: i++ &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">putEtcById</span> = <span class="function">(<span class="params">id, etcId, value</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> newPortfolio = portfolioCardData.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(id))</span><br><span class="line">  <span class="keyword">let</span> newEtc = newPortfolio.<span class="property">etc</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">id</span> === <span class="built_in">parseInt</span>(etcId))</span><br><span class="line">  newEtc.<span class="property">value</span> = value</span><br><span class="line">  newPortfolio.<span class="property">etc</span> = newEtc</span><br><span class="line">  <span class="keyword">return</span> newPortfolio</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>body 파싱을 위한 미들웨어를 추가하는 것도 잊지 말자</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> portfolioRouter = <span class="built_in">require</span>(<span class="string">&quot;./routes/portfolio&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/portfolio&quot;</span>, portfolioRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on port <span class="subst">$&#123;port&#125;</span>.`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>이제 환경설정이 다 되었으니 내일부터 본격적으로 react-query를 사용해서<br>api 호출을 해보려고 한다.</p>
<p>서버 코드 전체는 <a target="_blank" rel="noopener" href="https://github.com/gastroad/play-ground/tree/main/node-server">여기</a>를 통해서 확인해 볼 수 있다</p>
<hr>
<p>오늘도 react-query로 시작해 node로 끝나는 기현상을 토해냈다..<br>포스팅을 하는 단위와 제목을 좀 더 적절하게 선정해야 할 필요성이 있는 것 같다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/21/react-query-1/" data-id="clgqj73wu00089zjy74hlh6hl" data-title="react-query를 사용해 보자(1)" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-query/" rel="tag">react-query</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hosts" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/18/hosts/" class="article-date">
  <time class="dt-published" datetime="2023-04-18T10:58:57.000Z" itemprop="datePublished">2023-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/18/hosts/">hosts 파일에 대해서 알아보자</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 hosts 파일 수정하는 법에 대해서 알아보도록 하겠다</p>
<h3 id="host-파일-이란"><a href="#host-파일-이란" class="headerlink" title="host 파일 이란"></a>host 파일 이란</h3><blockquote>
<p>hosts 파일은 운영 체제가 호스트 이름을 IP 주소에 매핑할 때 사용하는 컴퓨터 파일이다.</p>
</blockquote>
<p>쉽게 브라우저에 도메인을 입력했을 때 해당하는 IP 주소에 매핑을 해줘 찾아갈 수 있게 하는 파일이다.</p>
<p>가장 대표적으로 localhost 가 있다<br>127.0.0.1 IP를 localhost라는 도메인에 매핑을 해 브라우저에 localhost 라 입력을 해도 알아서 127.0.0.1로 찾아가게 된다.</p>
<p>자 이제 그러면 언제 어떻게 사용하는가</p>
<p>프론트엔드 개발을 하는 경우 주로 로컬 개발 서버를 띄워서 작업을 진행할 것이다.<br>그러면 보통 localhost 즉 127.0.0.1에 웹서버를 띄워서 작업을 진행할 텐데<br>카카오톡이나 페이스북 등 소셜 로그인(oauth) 기능을 구현해야 하는 상황에서 hosts 파일을 수정하면 편리하게 개발할 수 있다.</p>
<p>카카오톡을 예시로 들겠다<br>소셜 로그인을 구현하는 방법까지는 다루지 않도록 하겠다.</p>
<p>카카오 로그인 기능을 구현할 때 크게 3가지 단계로 구분해서 개발을 진행했다</p>
<ol>
<li>code 발급받기</li>
<li>발급받은 code를 가지고 access token 발급받기</li>
<li>발급받은 access token 을 가지고 auth token(login) 발급받기</li>
</ol>
<p>이중 첫 번째 code 발급받는 과정에서 hosts 파일을 수정하여 유용하게 사용할 수 있다<br>code를 발급받으려면 url 을 redirect 시켜야 한다.<br>이 과정에서 카카오톡 애플리케이션에 Redirect URI를 미리 등록해 두어야 한다.</p>
<p>이때 Redirect URI에 localhost를 넣을 순 있지만.<br>서비스를 계속 운영하면서 localhost를 넣어둔 채로 작업하기에는 다소 찜찜하기에<br><del>나의 경우</del> production, stage에서 redirect를 받을 URI만 넣어주었다.</p>
<p>이 경우 oauth를 개발하면서 계속 확인해 보고 테스트해 봐야 하는데 그때마다 배포해서 확인해 볼 수는 없으니<br>이때 hosts 파일을 수정해서 작업이 가능하다.</p>
<p>자 그러면 이제 실제로 hosts 파일을 수정하는 방법에 대해 알아보도록 하자</p>
<p>hosts 수정은 정말 간단하다 우선 하단에 링크해둔 위키백과에서 본인에 맞는 os의 hosts 파일 위치를 찾아보자.<br>맥 OS X 10.2 이상을 사용하고 있으니 &#x2F;etc&#x2F;hosts에 있을 것이다 그럼 바로 터미널로 들어가서 파일을 수정해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vi /etc/hosts</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># Host Database</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># localhost is used to configure the loopback interface</span></span><br><span class="line"><span class="comment"># when the system is booting.  Do not change this entry.</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">255.255.255.255 broadcasthost</span><br><span class="line">::1             localhost</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>여기서 왼쪽에 IP 오른쪽에 도메인을 입력하면 해당하는 도메인에 해당하는 IP로 매핑을 해준다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       localhost</span><br><span class="line">255.255.255.255 broadcasthost</span><br><span class="line">::1             localhost</span><br><span class="line"></span><br><span class="line"><span class="comment">#은 주석이다 호스트 파일읋 수정해두고 까먹을 때도 많으니 주석으로 왜 이런 내용을 추가했는지 적어주도록하자.</span></span><br><span class="line">127.0.0.1       naver.com</span><br></pre></td></tr></table></figure>

<p>위와 같이 설정해두고 naver.com에 접속하면 127.0.0.1 즉 localhost 가 보이게 된다.<br>만약 위와 같이 설정을 했는데도 적용이 잘 안 된 거 같다 싶으면 사용하고 있는 브라우저를 완전히 껐다가 다시 켜보자.</p>
<p>이렇게 Hosts를 수정해서 ouath를 보다 편하게 개발할 수 있다.</p>
<p>물론 ouath 개발을 편하게 하는 방법 중에는<br>환경 변수 같은 걸 이용해서 local stage production 다 다른 카카오톡 어플리케이션을 바라보게 해서<br>localhost를 redirect 하여 작업을 해도 무방하다</p>
<p>본인이 개발할 수 있는 상황에 맞는 편한 방법을 사용해서 개발하면 된다고 생각한다.</p>
<p>참고:<a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/Hosts">https://ko.wikipedia.org/wiki/Hosts</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/18/hosts/" data-id="clgm7newz0000f9jyf4792q8y" data-title="hosts 파일에 대해서 알아보자" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/host/" rel="tag">host</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-deploy-3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/17/deploy-3/" class="article-date">
  <time class="dt-published" datetime="2023-04-17T11:43:50.000Z" itemprop="datePublished">2023-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/17/deploy-3/">CORS에 대해서 알아보자</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 CORS에 대해서 알아보도록 하겠다. 중요하고 자주 에러가 발생하기도 하니 조금 자세하게 다뤄보도록 하겠다.</p>
<p>바로 본론으로 들어가</p>
<h3 id="CORS-란"><a href="#CORS-란" class="headerlink" title="CORS 란"></a>CORS 란</h3><blockquote>
<p>Cross-Origin Resource Sharing<br>교차 출처 리소스 공유</p>
</blockquote>
<p>웹 애플리케이션은 리소스가 자신의 출처(도메인, 프로토콜, 포트)와 다를 때 교차 출처 HTTP 요청을 실행한다.</p>
<p>api를 사용하다 보면 CORS 에러는 한 번쯤은 봤을 거라고 생각한다.</p>
<p>보안 상의 이유로, 브라우저는 스크립트에서 시작한 교차 출처 HTTP 요청을 제한한다.<br>예를 들어 XMLHttpRequest, Fetch API는 동일 출처 정책을 따른다.<br>즉, 이 API를 사용하는 웹 애플리케이션은 자신의 출처와 동일한 리소스만 불러올 수 있으며, 다른 출처의 리소스를 불러오려면 그 출처에서 올바른 CORS 헤더를 포함한 응답을 반환해야 한다.</p>
<p>자 그러면 출처에 대해서 자세하게 알아보자<br>우선 앞서 출처 도메인, 프로토콜, 포트라고 했다<br>그러면 도메인과 프로토콜 포트가 각각 어떤 것인지 알아보자</p>
<p>url 은 보통 다음과 같은 구조를 가진다.</p>
<p><code>&#123;protocol&#125;://&#123;Domain&#125;/&#123;path&#125;?&#123;paramater&#125;#&#123;fragment&#125;</code></p>
<p><code>https://www.google.com/search?q=%EA%B5%AC%EA%B8%80&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2#imgrc=_6YUFvCeFGUOSM</code></p>
<p>예시를 위해 구글에서 구글을 검색해 이미지 탭에 들어간 링크를 가져왔다</p>
<ol>
<li>protocol<br>https(hypertext transfer protocol secure) 이다 html 같은 파일을 통신하기 위한 protocol 이다.</li>
<li>Domain<br><a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a> 이다</li>
<li>path<br>&#x2F;search 이다</li>
<li>paramater<br><code>?q=%EA%B5%AC%EA%B8%80&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2</code><br>이 부분이며 url encoding 되어있기 때문에 decode 해보면 아래와 같이 나온다.<br><code>?q=구글&amp;rlz=1C5CHFA_enKR1015KR1015&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwisu_Oy07D-AhWdslYBHcF1ArkQ_AUoAXoECAEQAw&amp;biw=1710&amp;bih=902&amp;dpr=2</code><br><del>한글의 경우 url encoding 을 진행하면 url 이 굉장히 해석하기 힘들어진다.</del></li>
<li>fragment<br>#imgrc&#x3D;_6YUFvCeFGUOSM 이다</li>
</ol>
<p>자 그러면 위에서 나온 <code>출처</code> 중 protocol, 과 도메인이 뭔지는 알았을거다 그러면 포트 뭐길래 안 보이는 건가.</p>
<ol start="6">
<li>포트<br>위 링크의 경우 포트는 443 번이다<br>프로토콜에 따라 할당된 기본 포트가 있고 https의 경우 443 번이 기본 포트이기 때문에 443 은 생략이 가능하다<br>예시로 http 프로토콜의 경우 80이 기본 포트이고<br>80 포트의 경우 생략이 가능하다.</li>
</ol>
<p>그러면 출처에 대해서 이해했으니 다시 CORS로 넘어가도록 하자</p>
<p>출처가 다르면 CORS 헤더를 포함한 응답을 반환해야 한다는데<br>만약 출처가 다른 곳에서 api를 호출하고 싶으면 어떻게 해야 할까</p>
<p>CrossOrigin 어노테이션 사용하기, Preflight Request, 등등 많은 방법이 있지만<br>이번 포스트에서는 proxy를 이용하는 방법을 사용하도록 하겠다.</p>
<p>webpack devserver를 사용하고 있다는 가정하에<br>devserver 옵션 중에 proxy라는 옵션이 있다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     &#x27;/api&#x27;<span class="punctuation">:</span> &#x27;http<span class="punctuation">:</span><span class="comment">//localhost:3000&#x27;,</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>&#x2F;api&#x2F;users에 대한 요청은 이제 <a target="_blank" rel="noopener" href="http://localhost:3000/api/users%EC%97%90">http://localhost:3000/api/users에</a> 대한 요청으로 프록시 처리한다.</p>
<p>만약 유효하지 않은 https 인증서로 개발을 진행하고 있다면</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxy<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      &#x27;/api&#x27;<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        target<span class="punctuation">:</span> &#x27;https<span class="punctuation">:</span><span class="comment">//other-server.example.com&#x27;,</span></span><br><span class="line">        secure<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>secure를 false로 처리하면 된다.<br>&#x2F;api&#x2F;users에 대한 요청은 이제 <a target="_blank" rel="noopener" href="https://other-server.example.com/api/users%EC%97%90">https://other-server.example.com/api/users에</a> 대한 요청으로 프록시 처리한다.</p>
<p>자 그러면 이제 개발 단계에서의 프록시 처리에 대해서 알아봤다.<br>추가로 더 필요한 문법은 하단 참고 링크에 webpack docs를 링크해 뒀으니 찾아보기를 바란다.<br><del>웹 팩 설정은 필요할 때마다 처한 상황에 때라 하나씩 찾아보면서 설정하게 되는 거 같다.</del></p>
<p>이제 production 단계에서는 어떻게 처리하나 확인해 볼 차례이다.<br>production 을 webpack devserver로 돌릴 게 아니라면 결국<br>번들링 된 결과물 일뿐인데 외부 웹서버를 사용하는 환경에서는 cors 에러를 어떻게 처리하나 알아보자.</p>
<p>여기서부터는 devops 엔지니어 분이 봐주시던 부분이라 부끄럽게도 잘 모르는 영역이다.</p>
<p>nginx의 기능 중 하나인 reverse Proxy server를 사용해서 proxy 설정을 하려 한다.</p>
<p>우선 nginx에 대해서 알아보도록 하겠다.</p>
<h3 id="nginx란"><a href="#nginx란" class="headerlink" title="nginx란"></a>nginx란</h3><blockquote>
<p>NGINX is a high‑performance, highly scalable, highly available web server, reverse proxy server, and web accelerator (combining the features of an HTTP load balancer, content cache, and more)</p>
</blockquote>
<p>NGINX는 고성능, 고 확장성, 고가용성 웹 서버, 역방향 프록시 서버 및 웹 가속기 (HTTP 로드 밸런서, 콘텐츠 캐시 등의 기능 결합)라고 한다</p>
<p>그러면 웹 서버는 뭘 하는 걸까</p>
<blockquote>
<p>Serving static and index files, autoindexing; open file descriptor cache;</p>
</blockquote>
<p>정적 파일과 인덱스 파일 제공, 오토인덱싱, 파일 디스크립터 캐시 등의 기능을 제공하는 걸 말한다<br>즉 react에서 번들링 한 결과물을 제공하고 디렉토리에 대한 요청이 있을 때 디렉토리 내의 파일을 자동으로 생성해서 보내주고 파일 구조체를 캐시 해서<br>파일의 접근시간을 줄여준다고 이해했다.</p>
<p>자 그러면 역방향 프록시 서버(reverse Proxy server)는 뭘까</p>
<p>이제 와서 알아보기 조금 늦은 감이 있지만 먼저 Proxy에 대해서 알아보겠다.</p>
<h3 id="Proxying-이란"><a href="#Proxying-이란" class="headerlink" title="Proxying 이란"></a>Proxying 이란</h3><blockquote>
<p>Proxying is typically used to distribute the load among several servers, seamlessly show content from different websites, or pass requests for processing to application servers over protocols other than HTTP.</p>
</blockquote>
<p>일반적으로 여러 서버 간에 로드를 분산하거나,<br>서로 다른 웹 사이트의 콘텐츠를 원활하게 표시하거나,<br>HTTP 이외의 프로토콜을 통해 애플리케이션 서버에 처리 요청을 전달하는 데 사용된다 한다.</p>
<p>이제 reverse Proxy server에 대해 알아보자</p>
<h3 id="reverse-Proxy-server"><a href="#reverse-Proxy-server" class="headerlink" title="reverse Proxy server"></a>reverse Proxy server</h3><blockquote>
<p>Reverse proxy server는 클라이언트로부터 요청을 받아서 백엔드 서버로 전달하는 서버입니다. 일반적인 프록시 서버와 달리, 클라이언트는 백엔드 서버의 존재를 알지 못하고, 리버스 프록시 서버의 주소만 알고 있습니다.</p>
</blockquote>
<p>그럼 왜 이런 번거로운 일을 하는 걸까</p>
<p>백엔드 서버에 직접적인 접근을 허용하지 않고, 리버스 프록시 서버를 통해서만 접근하도록 설정하면, 보안상의 이점이 있다고 한다.<br>또한<br>리버스 프록시 서버는 캐시 기능을 제공하여, 동일한 요청에 대해서는 백엔드 서버로의 요청을 최소화할 수 있다고 한다.</p>
<p>자 이제 개념에 대해서 알아봤으니 이전에 dockerize 한 프로젝트에 nginx 설정에서 프록시 설정을 해보도록 하겠다.</p>
<p>이전에 작성한 Dockerfile 에서 nginx 부분을 조금더 자세하게 알아보자<br>이전에 작성한 Dockerfile 은 <a href="https://gastroad.github.io/2023/04/09/deploy-2/">여기</a> 에 서 볼수있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM nginx:latest</span><br><span class="line">RUN <span class="built_in">rm</span> -rf /etc/nginx/conf.d</span><br><span class="line">COPY conf /etc/nginx</span><br><span class="line">COPY --from=build /usr/src/app/build /usr/share/nginx/html</span><br></pre></td></tr></table></figure>

<p>그때 자세하게 설명하지 않았지만<br>위 내용은 &#x2F;etc&#x2F;nginx&#x2F;conf.d에 있는 nignx 기본 설정을 삭제하고<br>conf 디렉토리를 복사해 &#x2F;etc&#x2F;nginx 붙여 넣는 부분이다.</p>
<p>conf 디렉토리는 다음과 같이 구성했었다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-conf</span><br><span class="line">--conf.d</span><br><span class="line">    default.conf</span><br></pre></td></tr></table></figure>

<p>default.conf 파일은 다음과 같이 구성했다</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server <span class="punctuation">&#123;</span></span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    location / <span class="punctuation">&#123;</span></span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>리버스 프록시 서버를 설정하는 방법은 생각보다 정말 간단하다<br>document에 따르면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /some/path/ &#123;</span><br><span class="line">    proxy_pass http://www.example.com/link/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이라고 한다 그렇다고 하면<br>아까 웹 팩 데브 서버에서 설정한 것과 똑같이 설정하려면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">        try_files $uri $uri/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    location /api &#123;</span><br><span class="line">        proxy_pass https://other-server.example.com/api</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이런 식으로 설정해 주면 된다.</p>
<p>실제 production에 배포해서 확인해 보지 못한 게 아쉬웠다.<br>만약 production에 배포했다 치더라도 api 서버를 개발할 능력도 부족하고 서브도메인을 파서 api 서버를 따로 띄워주는데도 한참 걸릴 거라 생각하지만<br>그래도 대충이라도 api 서버를 파서 동작을 확인해 봤으면 더 좋았을 거 같다.<br>빌드 배포에 관한 내용은 여기까지 작성하고 다음부터는 flux에 대해 작성하도록 하겠다.</p>
<p><del>분명 시작할 때는 주제가 CORS였는데</del></p>
<p>참고<br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy</a><br><a target="_blank" rel="noopener" href="https://webpack.kr/configuration/dev-server/#usage-via-api">https://webpack.kr/configuration/dev-server/#usage-via-api</a><br><a href="docs.nginx.com/nginx/admin-guide/web-server">docs.nginx.com&#x2F;nginx&#x2F;admin-guide&#x2F;web-server</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/17/deploy-3/" data-id="clgapdcf20000jbjy62u6h6ve" data-title="CORS에 대해서 알아보자" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build-delpoy/" rel="tag">build&amp;delpoy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-flux" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/15/flux/" class="article-date">
  <time class="dt-published" datetime="2023-04-15T06:49:05.000Z" itemprop="datePublished">2023-04-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/15/flux/">flux 패턴이란</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>오늘은 flux 패턴에 대해서 알아보려고 한다<br>react를 사용해서 개발을 진행하게 되면 한 번쯤은 들어봤을 거라고 생각한다.</p>
<p>본론으로 들어가기 전 이 포스트는 개인의 경험과 이해를 바탕으로 쓰였으므로<br>틀린 내용이 있을 수 있습니다.<br>혹시 틀린 내용을 발견하게 된다면 <a href="mailto:&#x67;&#111;&#x73;&#116;&#x72;&#x6f;&#97;&#x64;&#x33;&#55;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;">&#x67;&#111;&#x73;&#116;&#x72;&#x6f;&#97;&#x64;&#x33;&#55;&#x40;&#103;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;</a>으로 메일 주시면 감사하겠습니다.<br>정확한 내용은 하단 참고 링크에 쓰인 공식 document를 참고하기를 바랍니다.</p>
<h3 id="FLUX-란"><a href="#FLUX-란" class="headerlink" title="FLUX 란"></a>FLUX 란</h3><blockquote>
<p>Application architecture for building user interfaces</p>
</blockquote>
<p>즉 사용자가 보는 화면을 만들기 위한 애플리케이션 구조라고 이해했다.</p>
<p>단방향 데이터 흐름을 활용해 뷰 컴포넌트를 구성하는 React를 보완하기 위해서 개발된 것으로 알고 있다.</p>
<p>바로 flux의 구조와 데이터 흐름에 대해서 알아보도록 하자</p>
<p><img src="/img/flux/1.png" alt="https://facebookarchive.github.io/flux/docs/in-depth-overview"></p>
<p>공식 도큐먼트를 보면 아래와 같이 설명한다</p>
<blockquote>
<p>All data flows through the dispatcher as a central hub. Actions are provided to the dispatcher in an action creator method, and most often originate from user interactions with the views. The dispatcher then invokes the callbacks that the stores have registered with it, dispatching actions to all stores. Within their registered callbacks, stores respond to whichever actions are relevant to the state they maintain. The stores then emit a change event to alert the controller-views that a change to the data layer has occurred. Controller-views listen for these events and retrieve data from the stores in an event handler. The controller-views call their own setState() method, causing a re-rendering of themselves and all of their descendants in the component tree.</p>
</blockquote>
<p>정리하자면<br>모든 action 은 dispatcher에게 action creator 메서드를 제공한다<br>dispatcher는 action을 store로 전달한다<br>store를 바탕으로 view를 렌더링 한다<br>라고 이해를 했다.</p>
<p>위와 같은 데이터 흐름으로 flux는 단방향(action &#x3D;&gt; dispatcher &#x3D;&gt; store &#x3D;&gt; view) 데이터 흐름을 만들었다.</p>
<p>그러면 이쯤에서 궁금하게 된 것이 react 도 결국 단방향 데이터 흐름을 가지고 있는데 왜 flux라는 것이 필요하고 왜 굳이 store에 dispatcher를 통해 action 을 보내는 번거로운 짓을 해야 하는 거지?<br><del>심지어 flux 패턴을 구현한 redux는 어마 무시한 Boilerplate 코드 때문에 한동안 사용하지 않으려고 별 이상한 시도를 많이 했었다. 현재는 RTK 덕분에 애용하고 있다</del></p>
<p>flux 아키텍처를 개발한 이유가 mvc 패턴이 양방향 데이터 흐름을 가지고 있고<br>이 양방향 데이터 흐름이 시스템의 복잡도를 기하급수적으로 증가시키고, 예측 불가능한 코드를 만들게 된다고 했다 이 예측 불가능한 코드가<br>예측 불가능한 버그를 쏟아져 내기 때문에 만든 아키텍처가 flux인데<br>react 도 결국 부모 component에서 자식 component로 props를 전달하고 자식은 부모로부터 받은 props를 수정할 수 없으니 단방향 데이터 흐름을 가지고 있는 거 아닌가?라는 생각이 들었다</p>
<p>하지만 위와 같이 flux 패턴으로 개발하게 되면 component의 종속성 없이<br>단방향으로 데이터를 흐르게 할 수 있다<br>이렇게 되면 프로젝트의 확장에 따라 부모 component 가 점점 복잡해지는 문제를 해결할 수 있다.</p>
<p>이번 포스트에서 flux 패턴을 구현하는 방법이나 flux 패턴을 구현한 redux, recoil 같은 라이브러리도 다룰까 생각했으나 포스트가 너무 길어질 거 같아 다음에 작성해 보려 한다.</p>
<p>참고 : <a target="_blank" rel="noopener" href="https://facebookarchive.github.io/flux/">https://facebookarchive.github.io/flux/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/15/flux/" data-id="clgkr1ug10000jxjyayx5hmkc" data-title="flux 패턴이란" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Refactoring-SEO" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/13/Refactoring-SEO/" class="article-date">
  <time class="dt-published" datetime="2023-04-13T10:42:39.000Z" itemprop="datePublished">2023-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/13/Refactoring-SEO/">Refactoring-SEO</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>회사 코드를 공개해도 된다는 허락을 받았다 그래서 오늘 작업 내용 중 리팩토링 한 부분을 하나 올려서 설명해 보려고 한다</p>
<p>우선 현재 상황은 다음과 같다</p>
<ol>
<li>public index.html에 title description 등등의 여러 meta 태그들이 선언되어 있다</li>
<li>react-helmet-async를 사용하여 title, description 등등 여러 meta 태그들을 추가하고 있다</li>
<li>server.js라는 파일을 통해 서버사이드에서 html을 수정하고 프로젝트를 가동한다.</li>
</ol>
<p>위와 같은 상황이다 보니 프로젝트 내에서 meta 태그들을 을 선언하거나 수정하는 곳을 찾기가 매우 어려웠다<br>또 메타 태그들이 중복되어 선언되는 문제가 발생하고 있었다.</p>
<p>우선 production 배포를 어떻게 하는지부터 알아보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t XXXX:&#123;tag_no&#125; .</span><br></pre></td></tr></table></figure>

<p>위 명령어를 통해서 도커 이미지를 생성한 다음 aws에 push 하는 방식이다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM node:14.17.1-alpine3.13</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">mkdir</span> /app</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY . /app</span><br><span class="line"></span><br><span class="line">RUN yarn install</span><br><span class="line">RUN yarn build</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD node server.js</span><br></pre></td></tr></table></figure>

<p>node 14 버전에 … node server.js로 서빙을 하는 것으로 확인된다</p>
<p>build를 어떻게 하는지도 package.json 을 통해 확인해 보았다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;node ./scripts/build.js&quot;</span>,</span><br></pre></td></tr></table></figure>

<p>scripts 디렉토리에 build.js라는 파일을 작성해서 이 파일을 실행하면 빌드가 되고 server.js를 통해 서빙한다</p>
<p>자 우선 문제는 대충 파악했으니 수정을 시작해 보려고 한다 SEO를 개선해야 하는 작업 중이기 때문에 server side에서 메타 태그를 넣어주는 게<br>client side에서 수정하는 것보다 좋을 거 같다는 판단을 했다.</p>
<p>또한 react-helmet-async를 통해 추가하고 있는 meta 태그들을 전부 삭제해 주고 server.js에서 전부 관리하면 서버에서<br>매타 태그도 수정하고 관련 수정을 할 때도 server.js 파일 하나만 보고 수정하면 되니까 좀 더 편하지 않을까라고 생각했다</p>
<p>따라서 react-helmet-async를 통해 추가하고 있던 meta 태그들을 어떤 데이터를 사용하는지 체크해두고 전부 삭제해 주었다.</p>
<p>이제 로컬 서버를 띄운 후 개발자 도구에 element를 통해 meta 태그를 확인해 보니 중복으로 추가되고 있었던 meta 태그들이 사라졌다</p>
<p>이후 server.js에서 meta 태그 수정이 잘 되나 확인차 description 하나를 수정해 보니 로컬 서버에서 적용이 되지 않는다.<br>따라서 pakage.json 을 다시 확인해 보니</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./scripts/start.js&quot;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>npm start 명령어를 통해 로컬 서버를 구동했는데 scripts&#x2F;start.js라는 다른 노드 파일을 통해 서빙이 되고 있었다.<br>그래서 이대로라면 결과물을 확인할 수 없어 node server.js 명령어를 통해 로컬 서버를 띄웠다.</p>
<p>수정한 결과가 잘 반영된다.</p>
<p>이제 수정한 결과물도 확인할 수 있게 되었으니 server.js를 내 입맛대로 수정하려고 한다 node에 이해도가 뛰어난 편이 아니니 확실히 알고 있고 개선할 수 있는 부분만 수정하려고 한다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>([<span class="string">&quot;/?/:Id&quot;</span>, <span class="string">&quot;/?/:Id/*&quot;</span>], <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="title class_">Id</span> &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: body &#125; = <span class="keyword">await</span> axios</span><br><span class="line">    .<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;API&#125;</span>/v2/?/<span class="subst">$&#123;Id&#125;</span>`</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> err.<span class="property">response</span>);</span><br><span class="line">  <span class="keyword">const</span> tour = body.<span class="property">data</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">document</span> = parse5.<span class="title function_">parse</span>(html);</span><br><span class="line">  <span class="keyword">const</span> title = tour.<span class="property">name</span> || <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line">  <span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, title, <span class="string">&quot;title&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> description = _.<span class="title function_">get</span>(tour, <span class="string">&quot;description&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;description&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: title,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:title&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: title,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: description,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;canonical-link&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;href&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: req.<span class="property">originalUrl</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> bestReview = _.<span class="title function_">get</span>(tour, <span class="string">&quot;represent_review&quot;</span>);</span><br><span class="line">  <span class="title function_">changeTagValue</span>(</span><br><span class="line">    <span class="variable language_">document</span>,</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;@context&quot;: &quot;https://schema.org/&quot;,</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Product&quot;,</span></span><br><span class="line"><span class="string">  &quot;image&quot;: [</span></span><br><span class="line"><span class="string">  &quot;&#123;정적파일&#125;&quot;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;description&quot;: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">  &quot;mpn&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">  &quot;sku&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">  &quot;brand&quot;: &#123;</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Thing&quot;,</span></span><br><span class="line"><span class="string">  &quot;name&quot;: &quot;XXXX&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;aggregateRating&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;AggregateRating&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    ratingValue: _.get(tour, <span class="string">&quot;overall_rating&quot;</span>) || <span class="number">4.5</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">    reviewCount: _.get(tour, <span class="string">&quot;review_count&quot;</span>) || <span class="number">1</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;)&#125;</span>,</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    !!bestReview</span></span></span><br><span class="line"><span class="subst"><span class="string">      ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &quot;review&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    reviewBody: bestReview.content,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    reviewRating: &#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      ratingValue: bestReview.rate,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    datePublished: format(<span class="keyword">new</span> <span class="built_in">Date</span>(bestReview.created_at), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    author: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, name: bestReview.author_username &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">    publisher: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, name: <span class="string">&quot;XXXXX&quot;</span> &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">  &#125;)&#125;</span>,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  `</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;</span></span></span><br><span class="line"><span class="string">  &quot;offers&quot;: [</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">  &quot;@type&quot;: &quot;Offer&quot;,</span></span><br><span class="line"><span class="string">  &quot;priceCurrency&quot;: &quot;KRW&quot;,</span></span><br><span class="line"><span class="string">  &quot;priceValidUntil&quot;: &quot;2099-12-25&quot;,</span></span><br><span class="line"><span class="string">  &quot;itemCondition&quot;: &quot;https://schema.org/NewCondition&quot;,</span></span><br><span class="line"><span class="string">  &quot;availability&quot;: &quot;http://schema.org/InStock&quot;,</span></span><br><span class="line"><span class="string">  &quot;url&quot;: &quot;<span class="subst">$&#123;req.protocol&#125;</span>://<span class="subst">$&#123;req.hostname&#125;</span><span class="subst">$&#123;req.originalUrl&#125;</span>&quot;,</span></span><br><span class="line"><span class="string">  &quot;seller&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;@type&quot;: &quot;Organization&quot;,</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;XXXXX&quot;</span></span><br><span class="line"><span class="string">  &#125;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">    !!_.get(tour, <span class="string">&quot;price&quot;</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">      ? <span class="string">`,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">  &quot;price&quot;: &quot;<span class="subst">$&#123;_.get(tour, <span class="string">&quot;price&quot;</span>)&#125;</span>&quot;`</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">  &#125;</span></span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  &quot;name&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(_.get(tour, <span class="string">&quot;name&quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">&#125;`</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;script&quot;</span>,</span><br><span class="line">    [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">send</span>(parse5.<span class="title function_">serialize</span>(<span class="variable language_">document</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>대략 정신이 아찔해진다<br>changeTagAttr, changeTagValue 두 함수를 통해 document에 존재하는 html 태그를 찾고 수정해 주는 코드로 보인다<br>우선 함수를 통해 태그를 수정하는 부분과 수정할 value를 분리해서 봐야 눈에 좀 보일 거 같아 그 작업을 먼저 진행해 주었다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tour = body.<span class="property">data</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable language_">document</span> = parse5.<span class="title function_">parse</span>(html);</span><br><span class="line"><span class="keyword">const</span> title = <span class="string">`<span class="subst">$&#123;tour.name&#125;</span> || &#x27;XXXX,`</span>;</span><br><span class="line"><span class="keyword">const</span> description = _.<span class="title function_">get</span>(tour, <span class="string">&quot;description&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> bestReview = _.<span class="title function_">get</span>(tour, <span class="string">&quot;represent_review&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> richSnippetValue = <span class="string">`</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;@context&quot;: &quot;https://schema.org/&quot;,</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Product&quot;,</span></span><br><span class="line"><span class="string">      &quot;image&quot;: [&quot;&#123;정적파일&#125;&quot;],</span></span><br><span class="line"><span class="string">      &quot;description&quot;: <span class="subst">$&#123;title&#125;</span>,</span></span><br><span class="line"><span class="string">      &quot;mpn&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">      &quot;sku&quot;: &quot;140&quot;,</span></span><br><span class="line"><span class="string">      &quot;brand&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Thing&quot;,</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;XXXX&quot;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &quot;aggregateRating&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;AggregateRating&quot;</span>,</span></span></span><br><span class="line"><span class="subst"><span class="string">        ratingValue: _.get(tour, <span class="string">&quot;overall_rating&quot;</span>),</span></span></span><br><span class="line"><span class="subst"><span class="string">        reviewCount: _.get(tour, <span class="string">&quot;review_count&quot;</span>),</span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;)&#125;</span>,</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        !!bestReview</span></span></span><br><span class="line"><span class="subst"><span class="string">          ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      &quot;review&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        reviewBody: bestReview.content,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        reviewRating: &#123;</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">          <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">          ratingValue: bestReview.rate,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        datePublished: format(<span class="keyword">new</span> <span class="built_in">Date</span>(bestReview.created_at), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        author: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, name: bestReview.author_username &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">        publisher: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, name: <span class="string">&quot;XXXXX&quot;</span> &#125;,</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="subst"><span class="string">      &#125;)&#125;</span>,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      `</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span></span></span><br><span class="line"><span class="string">      &quot;offers&quot;: [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">      &quot;@type&quot;: &quot;Offer&quot;,</span></span><br><span class="line"><span class="string">      &quot;priceCurrency&quot;: &quot;KRW&quot;,</span></span><br><span class="line"><span class="string">      &quot;priceValidUntil&quot;: &quot;2099-12-25&quot;,</span></span><br><span class="line"><span class="string">      &quot;itemCondition&quot;: &quot;https://schema.org/NewCondition&quot;,</span></span><br><span class="line"><span class="string">      &quot;availability&quot;: &quot;http://schema.org/InStock&quot;,</span></span><br><span class="line"><span class="string">      &quot;url&quot;: &quot;<span class="subst">$&#123;req.protocol&#125;</span>://<span class="subst">$&#123;req.hostname&#125;</span><span class="subst">$&#123;req.originalUrl&#125;</span>&quot;,</span></span><br><span class="line"><span class="string">      &quot;seller&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;@type&quot;: &quot;Organization&quot;,</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;XXXXX&quot;</span></span><br><span class="line"><span class="string">      &#125;<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">        !!_.get(tour, <span class="string">&quot;price&quot;</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">          ? <span class="string">`,</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">      &quot;price&quot;: &quot;<span class="subst">$&#123;_.get(tour, <span class="string">&quot;price&quot;</span>)&#125;</span>&quot;`</span></span></span></span><br><span class="line"><span class="subst"><span class="string">          : <span class="string">&quot;&quot;</span></span></span></span><br><span class="line"><span class="subst"><span class="string">      &#125;</span></span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      ],</span></span><br><span class="line"><span class="string">      &quot;name&quot;: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(_.get(tour, <span class="string">&quot;name&quot;</span>))&#125;</span></span></span><br><span class="line"><span class="string">    &#125;`</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, richSnippetValue, <span class="string">&quot;script&quot;</span>, [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, title, <span class="string">&quot;title&quot;</span>);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: title,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:title&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: title,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: description,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;canonical-link&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;href&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: req.<span class="property">originalUrl</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>한결 보기 좋아졌다 <del>그냥 내 착각일 수도</del></p>
<p>그다음에 rich-snippet 부분을 수정해 주었다 rich-snippet은 script 태그 안에 json 이 입력되는 것으로 확인된다.<br>object로 만든 다음에 JSON.stringty 함수를 통해서 작성할 수 있겠다고 생각을 했다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> richSnippetAttribute = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;type&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;application/ld+json&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-id&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;rich-snippet&quot;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&quot;data-rh&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;true&quot;</span> &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reviewValue = bestReview &amp;&amp; &#123;</span><br><span class="line">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Review&quot;</span>,</span><br><span class="line">      <span class="attr">reviewBody</span>: bestReview.<span class="property">content</span>,</span><br><span class="line">      <span class="attr">reviewRating</span>: &#123;</span><br><span class="line">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Rating&quot;</span>,</span><br><span class="line">        <span class="attr">ratingValue</span>: bestReview.<span class="property">rate</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">datePublished</span>: <span class="title function_">format</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(bestReview.<span class="property">created_at</span>), <span class="string">&quot;yyyy-MM-dd&quot;</span>),</span><br><span class="line">      <span class="attr">author</span>: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Person&quot;</span>, <span class="attr">name</span>: bestReview.<span class="property">author_username</span> &#125;,</span><br><span class="line">      <span class="attr">publisher</span>: &#123; <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> titleValue =</span><br><span class="line">  _.<span class="title function_">get</span>(tour, <span class="string">&quot;name&quot;</span>) ||</span><br><span class="line">  <span class="string">&quot;XXXX&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> richSnippetValue = &#123;</span><br><span class="line">  <span class="string">&quot;@context&quot;</span>: <span class="string">&quot;https://schema.org/&quot;</span>,</span><br><span class="line">  <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Product&quot;</span>,</span><br><span class="line">  <span class="attr">image</span>: [<span class="string">&quot;&#123;정적파일이미지&#125;&quot;</span>],</span><br><span class="line">  <span class="attr">description</span>: titleValue,</span><br><span class="line">  <span class="attr">mpn</span>: <span class="string">&quot;140&quot;</span>,</span><br><span class="line">  <span class="attr">sku</span>: <span class="string">&quot;140&quot;</span>,</span><br><span class="line">  <span class="attr">brand</span>: &#123;</span><br><span class="line">    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Brand&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">aggregateRating</span>: aggregateRatingValue,</span><br><span class="line">  <span class="attr">review</span>: reviewValue,</span><br><span class="line">  <span class="attr">offers</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Offer&quot;</span>,</span><br><span class="line">      <span class="attr">priceCurrency</span>: <span class="string">&quot;KRW&quot;</span>,</span><br><span class="line">      <span class="attr">priceValidUntil</span>: <span class="string">&quot;2099-12-25&quot;</span>,</span><br><span class="line">      <span class="attr">itemCondition</span>: <span class="string">&quot;https://schema.org/NewCondition&quot;</span>,</span><br><span class="line">      <span class="attr">availability</span>: <span class="string">&quot;http://schema.org/InStock&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>: <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>,</span><br><span class="line">      <span class="attr">seller</span>: &#123;</span><br><span class="line">        <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;Organization&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;XXXX&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">price</span>: priceValue,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">name</span>: _.<span class="title function_">get</span>(tour, <span class="string">&quot;name&quot;</span>)),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">changeTagValue</span>(<span class="variable language_">document</span>, <span class="title class_">JSON</span>.<span class="title function_">stringty</span>(richSnippetValue) , <span class="string">&quot;script&quot;</span>,richSnippetAttribute);</span><br></pre></td></tr></table></figure>

<p>나머지 changeTagAttr 함수를 선언하는 부분도 비슷한 형태로 만들어 주었다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, <span class="string">&quot;og:description&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">  <span class="attr">value</span>: descriptionValue,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// etc...</span></span><br></pre></td></tr></table></figure>

<p>이렇게 만들고 보니 changeTagAttr를 몇 번이나 호출하는 게 보기 싫어서<br>다음과 같이 수정했다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> metaTags = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;description&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: descriptionValue,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;og:description&quot;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">    <span class="attr">value</span>: ogDescriptionValue,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//   etc...</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">metaTags.<span class="title function_">forEach</span>(<span class="function">(<span class="params">metaTag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">changeTagAttr</span>(<span class="variable language_">document</span>, metaTag.<span class="property">name</span>, &#123;</span><br><span class="line">    <span class="attr">name</span>: metaTag.<span class="property">type</span>,</span><br><span class="line">    <span class="attr">value</span>: metaTag.<span class="property">value</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>여기까지 작업을 하고 나니 이제 진짜 가독성이 조금 더 나아 보인다.<br><del>내 착각이 아니기를</del></p>
<p>생성된 html 파일에 meta tag를 수정하는 것보다<br>그때그때 페이지에 맞는 meta tag를 생성해서 붙여주는 작업이 더 적합해 보였으나<br>changeTagAttr 함수를 사용하는 곳이 많아 수정하기 조심스러웠다</p>
<p>언젠가 시간이 허락하게 된다면 next js를 사용해서 리팩토링을 진행하고 싶다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/13/Refactoring-SEO/" data-id="clgezrike000ajbjyd0d50hh8" data-title="Refactoring-SEO" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-deploy-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/09/deploy-2/" class="article-date">
  <time class="dt-published" datetime="2023-04-09T07:53:52.000Z" itemprop="datePublished">2023-04-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/09/deploy-2/">docker kubernetes 이용하여 aws 배포하기 2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>우선 Docker부터 설정을 해보려 한다<br>결국 kubernetes, ligthsail 둘 다 컨테이너화된 docker 이미지가 있어야 사용할 수 있으니 Docker 사용법은 조금 자세하게 알아보겠다.</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>오늘 해볼 일은 Docker를 사용해서 내가 예전에 만들어둔 레포를 image 화해 보는 것이다.</p>
<p>우선 Docker를 설치해 보자<br>Docker 설치의 경우 <a target="_blank" rel="noopener" href="https://www.docker.com/">Docker</a>에서 설치할 수 있다 현재 m2 맥북을 사용하고 있으므로 인텔 칩 전용 버전을 다운로드했다</p>
<p>Docker를 설치하고 실행한다면 아래와 같은 화면이 나올 것이다<br><img src="/img/deploy-2/1.png" alt="docker"></p>
<p>이제 docker 설치는 확인했으니 Dockerfile 을 생성해 보자</p>
<p><img src="/img/deploy-2/2.png" alt="dockerfile 생성"></p>
<p>vscode에서 Dockerfile 을 생성하니 extension 도 설치를 추천하길래 설치해 줬다</p>
<p><img src="/img/deploy-2/3.png" alt="docker extension "></p>
<p>이제 DockerFile 을 작성하겠다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DockerFile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"></span><br><span class="line">FROM node:18-alpine</span><br><span class="line">WORKDIR /app</span><br><span class="line">COPY . .</span><br><span class="line">RUN npm install --production</span><br><span class="line">CMD [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;start&quot;</span>]</span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure>

<p>DockerFile 을 작성했으면 빌드가 잘 되는지 확인해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t getting-started .</span><br></pre></td></tr></table></figure>

<p><img src="/img/deploy-2/4.png"></p>
<p>잘 작동하는지는 모르겠지만 일단 빌드에는 성공을 했다<br>이제 이미지를 빌드 했으니 앱 컨테이너를 시작해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 80:80 getting-started</span><br></pre></td></tr></table></figure>

<p>이제 아래 명령어를 통해 정상적으로 작동하고 있는지 확인해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>아무것도 나오지 않는다</p>
<p>Docker Desktop 에서 컨테이너의 로그를 보니 아래 사진같이 나왔다</p>
<p><img src="/img/deploy-2/5.png"></p>
<p>package.json에 프로젝트를 로컬에서 구동하는 모든 코드들을 devDependencies에 작성해서<br>production으로 install 하면 안 되는 것이 당연하다</p>
<p>우선 구동 확인을 위해서 production 이 아닌 그냥<br>npm install으로 작성해 보니 잘 작동했다.</p>
<p>하지만 서비스 배포 목적으로 도커를 사용할 예정이니 작업물을<br>production으로 빌드 해서 컨테이너를 띄워보겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line">FROM node:18-alpine</span><br><span class="line"><span class="comment"># 노드이미지를 불러온다</span></span><br><span class="line"></span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line"><span class="comment"># 작업폴더를 usr/src/app 으로 설정한다</span></span><br><span class="line"></span><br><span class="line">COPY package.json  ./</span><br><span class="line">RUN npm install --production</span><br><span class="line"><span class="comment"># 현재 폴더의 package.json 파일을 작업 디렉토리로 복사하하고 의존성을 설치한다</span></span><br><span class="line"></span><br><span class="line">COPY . .</span><br><span class="line"><span class="comment"># 현재 폴더의 모든 파일을 작업 디렉토리로 복사한다.</span></span><br><span class="line"></span><br><span class="line">RUN npm run build</span><br><span class="line"><span class="comment"># 프로젝트를 빌드한다</span></span><br><span class="line"></span><br><span class="line">FROM nginx:alpine</span><br><span class="line"><span class="comment"># nginx 이미지를 불러온다</span></span><br><span class="line">COPY --from=build /usr/src/app/build /usr/share/nginx/html</span><br><span class="line"><span class="comment">#  RUN npm run build 의 결과물을 /usr/share/nginx/html 에 복사한다</span></span><br><span class="line">EXPOSE 80</span><br><span class="line"><span class="comment"># 80포트를 열어준다</span></span><br></pre></td></tr></table></figure>

<p>참고로 pakage.json의 scripts는 다음과 같다</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;webpack serve&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;webpack --mode production&quot;,</span><br><span class="line">    &quot;deploy&quot;: &quot;gh-pages -d build&quot;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>이제 다시 시도해 보니</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~~~ 생략</span><br><span class="line"> =&gt; ERROR FROM docker.io/library/build:latest</span><br><span class="line">~~~ 생략</span><br><span class="line"></span><br><span class="line"> &gt; FROM docker.io/library/build:latest:</span><br><span class="line">failed to load cache key: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed</span><br></pre></td></tr></table></figure>

<p>빌드에 실패했다<br>일단 에러를 보니 권한 관련된 문제인 거 같아 sudo로 일단 실행해 보자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo docker build -t test2 .</span><br><span class="line"></span><br><span class="line">~~~ 생략</span><br><span class="line">=&gt; ERROR [internal] load metadata <span class="keyword">for</span> docker.io/library/nginx:alpine</span><br><span class="line">~~~ 생략</span><br><span class="line">------</span><br><span class="line"> &gt; [internal] load metadata <span class="keyword">for</span> docker.io/library/nginx:alpine:</span><br><span class="line">------</span><br><span class="line">failed to solve with frontend dockerfile.v0: failed to create LLB definition: rpc error: code = Unknown desc = error getting credentials - err: <span class="built_in">exit</span> status 1, out: ``</span><br></pre></td></tr></table></figure>

<p>error getting credentials 뭐라 하는 것을 보니 계정과 관련된 문제가 생긴 것으로 추정된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker login</span><br><span class="line"></span><br><span class="line">Authenticating with existing credentials...</span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">Logging <span class="keyword">in</span> with your password grants your terminal complete access to your account.</span><br><span class="line">For better security, <span class="built_in">log</span> <span class="keyword">in</span> with a limited-privilege personal access token. Learn more at https://docs.docker.com/go/access-tokens/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>도커 로그인을 진행하고 다시 시도해도 같은 문제가 발생한다.</p>
<p>우선 가동을 우선으로 Dockerfile 을 다시 작성해 보았다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM node:latest as builder</span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line">COPY package.json  ./</span><br><span class="line">RUN npm install --production</span><br><span class="line">COPY . .</span><br><span class="line">RUN npm run build</span><br><span class="line"></span><br><span class="line">FROM nginx:latest</span><br><span class="line">COPY --from=builder /usr/src/app/build /usr/share/nginx/html</span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure>

<p>nginx 이미지를 가져오는 데에서 문제가 생겼으니 그냥 최신 버전을 가져오게 수정하였다<br>수정하는 김에 node 도 그냥 최신 버전을 가져오게 수정하였다.</p>
<p>이제 다시 시도해 보니 성공적으로 빌드가 되었다!!</p>
<p><del>이제 컨테이너에 다시 올리고</del><br>마지막으로 nginx 관련 설정과 명령어를 Dockerfile에 추가하고<br>다시 빌드 해서 컨테이너에 올려보겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM node:latest as builder</span><br><span class="line">WORKDIR /usr/src/app</span><br><span class="line">COPY package.json  ./</span><br><span class="line">RUN npm install</span><br><span class="line">COPY . .</span><br><span class="line">RUN npm run build</span><br><span class="line"></span><br><span class="line">FROM nginx:latest</span><br><span class="line">RUN <span class="built_in">rm</span> -rf /etc/nginx/conf.d</span><br><span class="line">COPY conf /etc/nginx</span><br><span class="line">COPY --from=build /usr/src/app/build /usr/share/nginx/html</span><br><span class="line">CMD [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span><br><span class="line">EXPOSE 80</span><br></pre></td></tr></table></figure>

<p>이제 localhost에 접속하면 정상 작동한다.</p>
<p>이번 포스팅을 하면서 웹서버 와 배포 환경에 얼마나 지식이 없는지 뼈아프게 실감했다.<br>포스트에 다 쓰기엔 너무 길어질 거 같아 생략한 nginx 설정과 빌드 cahe 관련된 문제도 있었다. 다음에 여유가 있을 때 nginx 관련 내용도 포스팅해 보도록 하겠다 우선 docker 컨테이너를 빌드 하는데 성공하였으니<br>다음에는 aws kubernetes에 대해 알아보도록 하겠다.</p>
<hr>
<p>2023&#x2F;04&#x2F;16<br>처음 계획상 aws 계정을 생성하고 무료로 이용할 수 있는 기간이 있어<br>이를 이용해 aws에 배포를 해보고 기간이 끝나기 전 서비스를 내려<br>배포에 대해 알아보려 했으나 ligthsail Containers의 경우 무료 이용 기간이 없어 나중에 도메인을 구매하고 올리고 싶은 프로젝트가 있을 때 진행하기로 생각을 바꿨다.</p>
<p>참고 : <a target="_blank" rel="noopener" href="https://docs.docker.com/get-started/">Docker docs</a><br><a target="_blank" rel="noopener" href="https://www.okteto.com/blog/building-docker-images-faster-for-webpack/">building-docker-images-faster-for-webpack</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/09/deploy-2/" data-id="clg94apnd0001l4jy0xvhamjw" data-title="docker kubernetes 이용하여 aws 배포하기 2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build-delpoy/" rel="tag">build&amp;delpoy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-deploy-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/04/08/deploy-1/" class="article-date">
  <time class="dt-published" datetime="2023-04-08T03:19:50.000Z" itemprop="datePublished">2023-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/etc/">etc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/04/08/deploy-1/">docker,kubernetes 이용하여 aws 배포하기</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>이번에 이직한 회사에서 배포를 위해 docker 랑 kubernetes를 사용하고 있다<br>이때까지 devops 엔지니어 분이 jenkins를 세팅해 주시면<br>node 버전 정도만 가볍게 수정해서 배포를 했기 때문에 docker 랑 kubernetes에 대해 잘 모른다<br>그래서 docker kubernetes를 사용해서 aws에 배포하는 작업까지 해보려 한다</p>
<p>우선 docker에 대해서 알아보자</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><blockquote>
<p>도커(Docker)는 컨테이너 기반 가상화 플랫폼으로<br>애플리케이션을 개발, 배포, 실행하기 위한 환경을 제공한다.</p>
</blockquote>
<p>Docker는 애플리케이션 개발 배포 실행하기 위한 환경을 제공하는 가상화 플랫폼이라는 것 까지는 이해가 됐다 그런데 컨테이너는 어떤 걸 말하는 걸까</p>
<h4 id="컨테이너"><a href="#컨테이너" class="headerlink" title="컨테이너"></a>컨테이너</h4><blockquote>
<p>컨테이너는 애플리케이션이 한 컴퓨팅 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행되도록 코드와 모든 종속성을 패키징 하는 소프트웨어의 표준 단위입니다.</p>
</blockquote>
<p>한마디로 Docker란 여러 컴퓨팅 환경에서도 빠르고 안정적으로 실행할 수 있는 환경을 제공하는 기술이라고 이해를 했다</p>
<p>그러면 kubernetes는 어떤 것인지 알아보자</p>
<h3 id="kubernetes"><a href="#kubernetes" class="headerlink" title="kubernetes"></a>kubernetes</h3><blockquote>
<p>K8s라고도 하는 Kubernetes는 컨테이너화된 애플리케이션의 배포, 확장 및 관리를 자동화하기 위한 오픈 소스 시스템입니다.</p>
</blockquote>
<p>즉 Docker를 사용하여 내 프로젝트를 컨테이너화한 뒤<br>kubernetes를 이용하여 컨테이너 된 프로젝트를 자동으로 배포 확장 및 관리를 하는 기술이라고 이해를 했다</p>
<h3 id="aws"><a href="#aws" class="headerlink" title="aws"></a>aws</h3><p>이제 aws에 대해 알아보려 한다 aws는 아마존에서 제공하는 웹 서비스(Amazon Web Services)이다<br>aws에서는 정말 다양한 서비스를 지원하고 있다</p>
<p>이전 회사에 다닐 때는 s3, colud front 등 다양한 기술을 사용했던 것으로 기억하는데 자세히 관심을 가지지 않았었던 게 아쉽다.</p>
<p>일단 내가 어떤 서비스를 이용해야 하는지부터 확인해 보겠다<br><a target="_blank" rel="noopener" href="https://aws.amazon.com/ko/blogs/korea/how-to-choose-aws-container-services/">aws 한국블로그</a>에 따르면<br>Lightsail, Elastic Beanstalk 둘 중에 하나를 선택하는 게 좋아 보인다.</p>
<p>현재 적은 트래픽을 가진 단일 웹 페이지를 배포할 예정이므로<br>Elastic Beanstalk 을 사용하는 게 조금 더 적합해 보이지만 지금 다니는 회사가 lightsail 을 stage 서버용으로 사용하고 있으니 이에 대해 공부도 할 겸 lightsail 을 이용을 해보고 추후 여유가 생길 때 나머지 서비스에 대해서도 알아보도록 하겠다</p>
<p>그러면 이제 lightsail에 대해 알아보자</p>
<h4 id="lightsail"><a href="#lightsail" class="headerlink" title="lightsail"></a>lightsail</h4><blockquote>
<p>Amazon Lightsail은 가상 프라이빗 서버(VPS) 공급자로, 클라우드에서의 애플리케이션 구축 및 호스팅 솔루션이 필요한 개발자, 소규모 비즈니스, 학생 및 다른 사용자가 가장 손쉽게 AWS를 시작할 수 있는 방법입니다. Lightsail은 개발자에게 클라우드에서 웹사이트와 웹 애플리케이션을 배포하고 관리할 수 있는 컴퓨팅, 스토리지 및 네트워킹 용량 및 기능을 제공합니다. Lightsail에는 프로젝트를 빠르게 시작하는 데 필요한 모든 것(가상 머신, 컨테이너, 데이터베이스, CDN, 로드 밸런서, DNS 관리 등)이 포함되어 있으며, 이러한 서비스를 저렴하고 예측 가능한 월간 요금으로 사용할 수 있습니다.</p>
</blockquote>
<p>lightsail 은 vps 공급자로 클라우드에서 웹사이트와 웹 애플리케이션을 배포하고 관리할 수 있는 컴퓨팅, 스토리지 및 네트워킹 용량 및 기능을 제공한다로 요약할 수 있을 거 같다</p>
<p>이제 대충 어떤 기술 사용할지 정했으니 다음 포스트에 어떻게 하는지 알아보도록 하겠다.</p>
<p>참고 :<a target="_blank" rel="noopener" href="https://www.docker.com/," title="https://www.docker.com/">docker</a>, <a target="_blank" rel="noopener" href="https://kubernetes.io/," title="https://kubernetes.io/">kubernetes</a>, <a target="_blank" rel="noopener" href="https://aws.amazon.com/ko/blogs/korea/how-to-choose-aws-container-services/">aws 한국 블로그</a>, <a target="_blank" rel="noopener" href="https://aws.amazon.com/ko/lightsail/faq/">aws lightsail faq </a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/04/08/deploy-1/" data-id="clg94apnb0000l4jydsak2p09" data-title="docker,kubernetes 이용하여 aws 배포하기" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build-delpoy/" rel="tag">build&amp;delpoy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-d3js" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/12/d3js/" class="article-date">
  <time class="dt-published" datetime="2020-11-11T15:00:00.000Z" itemprop="datePublished">2020-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/12/d3js/">D3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>D3 를 공부하려고 한다<br>workbox, D3, 테스트 코드 3개를 공부해 보려 하는데<br>먼저 D3 부터 시작하기로 했다<br>D3란 Data-Driven Documents 의 약자로 D가 3개 들어가서 D3 라고 하는거같다 직역을 하면 정보-중심 문서 라는 뜻인거같다<br>일단 d3js.org 에 접속해 보았다, 접속하자마자 최 상단에 d3 가 뭘 하는것인지 쓰여있는데</p>
<blockquote>
<p>D3.js is a JavaScript library for manipulating documents based on data. D3 helps you bring data to life using HTML, SVG, and CSS. D3’s emphasis on web standards gives you the full capabilities of modern browsers without tying yourself to a proprietary framework, combining powerful visualization components and a data-driven approach to DOM manipulation.</p>
</blockquote>
<p>대충 해석해 보자면<br>D3 는 데이터 기반으로 문서를 조작하는 자바스크립트 라이브러리 이다<br>HTML,SVG,CSS 에 생명을 불어 넣는데 도움이 된다고 한다<br>웹표준을 준수하여 프레임 워크에 묶이지 않고도 최신 브라우저의 기능을 제공한다<br>영어실력이 좋지 못해서 정확한 해석은 되지 않지만 대충 이런 뜻인거 같다<br>이후 쭉 읽어보면 D3 에대한 상세한 설명 후 아마도 핵심 기능으로 추정되는<br>5가지 기능에 대한 설명이 있다</p>
<ol>
<li>selections</li>
<li>Dynamic Properties</li>
<li>Enter and Exit</li>
<li>Transformation, not Representation</li>
<li>Transitions</li>
</ol>
<p>따라서 위 5가지 순서대로 공부후 나중에 예제를 몇개 만들어 보려고 한다</p>
<h3 id="selections"><a href="#selections" class="headerlink" title="selections"></a>selections</h3><p>기본적으로 element 를 select 하는 문법인거같다 기존 W3C DOM API 를 사용하면</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> paragraphs = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;p&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; paragraphs.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">var</span> paragraph = paragraphs.<span class="title function_">item</span>(i);</span><br><span class="line">  paragraph.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&quot;color&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이렇게 나오는데 D3 의 select 방법을 사용하면</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.<span class="title function_">selectAll</span>(<span class="string">&quot;p&quot;</span>).<span class="title function_">style</span>(<span class="string">&quot;color&quot;</span>, <span class="string">&quot;blue&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>처럼 간단하게 사용할수 있다<br>물론 한개만 선택하는것도 가능하다고 한다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">style</span>(<span class="string">&quot;background-color&quot;</span>, <span class="string">&quot;black&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>기본 DOM API 를 사용하면 querySelectAll 로 잡아서 for 문을 돌려가며 style 등의 attribute 를 수정하지만 D3 의 경우에는 selectAll 을 통해서<br>별도의 반복문 없이 바로 수정할수 있다는 장점이 있는거같다<br>select,selectAll 등에는 “p”,”body” 같은 태그를 제외하고도 ID,Class 도 들어간다고 한다</p>
<h3 id="Dynamic-Properties"><a href="#Dynamic-Properties" class="headerlink" title="Dynamic-Properties"></a>Dynamic-Properties</h3><p>d3는 동적으로 속성을 할당할수 있다<br>예제를 하나 가져왔다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d3.<span class="title function_">selectAll</span>(<span class="string">&quot;p&quot;</span>)</span><br><span class="line">  .<span class="title function_">data</span>([<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>])</span><br><span class="line">  .<span class="title function_">style</span>(<span class="string">&quot;font-size&quot;</span>, <span class="keyword">function</span> (<span class="params">d, i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> d + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>위 코드를 해석하자면 d3 에서 모든 P 태그를 선택한후 data 를 추가해준뒤<br>font-size 라는 스타일에 data[index] + px 한 값을 return 해준 것이다<br>위 예제로 style 함수에 첫번째 인자로는 수정할 요소의 이름을<br>두번째 인자로는 수정할 요소의 인자를 함수로 받을수 있다는 사실과<br>인자로 받는 함수에 인자로 data 값과 index를 받을수 있다는걸 알수 있다<br>아마 차트를 그릴때 data 에 따라 크기를 다르게 하게 하기 위해 있는 기능인거 같다</p>
<h3 id="Enter-and-Exit"><a href="#Enter-and-Exit" class="headerlink" title="Enter-and-Exit"></a>Enter-and-Exit</h3><p>d3 에는 Enter,Exit 란 함수가 있다<br>Enter 는 데이터로 받아들인 요소가 이미 존재하고 있는 수보다 많을때<br>새로 생선된 요소를 선택하는 함수이다<br>Exit 는 Enter 의 반대로 데이터로 받아들인 요소가 이미 존재하고 있는 수보다 적을때 그 적은만큼의 요소를 선택하는 함수이다<br>예를 들어 html 이 아래와 같이 있다고 가정해보자</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>이 상태에서</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> temp1 = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>).<span class="title function_">selectAll</span>(<span class="string">&quot;div&quot;</span>).<span class="title function_">data</span>([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</span><br></pre></td></tr></table></figure>

<p>했을경우 div 태그는 6개 인데 data 는 총 3개 가 들어간다 이때</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">temp2.<span class="title function_">exit</span>().<span class="title function_">remove</span>();</span><br></pre></td></tr></table></figure>

<p>exit() 를 통하여 data를 받지 못한 3개의 div 태그를 선택한후 remove 해준다</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>그러면 위 처럼 변경 된다<br>데이터 기반의 문서 라는 이름대로 데이터를 기반으로 문서를 변환할수 있다<br>문서가 처음에 서버에 랜더링되고 d3 를 통해 클라이언트에서 업데이트 되는 하이브리드 방식도 가능하다고 한다</p>
<h3 id="Transformation-not-Representation"><a href="#Transformation-not-Representation" class="headerlink" title="Transformation-not-Representation"></a>Transformation-not-Representation</h3><p>이 부분은 따로 함수나 기능같은것을 설명하는게 아니라<br>d3의 그래픽 은 다른 processing,protovis 와 달리 html,svg,css 와 같은 웹 표준에서 직접 지정할수 있다<br>미래에는 d3 이외의 툴킷을 사용해도 d3 처럼 웹 표준을 사용할것이다</p>
<h3 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h3><p>마지막으로 애니메이션 관련된 부분인거 같다<br>D3는 문자열에 포함 된 숫자 및 숫자 (글꼴 크기, 경로 데이터 등) 및 복합 값과 같은 기본 요소를 모두 지원한다고 한다<br>예를 들어 페이지의 배경을 검은 색으로 페이드하려면</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.<span class="title function_">select</span>(“body”).<span class="title function_">transition</span>()</span><br><span class="line"> .<span class="title function_">style</span>(“background-color”, “black”);</span><br></pre></td></tr></table></figure>

<p>duration 과 delay 도 설정할수 있다</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">d3.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">  .<span class="title function_">transition</span>()</span><br><span class="line">  .<span class="title function_">duration</span>(<span class="number">750</span>)</span><br><span class="line">  .<span class="title function_">delay</span>(<span class="keyword">function</span> (<span class="params">d, i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">10</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(d * scale);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>더 자세한 설정은 필요할때 마다 찾아보면 될거같다<br>다음번에는 오늘 공부한 내용을 가지고 예제 차트를 몇개 만들어 보려고 한다</p>
<p>참고 :<a target="_blank" rel="noopener" href="https://d3js.org/," title="https://d3js.org/">d3 docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2020/11/12/d3js/" data-id="clg8tzw5z000f7tjy2ve372h4" data-title="D3" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/d3js/" rel="tag">d3js</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">다음 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build-delpoy/" rel="tag">build&amp;delpoy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3js/" rel="tag">d3js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/host/" rel="tag">host</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oh-my-zsh/" rel="tag">oh-my-zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-query/" rel="tag">react-query</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/tags/build-delpoy/" style="font-size: 15px;">build&delpoy</a> <a href="/tags/d3js/" style="font-size: 10px;">d3js</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/host/" style="font-size: 10px;">host</a> <a href="/tags/oh-my-zsh/" style="font-size: 10px;">oh-my-zsh</a> <a href="/tags/react/" style="font-size: 20px;">react</a> <a href="/tags/react-query/" style="font-size: 15px;">react-query</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">4월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">11월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">6월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">5월 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/24/react-query-3/">react-query를 사용해 보자(3)</a>
          </li>
        
          <li>
            <a href="/2023/04/22/react-query-2/">react-query를 사용해 보자(2)</a>
          </li>
        
          <li>
            <a href="/2023/04/21/react-query-1/">react-query를 사용해 보자(1)</a>
          </li>
        
          <li>
            <a href="/2023/04/18/hosts/">hosts 파일에 대해서 알아보자</a>
          </li>
        
          <li>
            <a href="/2023/04/17/deploy-3/">CORS에 대해서 알아보자</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 gastroad<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>