<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Next.js 에 대해서 알아보자-2 | gastroad blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="지난번에 Next.js에 대해서 가볍게 알아보았으니이번에는 실제로 Next.js를 사용해 보려고 한다. Next.js를 제대로 사용해보기 위해서는 간단한 view 가 아닌 제대로 동작하는 프로젝트가 필요할 것 같다. 겸사겸사 포트폴리오도 만들 겸 제대로 기획해서 사용해 보려고 한다. 항상 이렇게 되면 문제가 백엔드 서버를 구축하는 부분인데.간단한 json">
<meta property="og:type" content="article">
<meta property="og:title" content="Next.js 에 대해서 알아보자-2">
<meta property="og:url" content="https://gastroad.github.io/2023/05/18/React/nextjs-2/index.html">
<meta property="og:site_name" content="gastroad blog">
<meta property="og:description" content="지난번에 Next.js에 대해서 가볍게 알아보았으니이번에는 실제로 Next.js를 사용해 보려고 한다. Next.js를 제대로 사용해보기 위해서는 간단한 view 가 아닌 제대로 동작하는 프로젝트가 필요할 것 같다. 겸사겸사 포트폴리오도 만들 겸 제대로 기획해서 사용해 보려고 한다. 항상 이렇게 되면 문제가 백엔드 서버를 구축하는 부분인데.간단한 json">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://gastroad.github.io/img/nextjs-2/1.png">
<meta property="og:image" content="https://gastroad.github.io/img/nextjs-2/3.png">
<meta property="og:image" content="https://gastroad.github.io/img/nextjs-2/4.png">
<meta property="og:image" content="https://gastroad.github.io/img/nextjs-2/5.png">
<meta property="article:published_time" content="2023-05-17T16:45:53.000Z">
<meta property="article:modified_time" content="2023-05-25T12:28:07.273Z">
<meta property="article:author" content="gastroad">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gastroad.github.io/img/nextjs-2/1.png">
  
    <link rel="alternate" href="/atom.xml" title="gastroad blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gastroad blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="검색"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="검색"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://gastroad.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-React/nextjs-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/18/React/nextjs-2/" class="article-date">
  <time class="dt-published" datetime="2023-05-17T16:45:53.000Z" itemprop="datePublished">2023-05-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Next.js 에 대해서 알아보자-2
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>지난번에 Next.js에 대해서 가볍게 알아보았으니<br>이번에는 실제로 Next.js를 사용해 보려고 한다.</p>
<p>Next.js를 제대로 사용해보기 위해서는 간단한 view 가 아닌 제대로 동작하는 프로젝트가 필요할 것 같다. 겸사겸사 포트폴리오도 만들 겸 제대로 기획해서 사용해 보려고 한다.</p>
<p>항상 이렇게 되면 문제가 백엔드 서버를 구축하는 부분인데.<br>간단한 json 파싱 해서 데이터를 내려받는 데에는 문제가 없으나 로그인 인증 부분이 들어가면 골치 아파질 것 같다. 로그인 인증 부분은 백엔드에서 가짜로 처리하는 방법에 대해서 찾아보고 좋은 방법이 있으면 채택하도록 하겠다.</p>
<p>우선 어떤 서비스를 만들지는 모르겠으니 1차 목표는 다음과 같다.</p>
<p>next를 이용하여 웹페이지 구축<br>로그인된 유저와 로그인되지 않은 유저가 볼 수 있는 페이지를 나누어 보여주기.<br>데이터 패칭해서 리스트 view 보여주기 (swr, fetch, react-query 사용해 보기)</p>
<!-- tailwindcss 사용해 보기 -->

<p>state 관리는 recoil을 이용하기<br>jest로 testCode 작성하기<br><del>지갑의 여유가 있다면</del> githubAction을 사용해서 main에 merge 될 때 자동으로 test 실행하기<br>stroyboard 작성하여 component 관리하기(여유가 있다면 figma에도 연동을 해보려고 한다)</p>
<p>이렇게 작성하고 나니 next 가 메인이 아닌 거 같은 기분이 든다.<br>여하튼 바로 시작해 보도록 하겠다.</p>
<p>우선 document에 있는 Getting Started를 따라가도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npx create-next-app@latest</span><br></pre></td></tr></table></figure>

<p><img src="/../../img/nextjs-2/1.png"></p>
<p>생성해 보고 정말 놀랬다.<br>기존에 webpack 을 사용할 때에는 설정을 하는 데에 많은 시간을 소요했는데<br>심지어 alias까지 어떻게 설정할지 물어본다.<br>그리고 어떤 의존성 모듈을 설치했는지도 전부 보여준다.</p>
<p>그런데 모듈들이 전부 dependencies에 설치가 되었다.<br>실제 배포 후 runtime에 필요 없는 것들은 devDependencies로 옮겨주도록 하자</p>
<p>autoprefixer는 처음 보는 모듈이라 확인해 보니 PostCSS Plugin으로 보인다 이 친구도 devDependencies로 옮겨주도록 하자.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nextjs13-ground&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.1.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next dev&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next start&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;next lint&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;next&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.4.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;@types/node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;20.1.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@types/react&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@types/react-dom&quot;</span><span class="punctuation">:</span> <span class="string">&quot;18.2.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.40.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eslint-config-next&quot;</span><span class="punctuation">:</span> <span class="string">&quot;13.4.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8.4.23&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tailwindcss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3.3.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;typescript&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;autoprefixer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10.4.14&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>이제 package-lock.json 과 node_moudles를 삭제 후 다시 의존성 모듈을 설치해 주도록 하자</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ npm run dev</span><br><span class="line">$ npm run lint</span><br><span class="line">$ npm run build</span><br><span class="line">$ npm run start</span><br></pre></td></tr></table></figure>

<p>정상 작동을 하니 inital 커밋을 진행해 준다.<br>project의 이름을 아직 정하지 못하여 우선 unNamed라는 레포지토리를 생성해 관리해 주도록 하겠다.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/gastroad/un-named">https://github.com/gastroad/un-named</a><br>initial commit 을 작성해 주었다.<br>좋은 기획이 나오지 않는다면 그냥 삭제하고 play-ground에 넣어야겠다.</p>
<p>이제 목적에 맞는 의존성 모듈을 설치해 주도록 하겠다.<br>recoil, jest, stroyboard, 기타 등등 을 설치해 주도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ npm install recoil</span><br><span class="line">$ npm install --save-dev jest</span><br><span class="line">$ npm install --save-dev @types/jest</span><br><span class="line">$ npm install --save-dev @testing-library/react</span><br><span class="line">$ npm install --save-dev @testing-library/jest-dom</span><br><span class="line">$ npm install --save-dev @testing-library/user-event</span><br><span class="line">$ npm install --save-dev @types/testing-library__jest-dom</span><br><span class="line">$ npm install --save-dev jest-environment-jsdom</span><br><span class="line">$ npx storybook@latest init</span><br></pre></td></tr></table></figure>

<p>next js에서 test를 하기 위해서 어떤 모듈을 어떻게 설치하는지에 대한 내용은 <a target="_blank" rel="noopener" href="https://nextjs.org/docs/pages/building-your-application/optimizing/testing">여기</a>에 자세히 나와있다.</p>
<p>나의 경우 npx create-next-app –example with-jest with-jest-app 을 통해서 생성한 뒤 지금 내 설정과 다른 부분을 추가해 주었다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">describe</span>(<span class="string">&quot;test&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&quot;test 1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="title function_">expect</span>(a).<span class="title function_">toBe</span>(a);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>정말 간단한 테스트 코드를 작성해 보고 잘 작성이 되는 것을 확인했다.<br><del>rendering 관련해서는 확인해 보지 않았다.</del></p>
<p>이제 바로 레이아웃을 구성해 보도록 하자.</p>
<p><img src="/../../img/nextjs-2/3.png"></p>
<p>next document를 보면 컴포넌트는 다음과 같이 구성된다고 나와있다.<br>따라서 디렉토리를 다음과 같이 구성하려고 한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-app</span><br><span class="line">layout.tsx</span><br><span class="line">error.tsx</span><br><span class="line">loading.tsx</span><br><span class="line">--&#123;pagename&#125;</span><br><span class="line">  layout.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  page.tsx</span><br></pre></td></tr></table></figure>

<p>추후에 개발을 진행하면서 바뀔 수도 있지만 일단은 이런 식으로 구성하도록 하겠다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src</span></span><br><span class="line">-app</span><br><span class="line">layout.tsx</span><br><span class="line">error.tsx</span><br><span class="line">loading.tsx</span><br><span class="line">--&#123;pagename&#125;</span><br><span class="line">  layout.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  page.tsx</span><br><span class="line"></span><br><span class="line">-component</span><br><span class="line"></span><br><span class="line">-state</span><br><span class="line">--atoms</span><br><span class="line">--selectors</span><br><span class="line"></span><br><span class="line">-utils</span><br></pre></td></tr></table></figure>

<p>이제 stories, test, style, types를 어디에 위치시킬 건지만 고민하면 될 것 같다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src</span></span><br><span class="line">-app</span><br><span class="line">  layout.tsx</span><br><span class="line">  error.tsx</span><br><span class="line">  loading.tsx</span><br><span class="line">  app.css</span><br><span class="line">  -&#123;pagename&#125;</span><br><span class="line">    layout.tsx</span><br><span class="line">    loading.tsx</span><br><span class="line">    page.tsx</span><br><span class="line">    &#123;pagename&#125;.css</span><br><span class="line">    &#123;pagename&#125;.test.ts</span><br><span class="line">-component</span><br><span class="line">  &#123;componentname&#125;.css</span><br><span class="line">  &#123;componentname&#125;.stories</span><br><span class="line">  &#123;componentname&#125;.test.ts</span><br><span class="line">-state</span><br><span class="line">  -atoms</span><br><span class="line">    &#123;atomname&#125;.ts</span><br><span class="line">  -selectors</span><br><span class="line">    &#123;selectorname&#125;.ts</span><br><span class="line">-utils</span><br><span class="line">-types</span><br><span class="line">-api</span><br></pre></td></tr></table></figure>

<p>최종적으로 이런 형태를 생각하고 있다.</p>
<p>이제 본격적으로 개발을 해보도록 하자. 이번 프로젝트에서는 recoil을 사용할 예정이니 recoil이 잘 되는지부터 확인을 해보자.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app/layout.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> metadata = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;un-named&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode,</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;ko&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// src/state/atoms/testAtoms.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; atom &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> testState = <span class="title function_">atom</span>(&#123;</span><br><span class="line">  <span class="attr">key</span>: <span class="string">&quot;testState&quot;</span>,</span><br><span class="line">  <span class="attr">default</span>: <span class="string">&quot;recoil is working&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; testState &#125; <span class="keyword">from</span> <span class="string">&quot;../state/atoms/testAtom&quot;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRecoilState &#125; <span class="keyword">from</span> <span class="string">&quot;recoil&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Home</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [testStateValue, setTestStateValue] = <span class="title function_">useRecoilState</span>(testState)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setTestStateValue</span>(<span class="string">&quot;well&quot;</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(testStateValue)</span><br><span class="line">  &#125;, [testStateValue])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      home</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>정상 작동되길 바랐지만…</p>
<p><img src="/../../img/nextjs-2/4.png"></p>
<p>콘솔을 확인해 보니 난리가 났다.</p>
<p>에러 로그를 읽어보면</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Uncaught createContext only works in Client Components.</span><br><span class="line">Add the &quot;use client&quot; directive at the top of the file to use it.</span><br><span class="line">Read more: https://nextjs.org/docs/messages/context-in-server-component</span><br></pre></td></tr></table></figure>

<p>createContext는 Client Components 에서만 작동한다.<br>파일 상단에 “use client”를 추가해라<br>Read more: <a target="_blank" rel="noopener" href="https://nextjs.org/docs/messages/context-in-server-component">https://nextjs.org/docs/messages/context-in-server-component</a></p>
<p>라고 적혀있다.<br>우선 read more 을 확인해 보니 use client 추가하라는 말 말고<br>별 이야기가 없다.</p>
<p><a target="_blank" rel="noopener" href="https://nextjs.org/docs/getting-started/react-essentials#context">Useful Links</a>를 확인해보니<br><del>read more 에 read more 가 있다..!</del></p>
<blockquote>
<p>In Next.js 13, context is fully supported within Client Components, but it cannot be created or consumed directly within Server Components</p>
</blockquote>
<p>Client Components에서는 context 가 완전하게 지원하지만<br>Server Components에서는 생성하거나 consumed 할 수 없다고 한다.</p>
<p>일단 Server Components 내부적으로 context api를 사용하는 라이브러리는 사용하지 못한다고 이해를 했다.<br>recoil 또한 내부적으로 context api를 이용하니 이러한 문제가 발생한 거 같다.</p>
<p>그래서 next에서 제안한 방법은 다음과 같다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/RecoilRootProvider/RecoilRootProvider.tsx</span></span><br><span class="line"><span class="string">&#x27;use client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">ReactNode</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">RecoilRoot</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;recoil&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">ReactNode</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RecoilRootProvider</span>(<span class="params">&#123; children &#125;: Props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">RecoilRoot</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">RecoilRoot</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// src/app/layout.tsx</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RecoilRootProvider</span> <span class="keyword">from</span> <span class="string">&quot;../components/RecoilRootProvider&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> metadata = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;un-named&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RootLayout</span>(<span class="params">&#123;</span></span><br><span class="line"><span class="params">  children,</span></span><br><span class="line"><span class="params">&#125;: &#123;</span></span><br><span class="line"><span class="params">  children: React.ReactNode</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;ko&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">RecoilRootProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">RecoilRootProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/page.tsx</span></span><br><span class="line"><span class="string">&#x27;use client&#x27;</span>; <span class="comment">// 최상단에 추가</span></span><br></pre></td></tr></table></figure>

<p>provide 하는 컴포넌트를 Client Component로 만들어서 감싸주라고 한다.<br>이제 recoil 이 정상작동하는 것을 확인할 수 있다.</p>
<p>next를 사용해 보니 alias 설정이 엄청 필요할 것 같다.<br>routing을 디렉토리 구조를 바탕으로 하다 보니 이곳저곳에서 컴포넌트들을 가져오기 상당히 번거로웠다.<br>다음엔 alias 설정부터 하면서 포스팅을 시작해야겠다.</p>
<p>use client도 조금 더 확인을 해보고 싶은 부분이 있다.<br>2번째 사진을 보면 next 컴포넌트를 어떻게 구성하는지 나오는데<br>use client 동작 방식에 이해가 가지 않는 부분이 조금 있다.<br>이 부분은 확인하고 확실히 정리된 다음 여기에 포스트를 추가하도록 하겠다.</p>
<hr>
<p>2023.05.18</p>
<p>우선 App 라우터 안에 있는 모든 컴포넌트들은 기본적으로 Server Component이다.<br>지시문 use client를 통해서 Client Component로 만들 수 있다.</p>
<blockquote>
<p>“use client” does not need to be defined in every file. The Client module boundary only needs to be defined once, at the “entry point”, for all modules imported into it to be considered a Client Component.</p>
</blockquote>
<p>use client를 사용하면 그 아래에 있는 컴포넌트들은 전부 Client Component가 된다.</p>
<p>여기서 이해가 되지 않는 부분이 생긴다.</p>
<p>recoil 같이 전역으로 context를 사용하기 위해서 provider에 use client를 사용하면 recoil porvider 아래에 있는 모든 컴포넌트는 Client Component가 되어야 하는 게 아닌가?라는 생각이 들었다.</p>
<p>그렇다고 하면 지금 내가 한 것처럼 레이아웃을 구성한다면<br>3번째 이미지에 따라 app 디렉토리의 구성요소 빼고 전부 Client Component가 되어버린다.</p>
<p>그렇지만 실제로 확인해 보니 app&#x2F;page.tsx 가 Client Component가 아니었다.</p>
<p>정확하게는 아래와 같은 에러가 발생했다.</p>
<blockquote>
<p>You’re importing a component that needs useEffect. It only works in a Client Component but none of its parents are marked with “use client”, so they’re Server Components by default.</p>
</blockquote>
<p>useEffect 는 Client Component 에서 만 사용할수있는데 부모 에서 use client 를 사용하는 부분이 없다는것이다. 그렇기 때문에 이 컴포넌트는 Server Components 라고한다.</p>
<p>document를 살펴보아도 잘 이해가 되지 않아서 언제 한번 날 잡고 document 정독을 해야 할 것 같다.</p>
<p><img src="/../../img/nextjs-2/5.png"></p>
<p>Server Component, Client Component를 어떨 때 사용해야 하는지<br>보여주는 표이다 내용을 보면</p>
<p>프론트엔드에서 작업하는 대부분은 Client Component를 사용해야 한다.<br>컴포넌트 기반 아키텍처로 디렉토리를 구성했는데 조금 다른 방법을 사용하는 게 더 나을 거 같다는 생각을 했다.<br>(최대한 많은 component를 Server Component로 만들기 위해)</p>
<p>우선 next 자체를 처음 써보는 만큼 이것저것 많은 시도와 진행하면서 조금 더 편한 구조를 찾아보도록 하겠다.</p>
<p>참고: <a target="_blank" rel="noopener" href="https://nextjs.org/docs">https://nextjs.org/docs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://gastroad.github.io/2023/05/18/React/nextjs-2/" data-id="clhqi9snk000fj1jy1u1jh2xk" data-title="Next.js 에 대해서 알아보자-2" class="article-share-link">공유</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/05/22/React/ui-design-pattern/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">최신</strong>
      <div class="article-nav-title">
        
          react 디렉토리 구조에 대해서 알아보자.
        
      </div>
    </a>
  
  
    <a href="/2023/05/15/React/nextjs-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">이전</strong>
      <div class="article-nav-title">Next.js 에 대해서 알아보자-1</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">카테고리</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Front-dev-blog/" rel="tag">Front-dev-blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJs/" rel="tag">NodeJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEO/" rel="tag">SEO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Terminal/" rel="tag">Terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build-deploy/" rel="tag">build&amp;deploy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3js/" rel="tag">d3js</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">태그 클라우드</h3>
    <div class="widget tagcloud">
      <a href="/tags/Front-dev-blog/" style="font-size: 17.5px;">Front-dev-blog</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/NodeJs/" style="font-size: 12.5px;">NodeJs</a> <a href="/tags/React/" style="font-size: 20px;">React</a> <a href="/tags/SEO/" style="font-size: 10px;">SEO</a> <a href="/tags/Terminal/" style="font-size: 12.5px;">Terminal</a> <a href="/tags/build-deploy/" style="font-size: 15px;">build&deploy</a> <a href="/tags/d3js/" style="font-size: 10px;">d3js</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">아카이브</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">5월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">4월 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">11월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">6월 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">5월 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">최근 포스트</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/25/React/nextjs-3/">Next.js 에 대해서 알아보자-3</a>
          </li>
        
          <li>
            <a href="/2023/05/22/React/ui-design-pattern/">react 디렉토리 구조에 대해서 알아보자.</a>
          </li>
        
          <li>
            <a href="/2023/05/18/React/nextjs-2/">Next.js 에 대해서 알아보자-2</a>
          </li>
        
          <li>
            <a href="/2023/05/15/React/nextjs-1/">Next.js 에 대해서 알아보자-1</a>
          </li>
        
          <li>
            <a href="/2023/05/10/React/flux-4/">redux vs recoil 3</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 gastroad<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>